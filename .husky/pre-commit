#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üßπ Running pre-commit quality checks..."

# Run linting
echo "üîç Running ESLint..."
pnpm run lint

# Check TypeScript
echo "üîç Running TypeScript check..."
npx tsc --noEmit

# Run tests if they exist
if [ -f "package.json" ] && grep -q '"test"' package.json; then
  echo "üß™ Running tests..."
  pnpm run test
fi

# Check for critical issues
echo "üö® Checking for critical issues..."
LINT_OUTPUT=$(pnpm run lint 2>&1 || true)
CRITICAL_COUNT=$(echo "$LINT_OUTPUT" | grep -c "Parsing error" || echo "0")

if [ "$CRITICAL_COUNT" -gt 0 ]; then
  echo "‚ùå Critical parsing errors found! Please fix before committing."
  echo "$LINT_OUTPUT"
  exit 1
fi

echo "‚úÖ Pre-commit checks passed! Code quality is good."
