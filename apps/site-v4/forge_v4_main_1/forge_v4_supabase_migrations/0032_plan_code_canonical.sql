-- PromptForgeâ„¢ Plan Code Canonicalization\n-- Migration: 0027_plan_code_canonical.sql\n-- Purpose: Align orgs.plan_code with 'promptforge_pilot' as canonical default and allowed values\n\n-- Update existing orgs using legacy 'promptforge_free' to 'promptforge_pilot'\nUPDATE public.orgs\nSET plan_code = 'promptforge_pilot'\nWHERE plan_code = 'promptforge_free';\n\n-- Reset default plan code to 'promptforge_pilot'\nALTER TABLE public.orgs\n  ALTER COLUMN plan_code SET DEFAULT 'promptforge_pilot';\n\n-- Replace CHECK constraint to include 'promptforge_pilot' (and keep others for compatibility)\nALTER TABLE public.orgs\n  DROP CONSTRAINT IF EXISTS orgs_plan_code_check;\n\nALTER TABLE public.orgs\n  ADD CONSTRAINT orgs_plan_code_check\n  CHECK (plan_code IN ('promptforge_pilot','promptforge_creator','promptforge_pro','promptforge_enterprise'));\n
