

SPECIFICATIE SITE


1) Charter & KPI â€” â€œmoney-firstâ€ version
1.1 Product charter (what weâ€™re building and why it pays)

Purpose (business outcome): convert audience attention into predictable subscription revenue and high-margin digital product sales, with upsells that increase ARPU and shorten payback.

North Star (one sentence): â€œNumber of paid workspaces that export artifacts monthly.â€
Rationale: it directly drives MRR and correlates with long-term retention.

Target markets (sequenced):

Solo creators/consultants/agencies in EU/US who sell info-products/services;

SMB marketing teams;

Enterprise teams via seats + API.

ICPs (money signals):
â€“ Creator/Consultant doing â‚¬3â€“30k/mo who wants speed â†’ buys Pro.
â€“ Agency 3â€“20 ppl, recurring clients â†’ buys Pro + seats.
â€“ Company team (legal/brand/security asks) â†’ Enterprise (API, SSO, SLA).

Jobs to be done (top 4):
JTBD-1: Produce shippable artifacts (.md/.pdf/.json/.zip) fast â†’ sell/fulfill.
JTBD-2: Test prompts/modules safely (simulated) â†’ upgrade to â€œliveâ€ when needed.
JTBD-3: Gate features/export by plan â†’ convert freeâ†’paid with obvious value.
JTBD-4: Keep history/telemetry for proof & reuse â†’ reduce time-to-money next time.

Value proposition (why us vs. alternatives): 50 modules, 7-D parameter engine, simulation by default (cheap), â€œtruthâ€ (live) behind paywall (revenue), export pipeline with checksum/zip (professional output).

Business scope (MVP that generates revenue): auth â†’ pricing â†’ checkout â†’ run modules â†’ export â†’ history/telemetry â†’ upsell gates.
Non-goals now: third-party marketplace, native mobile, POS.

1.2 Revenue model (how cash flows)

Primary: Subscriptions (Free, Creator, Pro, Enterprise).
Indicative price points (can A/B within Â±20%): Creator â‚¬19/m, Pro â‚¬49/m, Enterprise â‚¬299/m base (5 seats) + â‚¬59/seat/m. Annual = 10Ã— monthly.

Secondary: Digital products (paid bundles/templates), Add-ons (evaluator_advanced, export_designer), Seats, API (Enterprise).

Monetization levers: plan gates (live tests, pdf/json, bundle.zip, API), export rights, rate-limits, watermarking in trial.

Expansion: seats, add-ons, annual prepay, price-lift on renewals (grandfathering policy).

Unit economics guardrails:
â€“ Target Gross Margin â‰¥ 85% (hosting + vendor costs contained).
â€“ Payback â‰¤ 2 months on Pro; â‰¤ 4 months on Enterprise.

1.3 Growth & brand (only metrics that lead to money)

Acquisition loops: SEO content â†’ demo bundles â†’ â€œSimulate Testâ€ (free) â†’ â€œRun Real Testâ€ (paywall). Affiliates/partners for Creator/Pro.

Activation: first export within â‰¤10 minutes from signup (TTV).

Retention: artifact reuse, history, evaluator scores, â€œresume last runâ€ prompts.

Brand KPIs tied to revenue (leading â†’ lagging):
â€“ Branded search volume (GSC) â†’ correlates with Direct/Organic MRR share.
â€“ Direct traffic % that reaches pricing â†’ Signup rate â†’ Freeâ†’Paid CR.
â€“ NPS (Pro/Ent) and Support CSAT â†’ Net Revenue Retention (NRR).
â€“ PR/mentions/earned links â†’ lift in Organic sessions â†’ MRR growth.

1.4 KPI framework (definitions, targets, owners)
A) Commercial (board-level)

MRR = Î£(active paid plans monthly net of discounts).
Targets: M0 baseline; M2 â‚¬5k; M6 â‚¬25k; M12 â‚¬75k.

Churn (logo & revenue) = cancellations in month Ã· start-of-month base.
Targets: Pro rev. churn <4%/mo by M6; Enterprise <2%/mo by M12.

NRR = (MRR start + expansion âˆ’ churn âˆ’ contraction) Ã· MRR start.
Target: â‰¥110% (rolling 3-mo) by M9.

LTV/CAC (blended by plan).
â€“ LTV = ARPA Ã— Gross Margin Ã— Avg. Lifespan (months).
â€“ CAC = direct paid + attributable content spend Ã· new paid logos.
Targets: â‰¥3.0 by M6; stretch â‰¥5.0 by M12.
Payback = CAC Ã· (ARPA Ã— GM) â†’ â‰¤2 mo Pro, â‰¤4 mo Ent.

Freeâ†’Paid Conversion (28-day) = new paid Ã· signups.
Targets: â‰¥6% overall by M3; â‰¥10% by M9 (with gates & trials tuned).

B) Funnel & product usage (drives the above)

Visitorâ†’Signup CR (28-day) target â‰¥3.5% by M3; â‰¥5% by M9.

Activation (TTV â‰¤10m) = % signups exporting â‰¥1 artifact D0. Target â‰¥60%.

WAU/MAU stickiness â‰¥ 0.45 (Pro), 0.35 (Creator).

Export Mix: % exports that are pdf/json/zip (paid-only) â†’ Upsell indicator.
Target: â‰¥55% of all exports behind paywall by M6.

Evaluator Score (0â€“100) median for live tests: â‰¥80 (DoD gate).

Support tickets per 1000 MAU: â‰¤15 (Pro), â‰¤8 (Ent).

C) Performance & reliability (keeps revenue safe)

TTFB < 200 ms (EU/US) P75.

LCP < 2.5 s P75; INP < 200 ms; CLS < 0.1.

Uptime â‰¥ 99.9%; Error budget â‰¤ 0.1%/month.

Checkout success rate â‰¥ 98.5% (post-3DS).

Cold-start to first render (landing) â‰¤ 1.2 s on 4G P75.

D) Compliance & finance (donâ€™t block revenue)

PCI scope: SAQ A-EP posture verified per release.

GDPR: DSR SLA (export/erase) â‰¤ 7 days; consent logs 100% coverage.

Tax correctness: VAT OSS & US state mapping 100% on invoices.

1.5 Targets by phase (commit & stretch)
Phase	Horizon	Commercial	Product/Funnel	Perf/Rel
P0 Launch	Weeks 0â€“8	MRR â‚¬5k; Freeâ†’Paid â‰¥4%	Activation â‰¥50%; 1st export â‰¤10m	TTFB <220ms; LCP <2.8s; 99.9%
P1 Scale	Weeks 9â€“16	MRR â‚¬15k; LTV/CAC â‰¥3	WAU/MAU â‰¥0.4; Export mix paid â‰¥45%	TTFB <200ms; LCP <2.5s
P2 Optimize	Weeks 17â€“24	MRR â‚¬25k; NRR â‰¥105%	Freeâ†’Paid â‰¥8%; Payback â‰¤2mo	Error budget â‰¤0.08%
P3 Enterprise	Months 7â€“12	MRR â‚¬75k; NRR â‰¥110%	Ent seats avg. â‰¥7; CSAT â‰¥4.6/5	Uptime 99.95%
1.6 Instrumentation & measurement (no data, no bonus)

Event taxonomy (server-side + RUM): pricing_view, signup, module_run_simulated, module_run_live, export_txt|md|pdf|json|zip, checkout_started, checkout_paid, trial_started, trial_converted, addon_purchased, seat_added, api_call, error_client, error_server, web_vitals(LCP/INP/CLS).

Attribution: first-touch (UTM) + last-touch (session) + modelled (content).

Dashboards (single truth):
â€“ Revenue: MRR/NRR, ARPA, churn, payback, LTV/CAC.
â€“ Funnel: sessionsâ†’pricingâ†’signupâ†’activationâ†’freeâ†’paid.
â€“ Usage: exports by type/plan, evaluator scores, runs per module.
â€“ Performance: RUM CWV by route/geo, uptime, error budget burn.
â€“ Compliance: DSR queue, consent coverage, invoice tax map.

1.7 Guardrails (things that protect the P&L)

DoR gate: module cannot â€œRun Real Testâ€ unless 7-D params valid.

DoD gate: export blocked if Evaluator score < 80 (label â€œSimulatedâ€ or watermark if allowed).

Rate limits: protect cost per user; clear upgrade CTA when hit.

Vendor spend SLO: hosting+vendors â‰¤ 15% of MRR (rolling 30d).

A/B safety: experiments auto-revert if checkout CR drops > 10% P7D.

1.8 Ownership & cadence

DRIs:
â€“ Commercial: Head of Growth (MRR, CAC, Freeâ†’Paid).
â€“ Product: PM (Activation, WAU/MAU, Export mix).
â€“ Reliability: Eng Lead (Uptime, Error budget, CWV).
â€“ Compliance/Tax: Ops Lead (DSR SLA, invoice correctness).

Reviews: weekly KPI stand-up; monthly board snapshot; quarter re-targets.





2) Stakeholderi & RACI â€” descriere extinsÄƒ pentru proiect (PromptForge)
2.1 Scopul secÈ›iunii

StabileÈ™te cine decide, cine executÄƒ, cine este consultat È™i cine trebuie informat pentru fiecare domeniu critic (payments, tax, content, infra, securitate). EliminÄƒ blocajele, scade riscul de â€ownership difuzâ€ È™i leagÄƒ responsabilitÄƒÈ›ile de KPI-urile comerciale (MRR, LTV/CAC, Freeâ†’Paid), tehnice (TTFB, LCP, Uptime), de conformitate (GDPR/PCI), È™i de experienÈ›Äƒ (CSAT, NPS).

2.2 Roluri È™i responsabilitÄƒÈ›i (descriere operaÈ›ionalÄƒ)
Product Manager (PM)

ResponsabilitÄƒÈ›i: direcÈ›ie produs, roadmap, definire DoR/DoD, prioritizare pe KPI de conversie È™i retenÈ›ie, arbitraj trade-off (time-to-market vs. perf/quality).

Decizii finale (A): ce intrÄƒ Ã®n MVP/roadmap, gating pe planuri, experiment design, criterii succes.

KPI: Freeâ†’Paid CR, TTV (time-to-value â‰¤ 10 min), Export mix (paid), NRR.

Engineering Lead (Eng Lead)

ResponsabilitÄƒÈ›i: arhitecturÄƒ, calitate cod, performanÈ›Äƒ, fiabilitate, incident management, code review policy, CI/CD.

Decizii finale (A): strategia de deploy (trunk/canary), scheme cache/edge, standarde tehnice, buget de eroare.

KPI: Uptime â‰¥ 99.9%, Error budget â‰¤ 0.1%/lunÄƒ, LCP/INP È›intÄƒ, rata de build verzi.

Design Lead (UX/UI)

ResponsabilitÄƒÈ›i: design system (tokens, componente), UX flows, accesibilitate (WCAG 2.2 AA), prototipuri.

Decizii finale (A): standarde vizuale, reguli accesibilitate, pattern-uri UI.

KPI: CR pe funnel (landingâ†’pricingâ†’signup), CWV pe pagini content (CLS < 0.1), CSAT UX.

Data Lead (Analytics/Telemetry)

ResponsabilitÄƒÈ›i: event taxonomy, RUM pentru Core Web Vitals, dashboards revenue/funnel, atribuire.

Decizii finale (A): ce evenimente se logheazÄƒ È™i cum, definiri metrice, alerte/anomalii.

KPI: acurateÈ›ea datelor (â‰¥99%), latenÈ›Äƒ rapoarte (<1h), adoptarea dashboard-urilor.

Legal/GRC Lead (incl. DPO, dacÄƒ e externalizat)

ResponsabilitÄƒÈ›i: GDPR (DPIA/DPA), consimÈ›ÄƒmÃ¢nt granular, politici, PCI posture, ToS/Privacy.

Decizii finale (A): politici date, procese DSR (export/È™tergere), mapare taxe vs. jurisdicÈ›ii (cu Finance).

KPI: DSR SLA â‰¤ 7 zile, conformitate fiscalÄƒ 100%, audit trail tamper-evident.

Marketing Lead (Growth/Brand)

ResponsabilitÄƒÈ›i: SEO, conÈ›inut, demo bundles, campanii, pricing page UX, comunicare lansÄƒri.

Decizii finale (A): calendar conÈ›inut, tactici de creÈ™tere, mesaje/poziÈ›ionare.

KPI: trafic organicâ†’pricing, signup CR, CAC (blended), brand search lift.

Support Lead (CX/Success)

ResponsabilitÄƒÈ›i: SLA suport, bazÄƒ de cunoÈ™tinÈ›e, macros, triere tichete, feedback loop cÄƒtre PM/Eng.

Decizii finale (A): procese suport, playbook severitÄƒÈ›i, mesaje status/incident.

KPI: CSAT â‰¥ 4.6/5, tichete/1000 MAU, timpul median de rezolvare.

Extensii specializate

SRE/DevOps: CI/CD, observabilitate, DR/backup, capacity management.

Security Engineer: ASVS L2, CSP/SRI, SAST/DAST, secret management, threat modeling.

Finance/Tax Ops: reconciliere Stripe, dunning, taxe (VAT OSS/US), rapoarte fiscale.

2.3 Domenii critice & proprietari (DRI + KPI È›intÄƒ)
Domeniu	DRI (Responsible)	Accountable	Consulted	Informed	KPI cheie
Payments	Finance/Tax Ops	PM	Eng Lead, Legal, Support	Marketing, Data	Checkout success â‰¥ 98.5%, dispute rate â‰¤ 0.8%
Tax	Finance/Tax Ops	Legal/GRC	PM, Eng Lead	Data, Support	Corectitudine taxe 100%, facturÄƒ â‰¤ 5s
Content (CMS/SEO)	Design + Marketing (co-R)	PM	Data, Legal	Support, Eng	Draftâ†’Publish â‰¤ 24h P90, CLS < 0.1, CRâ†’Pricing
Infra	SRE/Eng	Eng Lead	PM, Security	Data, Support, Marketing	Uptime â‰¥ 99.9%, TTFB P75 < 200ms
Securitate	Security Engineer	Legal/GRC	Eng Lead, DPO	PM, Support	0 high vulns, DSR â‰¤ 7 zile, CSP enforced

PM rÄƒmÃ¢ne Accountable pe obiectivul de produs; DRI-urile sunt Responsible pe execuÈ›ie Ã®n domeniile lor.

2.4 RACI pe domenii â€” detaliu operaÈ›ional

2.4.1 Payments
Scope: procesator (Stripe), planuri, upgrade/downgrade, prorratare, dunning, dispute.
RACI: R=Finance, A=PM, C=Eng/Legal/Support, I=Marketing/Data.

Decizii discrete:
Alegerea procesator & modele preÈ›: A PM / R Finance / C Legal, Eng / I Marketing.
Checkout & webhooks: A Eng Lead / R Eng / C Finance, Data / I PM.
Dunning (retry windows, comms): A Finance / R Finance / C Support, PM / I Data.
Trigger escaladare: checkout success <98.5% (60 min) â†’ Incident Sev-2 (Eng+Finance); dispute rate >0.8% (7 zile) â†’ revizie funnel/ToS (PM/Legal).

2.4.2 Tax
Scope: VAT OSS, US sales tax, capturÄƒ adresÄƒ, arhivare facturi.
RACI: R=Finance, A=Legal/GRC, C=PM/Eng, I=Data/Support.
Decizii: motor taxe (Stripe Tax/TaxJar), È™abloane facturare, storno, audit lunar.
SLO: facturÄƒ emisÄƒ â‰¤ 5s post-platÄƒ; conformitate 100% la audit.

2.4.3 Content (CMS/Blog/Docs/Changelog)
Scope: modelare tipuri conÈ›inut, workflow draftâ†’reviewâ†’approveâ†’schedule, SEO tehnic, media library.
RACI: R=Design+Marketing, A=PM, C=Data/Legal, I=Support/Eng.
SLO: timp mediu pipeline â‰¤ 24h P90; alt-text 100%; sitemap/hreflang valide; impact SEOâ†’pricingâ†’signup mÄƒsurat.

2.4.4 Infra (Edge/CDN, DB, CI/CD, Observabilitate)
Scope: arhitecturÄƒ edge-first, SSR/SSG, Postgres RLS, storage S3-compat, Redis, CI/CD, logs/metrics/traces, DR.
RACI: R=SRE/Eng, A=Eng Lead, C=PM/Security, I=Data/Support/Marketing.
SLO: Uptime â‰¥ 99.9%; TTFB P75 < 200ms (EU/US); error budget â‰¤ 0.1%/lunÄƒ; RPO â‰¤ 1h / RTO â‰¤ 4h.

2.4.5 Securitate (ASVS L2, CSP, DSR)
Scope: politici securitate, CSP/SRI, CSRF/XSS/SSRF, secret mgmt, SAST/DAST, DPIA/DSR.
RACI: R=Security Engineer, A=Legal/GRC, C=Eng Lead/DPO, I=PM/Support.
SLO: 0 vulnerabilitÄƒÈ›i High/Critical la release; DSR â‰¤ 7 zile; rapoarte SAST/DAST ataÈ™ate la release notes.

2.5 Procese transversale
2.5.1 Template RACI pentru Epics/Features
EPIC: <Nume>
Obiectiv/KPI miÈ™cat: <ex: Freeâ†’Paid +2pp>
DRI (Accountable): <rol/persoanÄƒ>
R (execuÈ›ie): <roluri/echipe>
C (consultat): <roluri/echipe>
I (informat): <canale/maileri>
Milestones: M1/M2/M3 (date)
DoR: scope, owner, estimÄƒri, riscuri, plan testare, flag de rollout
DoD: score â‰¥80, CWV ok, docs/runbooks, dashboards, changelog
Riscuri/MitigÄƒri: listÄƒ operabilÄƒ
Escaladare: T1 30m (on-call), T2 2h (Lead), T3 24h (SteerCo)

2.5.2 Cadente & ritualuri de comunicare
Daily 15â€™ (toÈ›i DRIs): blocaje, decizii â€Aâ€ de azi, riscuri.
Weekly KPI (PM, Eng, Data, Marketing, Support, Finance/Legal): MRR/NRR, Freeâ†’Paid, TTV, CWV, Error budget.
Fortnightly Roadmap (PM â€Aâ€): re-prioritizare Ã®n funcÈ›ie de KPI & debt.
Monthly Compliance/Tax (Legal/Finance): audit taxe, DSR backlog, politici.
Incident Review 48h (post-mortem): cauza, acÈ›iuni corective cu SLA.

2.5.3 Canale & instrumente
Issue tracking: Linear/Jira (epicâ†’issue cu template RACI).
Repo & CI/CD: GitHub (branch-protection, checks), Vercel (previews, canary).
Observabilitate: Sentry (erori), RUM CWV, Axiom/Logtail (logs), Grafana/Loki (traces/metrics).
PlÄƒÈ›i & taxe: Stripe Billing/Tax, reconcilieri automate + rapoarte lunare.
Comunicare: Slack (#product, #eng-oncall, #payments-tax, #sec-alerts, #content), Statuspage.

2.6 On-call, severitÄƒÈ›i, escaladare
SeveritÄƒÈ›i (rezumat):
Sev-1: PlÄƒÈ›i/checkout indisponibile â‰¥10 min sau Uptime sub 99.9% Ã®n fereastra curentÄƒ.
AcÈ›iune: Eng on-call + Finance + PM; update public la 15â€™; rollback dacÄƒ e cauzat de release.
Sev-2: Exporturi plÄƒtite afectate, TTFB degradat â‰¥50% P75, erori API > 2% 15 min.
Sev-3: Buguri non-critice, conÈ›inut/SEO build fail parÈ›ial.
Rota:
Primar: SRE/Eng on-call (24Ã—7).
Secundar: Eng Lead.
Business: PM + Support (comunicare, changelog, post-mortem).

2.7 Trasabilitate cÄƒtre KPI din Charter
Payments/Tax â†’ MRR, Payback, LTV/CAC (pipeline de bani sÄƒnÄƒtos).
Content (SEO/Docs/Changelog) â†’ acquisitionâ†’pricingâ†’signup (cost scÄƒzut la achiziÈ›ie).
Infra/Securitate â†’ Uptime, CWV, Error budget (nu pierdem venit la Ã®ncÄƒrcare).
Support/Data â†’ NRR, churn, CSAT (retenÈ›ie & expansion).

2.8 Exemple concrete (PromptForge)
Feature: â€œRun Real Testâ€ (gating Pro+)
A (PM), R (Eng), C (Data/Support/Marketing), I (Legal).
KPI: Freeâ†’Paid +2pp; Payback â‰¤ 2 luni.
DoD: score â‰¥80, rate-limit clar, fallback â€Simulatedâ€ cu watermark, metrice Ã®n dashboard.
Lansare â€œbundle.zipâ€ (Enterprise)
A (PM), R (Eng + Exports), C (Legal/Finance pentru licenÈ›e & facturi), I (Marketing/Support).
KPI: ARPA Enterprise +â‚¬299/m, NRR â‰¥110%.
Taxe SUA (Stripe Tax)
A (Legal/GRC), R (Finance), C (PM/Eng), I (Support/Data).
SLO: facturÄƒ corectÄƒ â‰¤ 5s, hÄƒrÈ›i jurisdicÈ›ii 100% acoperire.

2.9 Reguli dure (anti-deraiere)
Nicio iniÈ›iativÄƒ fÄƒrÄƒ DRI nominal È™i template RACI complet â†’ task blocat.
Accountable este 1 persoanÄƒ, nu un grup.
Deciziile â€Aâ€ sunt logate (link issue/PR), cu motivare KPI.
DacÄƒ SLO nu este definit, nu se dÄƒ GO.
Orice schimbare ce afecteazÄƒ plÄƒÈ›i/checkout trece prin Security & Legal (checklist) + canary.

2.10 â€Ready-to-runâ€ (mod aplicabil imediat)
CreeazÄƒ Ã®n tracker un Epic Template RACI (secÈ›iunea 2.5.1).
AdaugÄƒ rubricÄƒ obligatorie â€DRI & RACIâ€ Ã®n PR template.
IniÈ›iazÄƒ #payments-tax, #sec-alerts, #eng-oncall canale.
Pune dashboards minime: Revenue, Funnel, Usage (exports), Perf (RUM CWV), Compliance.
PublicÄƒ Playbook Incidente (Sev-1/2/3), anunÈ› Ã®n Slack, link Ã®n Statuspage.





3) Domeniu & LimitÄƒri â€” â€ce intrÄƒ ACUM, ce nu intrÄƒ, ce blocÄƒmâ€

3.1 Scop (scope) â€” livrabilele MVP care produc bani
Include ACUM (MVP, faza 1): Autentificare & conturi: email+parolÄƒ, OAuth (Google), reset parole, email verify. Workspaces & org-uri: 1+ workspace per utilizator, invitaÈ›ii prin email, roluri de bazÄƒ. Planuri & plÄƒÈ›i (Stripe): Free, Creator, Pro, Enterprise; trial Pro; upgrade/downgrade, dunning. Catalog module (M01â€“M50): cÄƒutare/filtre, pagini modul, parametri 7D, â€Simulate Testâ€ (free) vs â€Run Real Testâ€ (Pro+). Exporturi: .txt (Free), .md (Creator+), .pdf/.json (Pro+), bundle.zip (Enterprise). Istoric & telemetrie: listÄƒ de run-uri, scor Evaluator, run_id, checksum, descÄƒrcÄƒri. CMS & Blog: landing, pricing, changelog, docs/api (stativ), blog (MDX), sitemap, RSS. Admin minim: utilizatori/org-uri, abonamente, exporturi, webhooks log, feature flags. Include CURÃ‚ND (faza 2): Produse fizice & fulfillment (SKU, greutate, tracking), i18n (en/ro), webhooks publice, API public (reads). Include MAI TÃ‚RZIU (faza 3): CÄƒutare avansatÄƒ (embedding + BM25), AI-ops Ã®n coadÄƒ (jobs programate), marketplace intern (bundles curatori).

3.2 Non-scop (explicit NU intrÄƒ acum)
Marketplace terÈ›i (vÃ¢nzÄƒtori externi, split payments).
Headless POS / retail fizic.
AplicaÈ›ii mobile native (iOS/Android).
SSO enterprise avansat (SAML/SCIM) â€” doar OAuth de bazÄƒ iniÈ›ial.
Editor WYSIWYG complex (rÄƒmÃ¢ne MDX + blocuri standard).
ML custom cu host propriu (folosim furnizori â†’ cost control).
Integrare CRM bidirecÈ›ionalÄƒ (deocamdatÄƒ webhook out + export CSV/JSON).
AutomatizÄƒri â€always-onâ€ costisitoare (fÄƒrÄƒ rulÄƒri recurente pÃ¢nÄƒ la P&L pozitiv).
DacÄƒ ceva nu e Ã®n secÈ›iunea â€Include ACUMâ€, e non-scop pÃ¢nÄƒ la revizuire trimestrialÄƒ.

3.3 ConstrÃ¢ngeri & ipoteze (ca sÄƒ nu deraiem)
Edge-first + CDN (Vercel/Cloudflare): TTFB P75 < 200ms EU/US.
Next.js (SSR/SSG hibrid), TypeScript strict, monorepo (apps/web, apps/admin, packages/ui, packages/lib).
PersistenÈ›Äƒ: Postgres (Supabase) cu RLS per org_id; media pe S3-compat (semnare URL).
Procesator plÄƒÈ›i: Stripe (Tax, Billing, Checkout).
Observabilitate: logs structurate, RUM pentru CWV, metrici uptime/error budget.
GDPR-first: minim PII, consimÈ›ÄƒmÃ¢nt granular, DSR export/È™tergere â‰¤ 7 zile.
Cost guardrail: costuri infra+vendor â‰¤ 15% din MRR (rolling 30d).

3.4 InterfeÈ›e (ce deschidem, ce nu)
Public: site (landing/pricing/docs), blog, sitemap, RSS.
Autentificat: generator, export manager, istoric, dashboard.
API: intern pentru FE; public read-only experimental la faza 2 (rate-limit, chei).
Webhooks: Stripe in; (out) cÄƒtre clienÈ›i Ã®n faza 2 (semnate, retry exponential).

3.5 Reguli de gating (evitÄƒm â€scope creepâ€, monetizÄƒm)
Simulate Test: permis tuturor (gratis), marcat â€Simulatedâ€.
Run Real Test: Pro+; blocat dacÄƒ DoR invalid sau cost-cap depÄƒÈ™it.
Exporturi:
â€“ .txt Free; .md Creator+; .pdf/.json Pro+; bundle.zip Enterprise.
â€“ Watermark Ã®n trial Pro; checksum la toate exporturile.
Evaluator Score: export blocat dacÄƒ < 80 (DoD).
Rate limit: cÃ¢nd e atins â†’ CTA de upgrade clar.

3.6 Livrabile verificabile (acceptance criteria)
Auth: create/login/logout, OAuth Google, verify email, reset, MFA (OTP) opÈ›ional.
PlÄƒÈ›i: checkout success â‰¥ 98.5%, taxe corecte, invoice Ã®n â‰¤ 5s, dunning flow verificat.
Module: run simulare & live, 7D validat, scor salvat, telemetrie completÄƒ.
Export: fiÈ™ier generat, hash SHA256 salvat, descÄƒrcare cu link semnat, watermark Ã®n trial.
CMS: editor MDX, draftâ†’reviewâ†’schedule, OpenGraph/Schema, sitemap & RSS validate.
Perf: LCP P75 < 2.5s, INP < 200ms, CLS < 0.1.
Securitate: CSP strictÄƒ, SRI, CSRF, RLS testat, 0 high vulns (SAST/DAST).

3.7 DependenÈ›e externe (minim viabile)
Stripe (Checkout, Billing, Tax), Supabase (Auth, DB, RLS, Storage), Vercel (hosting/edge),
Postmark/Resend (email tranzacÈ›ional), Sentry (erori), Axiom/Logtail (logs) â€” opÈ›ional.

3.8 Feature flags & rollout
Fiecare capabilitate nouÄƒ are flag (server-side).
Rollout: internal â†’ 5% â†’ 25% â†’ 100%; auto-revert dacÄƒ checkout CR scade >10% P7D.
Preview deploys obligatorii pentru PR-uri; canary la producÈ›ie.

3.9 Limite operaÈ›ionale (cost, risc, timp)
Cost: fÄƒrÄƒ joburi AI recurente sau vector DB dedicat la P0; doar dacÄƒ KPI comercial depÄƒÈ™eÈ™te praguri.
Risc: fÄƒrÄƒ privilegii wide DB; RLS obligatoriu; secret management centralizat.
Timp: dacÄƒ o cerinÈ›Äƒ adaugÄƒ >10 zile la critical path È™i nu creÈ™te KPI-uri MRR/CR/TTV, se amÃ¢nÄƒ.

3.10 LegÄƒtura cu KPI-urile Charter
Auth+PlÄƒÈ›i+Gating â†’ Freeâ†’Paid CR, MRR, Payback.
Export pipeline â†’ Activation â‰¤10m, RetenÈ›ie (artifact reuse).
Perf & Securitate â†’ Uptime, Error budget, SEOâ†’acquisition.
CMS/Blog â†’ Organicâ†’Pricingâ†’Signup.





4) ArhitecturÄƒ de Sistem â€” edge-first, sigurÄƒ, mÄƒsurabilÄƒ
4.1 Principii de proiectare
Edge-first + CDN: 80% din trafic servit din edge (static/SSG, imagini, cache); SSR doar unde e nevoie (pricing dinamic, dashboard).
Safety by default: RLS pe fiecare tabel multi-tenant; secret management centralizat; zero PII â€œnecesar-doarâ€.
Observabilitate ca produs: logs structurate, metrice, traces; RUM pentru Core Web Vitals; error budget vizibil.
Gating monetizabil: feature flags server-side, rate-limit, export watermark Ã®n trial.
Fail-safe: degradeazÄƒ la â€œSimulatedâ€ cÃ¢nd live test nu e disponibil; rollback automat pe canary fail.

4.2 Tehnologii & topologie (alegeri MVP)
FE: Next.js (App Router), TypeScript strict, React Server Components, MDX pentru docs/blog.
Hosting/Edge: Vercel (ISR/SSG/SSR, Image Optimization, Edge Middleware).
Auth & DB: Supabase (Postgres 15 + RLS; Auth cu OAuth + email/password; Storage S3-compat).
PlÄƒÈ›i/Taxe: Stripe (Checkout, Billing, Tax, Webhooks).
Cache: Redis (KV pentru ratelimiting, sessions cache, expunere rapidÄƒ la edge cÃ¢nd e necesar).
CÄƒutare (faza 2): Algolia sau OpenSearch (BM25 + facets; ulterior hibrid embeddings).
Cozi/mesagerie: SQS/Cloud Tasks sau Vercel Queues (jobs de export PDF/JSON, evaluare, embedding).
Observabilitate: Sentry (erori), Axiom/Logtail (logs), Grafana/Loki/Tempo (opÈ›ional pentru traces).
Email: Postmark/Resend (tranzacÈ›ional + templates).

4.3 C4 â€“ nivel Context (textual)
Utilizator â†’ interacÈ›ioneazÄƒ cu AplicaÈ›ia Web (PromptForge) pentru a genera È™i exporta artefacte.
AplicaÈ›ia Web â†’ apeleazÄƒ API intern (route handlers Next.js) â†’ Postgres (date business), Storage (fiÈ™iere), Stripe (checkout), Queue (joburi), Analytics (telemetrie).
Admin â†’ UI securizat pentru utilizatori/org-uri, abonamente, exporturi, webhooks, feature flags.

4.4 C4 â€“ nivel Container
apps/web (Next.js)
Edge Middleware: auth guard uÈ™or, i18n path, rate-limit global.
SSR/ISR: pricing, generator, dashboard, blog.
Route handlers: /api/run/[moduleId], /api/exports, /api/webhooks/stripe.
apps/admin (Next.js/React)
UI backoffice: user/org mgmt, plan gates, logs, webhooks, feature flags.
packages/ui
Design system (tokens, Nav, Card, Table, Form, Modal, Stepper, Toast, Empty/Error/Skeleton).
packages/lib
modules.ts (catalog M01â€“M50), params.ts (schemÄƒ 7D), gating.ts, simulate.ts, scoring.ts, exports.ts, stripe.ts, supabase.ts.
DB (Supabase Postgres)
RLS per org_id; funcÈ›ii SQL pentru audit trail È™i calcul metrice (ex: run counting).
Queue/Workers
Worker â€œExportsâ€ (genereazÄƒ .pdf/.json/.zip + checksum).
Worker â€œEvaluatorâ€ (score 0â€“100, watermark logic).
Worker â€œEmbeddingsâ€ (faza 3).
Storage
Bucket privat exports/ cu URL semnat (TTL descÄƒrcÄƒri).
Observability Stack
Ingest logs/metrics/traces; alerte pentru SLO.

4.5 C4 â€“ nivel Component (exemple cheie)
Auth Gateway (edge middleware + Supabase Auth)
VerificÄƒ cookie/JWT; injecteazÄƒ org_id Ã®n request context; device binding (opÈ›ional).
Gating Engine (lib/gating.ts)
PrimeÈ™te {plan, feature, flags, context} â†’ decide allow/deny/degrade.
IntegreazÄƒ rate-limit, watermarks, cost caps.
Test Engine (lib/simulate.ts, lib/live.ts)
simulateGptResponse(prompt, params7D, seed) â†’ ieftin, determinist.
liveGptTest(prompt) (Pro+) â†’ log tokens, cost, duratÄƒ, scor.
Export Pipeline (lib/exports.ts)
GenereazÄƒ .txt/.md/.json/.pdf, calculeazÄƒ SHA256, scrie manifest, Ã®ncÄƒrcÄƒ Ã®n Storage, emite eveniment export.ready.
Billing Service (lib/stripe.ts)
Checkout, upgrade/downgrade, prorratare, dunning, Stripe Tax; reconcile job nocturn.
Analytics Ingestor
Server-side events (pricing_view, signup, module_run_*, export_*, checkout_*, web_vitals) + RUM CWV.

4.6 Fluxuri evenimente (webhooks & cozi)
Stripe â†’ Webhook â†’ DB/Queue
checkout.session.completed â†’ creeazÄƒ/actualizeazÄƒ subscriptions + entitlements.
invoice.paid / invoice.payment_failed â†’ update status, porneÈ™te dunning.
customer.subscription.updated â†’ sincronizeazÄƒ plan/seats/add-ons.
Fail-safe: idempotency keys; retry exponential; dead-letter queue + alert.

Run Module â†’ Export
FE trimite /api/run/[moduleId] cu params7D.
Server valideazÄƒ DoR (schemÄƒ), consultÄƒ gating.ts.
DacÄƒ simulate â†’ rÄƒspuns imediat + etichetÄƒ; dacÄƒ live â†’ push job Ã®n queue:exports.
Worker creeazÄƒ fiÈ™ierul, calculeazÄƒ checksum, Ã®ncarcÄƒ Ã®n Storage, salveazÄƒ exports Ã®n DB, trimite event export.ready.
FE subscribe (SSE/long-poll) â†’ afiÈ™eazÄƒ buton Download (URL semnat, TTL).
Observabilitate
Orice job -> log (run_id, module_id, org_id, duration, status, cost), metrici (histograme durata, rate succes), trace ID.

4.7 Tenancy & securitate datelor
Model: multi-tenant logic prin org_id pe fiecare rÃ¢nd; RLS â€œdeny-by-defaultâ€.
RLS exemplu:
create policy org_isolation on runs
for select using (auth.uid() = user_id and org_id = current_setting('app.org_id')::uuid);
Chei: rotaÈ›ie trimestrialÄƒ; acces prin secret store; zero secrete Ã®n client.
CSP strictÄƒ + SRI pentru resurse; protecÈ›ii CSRF/XSS/SSRF; upload cu MIME allowlist.

4.8 PersistenÈ›Äƒ & scheme (rezumat aplicativ)
Postgres:
users, orgs, memberships, roles, sessions
products, prices, subscriptions, invoices, payments, refunds, disputes
orders, order_items, fulfillments (faza 2 fizice)
posts, pages, media, revisions, categories, tags
runs, exports, telemetry_events, evaluator_scores
audits, webhooks, api_keys, consents, preferences
Storage: exports/<org_id>/<run_id>/... cu URL semnat; limite download & TTL.

4.9 PerformanÈ›Äƒ (pattern-uri concrete)
ISR pentru pages cu trafic mare (landing, pricing, blog index).
SSR selective (dashboard, generator, admin).
Edge caching + stale-while-revalidate; prefetch inteligent pe hover.
Image Optimization cu dimensiuni declarate; font loading display=swap.
Code-splitting pe module grele (editor, charts).
INP: handlers scurte, batching de state, evitÄƒ re-render global.

4.10 Securitate & conformitate (Ã®n arhitecturÄƒ)
OWASP ASVS L2 ca È›intÄƒ: threat modeling per epic, SAST/DAST Ã®n CI.
GDPR: minimizarea datelor, consimÈ›ÄƒmÃ¢nt granular (server-side), DSR cu SLA â‰¤ 7 zile.
PCI SAQ A-EP: tokenize plÄƒÈ›i Ã®n Stripe; niciun card pe serverele proprii.
Audit trail: tabel audits nemodificabil (trigger Ã®nainte de UPDATE/DELETE).

4.11 Observabilitate & SLO
SLO: Uptime â‰¥ 99.9%, TTFB P75 < 200ms (EU/US), LCP P75 < 2.5s, Error budget â‰¤ 0.1%/lunÄƒ.
Alerte: breÈ™Äƒ SLO pe 5/15/60 min; degrade â†’ comutÄƒ â€Simulatedâ€.
Dashboards: Revenue (MRR/NRR), Funnel, Usage (exports), Perf (RUM CWV), Incidente (MTTR/RPO/RTO).

4.12 CI/CD & rollout
Trunk-based, PR-uri cu preview Vercel, canary 5% trafic.
Release guard: build green, SAST/DAST clean, migrations aplicate, ruleset.yml OK (DoR/DoD).
Auto-revert dacÄƒ checkout CR scade >10% P7D sau erori 5xx cresc >0.5% 30 min.

4.13 Acceptance (verificabil la livrare)
/api/webhooks/stripe idempotent + DLQ È™i alerte.
exports: fiÈ™iere cu checksum SHA256 + manifest; link semnat cu TTL; watermark Ã®n trial.
RLS testat cu 3 org-uri (cross-access imposibil).
RUM activ pentru CWV; raport sÄƒptÄƒmÃ¢nal cu P75 LCP/INP/CLS per route.
Canary + auto-revert configurate; dashboard SLO live.

4.14 EvoluÈ›ii planificate
Faza 2: API public (read), webhooks out semnate, i18n, produse fizice + fulfillment.
Faza 3: cÄƒutare hibridÄƒ (BM25 + embeddings), AI-ops (joburi programate), marketplace intern.






5) Modele de Date (ERD minim) â€” Postgres + RLS (Supabase-ready)
5.1 Principii

Multi-tenant logic pe org_id; RLS â€œdeny by defaultâ€.
Chei stabile: id UUID v7, created_at/updated_at timestamptz, created_by/updated_by uuid.
Enum-uri pentru stÄƒri; JSONB doar pentru extensibilitate (metadata), nu pentru cÃ¢mpuri primare.
Integritate tranzacÈ›ionalÄƒ (FK ON DELETE â€¦), indexare pe FK + cÃ¢mpuri de cÄƒutare.
Audit trail la UPDATE/DELETE; soft-delete doar dacÄƒ e justificat de business.

5.2 Identitate & acces
users
id uuid pk, email citext unique not null, name text, avatar_url text
status user_status_enum (active, blocked, invited) default active
created_at tsz default now(), updated_at tsz
metadata jsonb default '{}'::jsonb
ğŸ”— Index: (email), (status)
RLS: select/update doar self; fÄƒrÄƒ delete direct (doar admin Ã®n org).
orgs
id uuid pk, name text not null, slug citext unique not null
plan plan_enum (free, creator, pro, enterprise) default free
status org_status_enum (active, past_due, cancelled) default active
created_at tsz, updated_at tsz, metadata jsonb
ğŸ”— Index: (slug), (plan,status)
roles
key text pk (owner, admin, editor, support, viewer)
description text
memberships
id uuid pk, org_id uuid fk -> orgs, user_id uuid fk -> users, role_key text fk -> roles.key
invited_by uuid fk -> users, created_at tsz
status membership_status_enum (active, invited, removed) default active
ğŸ”— Unique: (org_id, user_id); Index: (org_id), (user_id), (role_key)
sessions
id uuid pk, user_id uuid fk, created_at tsz, expires_at tsz, ip inet, ua text
ğŸ”— Index: (user_id, expires_at)

RLS esenÈ›ial (exemplu):

-- deny by default
alter table memberships enable row level security;

create policy org_member_can_select on memberships
for select using (
  auth.uid() = user_id
  or exists(
    select 1 from memberships m2
    where m2.org_id = memberships.org_id
      and m2.user_id = auth.uid()
  )
);

create policy org_admin_can_manage on memberships
for all using (
  exists(
    select 1 from memberships m2
    where m2.org_id = memberships.org_id
      and m2.user_id = auth.uid()
      and m2.role_key in ('owner','admin')
  )
);

5.3 Comercial: produse, preÈ›uri, stoc, cupoane
products
id uuid pk, org_id uuid fk, type product_type_enum (digital, physical, bundle)
name text, slug citext, description text, active bool default true
media_url text, metadata jsonb
ğŸ”— Unique: (org_id, slug); Index: (org_id, active, type)
variants
id uuid pk, product_id uuid fk -> products, sku citext, title text
attributes jsonb (ex: {size:"M", color:"Black"})
ğŸ”— Unique: (product_id, sku)
inventory (doar pentru fizice)
variant_id uuid pk fk -> variants, quantity int, reserved int default 0
Constraint: quantity >= reserved
prices
id uuid pk, product_id uuid fk, currency char(3), unit_amount int (Ã®n minor units), interval billing_interval_enum null
is_recurring bool, active bool default true, external_price_id text (Stripe/Paddle)
ğŸ”— Index: (product_id, active), (currency, is_recurring)
coupons
id uuid pk, org_id uuid fk, code citext, type coupon_type_enum (percent, fixed)
value numeric(6,2), currency char(3) null, max_redemptions int, redeemed int default 0
starts_at tsz, ends_at tsz
ğŸ”— Unique: (org_id, code); check: value > 0

5.4 Abonamente & plÄƒÈ›i
subscriptions
id uuid pk, org_id uuid fk, plan plan_enum, status sub_status_enum (trialing, active, past_due, canceled)
current_period_start tsz, current_period_end tsz, cancel_at tsz null, canceled_at tsz null
seat_count int default 1, external_sub_id text (Stripe)
ğŸ”— Unique: (org_id); Index: (status, plan)
invoices
id uuid pk, org_id uuid fk, external_invoice_id text, status invoice_status_enum (draft, open, paid, void, uncollectible)
currency char(3), amount_due int, amount_paid int, tax_amount int, hosted_invoice_url text
issued_at tsz, paid_at tsz null
ğŸ”— Index: (org_id, issued_at desc)
payments
id uuid pk, invoice_id uuid fk, external_payment_id text, status payment_status_enum (succeeded, failed, requires_action)
amount int, currency char(3), method text, process_at tsz
ğŸ”— Index: (invoice_id)
refunds
id uuid pk, payment_id uuid fk, amount int, reason text, created_at tsz
disputes
id uuid pk, payment_id uuid fk, status dispute_status_enum (needs_response, under_review, won, lost)
reason text, opened_at tsz, closed_at tsz null
5.5 ConÈ›inut (CMS)
posts
id uuid pk, org_id uuid fk, slug citext, title text, excerpt text, content_md mdx text
status content_status_enum (draft, review, scheduled, published)
published_at tsz null, author_id uuid fk -> users
ğŸ”— Unique: (org_id, slug); Index: (org_id, status, published_at desc)
pages
similar posts, fÄƒrÄƒ author_id, cu is_landing bool È™i template_key text
categories, tags, post_categories, post_tags
Pivot tables FK + unique (post_id, category_id) etc.
media
id uuid pk, org_id uuid fk, path text, mime text, size int, alt text
ğŸ”— Index: (org_id, mime)
revisions
id uuid pk, entity_type text (post/page), entity_id uuid, diff jsonb, created_by uuid, created_at tsz
ğŸ”— Index: (entity_type, entity_id, created_at desc)

5.6 Comenzi (shop)
orders
id uuid pk, org_id uuid fk, user_id uuid fk, status order_status_enum (pending, paid, fulfilled, canceled, refunded)
currency char(3), subtotal int, discount int, tax int, total int
shipping_address jsonb null, billing_address jsonb, placed_at tsz

ğŸ”— Index: (org_id, status, placed_at desc)
order_items
id uuid pk, order_id uuid fk, product_id uuid fk, variant_id uuid fk null
quantity int, unit_amount int, currency char(3), title text, license_key text null
fulfillments
id uuid pk, order_id uuid fk, status fulfillment_status_enum (queued, in_progress, completed, failed)
carrier text, tracking_number text, created_at tsz, completed_at tsz null
shipments
id uuid pk, fulfillment_id uuid fk, weight_grams int, cost int, currency char(3), eta date

5.7 Observabilitate & integrare
audits
id uuid pk, org_id uuid, actor_id uuid, entity text, entity_id uuid
action text (create/update/delete/export/run), diff jsonb, ip inet, ua text, at tsz default now()
Tamper-evident: hash lanÈ› (prev_hash, hash) opÈ›ional.
events (telemetrie produs)
id uuid pk, org_id uuid, user_id uuid, name text
props jsonb, ts tsz default now()
Index: (org_id, name, ts desc)
webhooks
id uuid pk, org_id uuid, source text (stripe, githubâ€¦), event text, payload jsonb, status text, received_at tsz
DLQ: retries int, last_error text
api_keys
id uuid pk, org_id uuid, name text, hashed_key text, scopes text[], created_at tsz, revoked_at tsz null
Index: (org_id, revoked_at)
consents
id uuid pk, user_id uuid, org_id uuid, purpose text (analytics, marketing), granted bool, at tsz
Index: (user_id, purpose)
preferences
id uuid pk, user_id uuid, key citext, value jsonb, updated_at tsz
Unique: (user_id, key)

5.8 RLS â€” reguli tipice per â€familieâ€
Isolare organizaÈ›ionalÄƒ: toate tabelele cu org_id au politici USING (org_id = auth.org_id()).
ConÈ›inut public: select permis pentru posts/pages cu status='published' (fÄƒrÄƒ org_id leakage).
Admin local: INSERT/UPDATE/DELETE permis doar dacÄƒ exists membership cu rol Ã®n ('owner','admin').
Exporturi sensibile: exports vizibile doar membrilor org-ului; linkuri de descÄƒrcare semnate (nu raw).

5.9 Indexare minimÄƒ (performanÈ›Äƒ)
Fiecare FK are index.
org_id + status/date pe tabele mari: subscriptions(status), invoices(issued_at), orders(status, placed_at).
CÄƒutare CMS: posts (org_id, status, published_at desc), slug unique.
Telemetrie: events (org_id, name, ts desc) cu partiÈ›ionare pe lunÄƒ dacÄƒ volumul creÈ™te.

5.10 AcceptanÈ›Äƒ (DoD)
ERD validat (ex. dbml/Diagram).
MigraÈ›ii SQL idempotente + rollback.
RLS testat cu 3 org-uri (cross-access imposibil).
Seed minim: roles, plan_prices, 1 org demo, 1 utilizator per rol.
Teste: FK/unique/enum checks, 10 scenarii CRUD (orders, subs, exports), 5 scenarii RLS negative.

5.11 Snippets utile
Enum-uri:

create type plan_enum as enum ('free','creator','pro','enterprise');
create type user_status_enum as enum ('active','blocked','invited');
create type sub_status_enum as enum ('trialing','active','past_due','canceled');
create type product_type_enum as enum ('digital','physical','bundle');
create type content_status_enum as enum ('draft','review','scheduled','published');

Trigger audit:
create or replace function audit_row() returns trigger as $$
begin
  insert into audits(org_id, actor_id, entity, entity_id, action, diff, ip, ua)
  values (new.org_id, auth.uid(), TG_TABLE_NAME, coalesce(new.id, old.id),
          TG_OP, to_jsonb(new) - 'updated_at', inet_client_addr(), current_setting('request.header.user-agent', true));
  return new;
end; $$ language plpgsql;
create trigger t_products_audit
after insert or update or delete on products
for each row execute function audit_row();
Policy publicare conÈ›inut:
create policy published_content_read on posts
for select using (
  status = 'published'
);

5.12 Trasabilitate la KPI (din Charter)
subscriptions/invoices/payments â†’ MRR, NRR, Payback, LTV/CAC.
orders/order_items/fulfillments â†’ venituri non-recurring; CR checkout.
posts/pages/media â†’ SEOâ†’Pricingâ†’Signup.
events/audits â†’ activare (first export â‰¤10m), stabilitate (error budget), conformitate (DSR).






6) Autentificare & RBAC â€” â€cine intrÄƒ, ce vede, ce poate faceâ€

6.1 Obiectiv
AsigurÄƒ login sigur È™i rapid (email/parolÄƒ + OAuth), protecÈ›ie cont (MFA + recovery codes), sesiuni robuste (revocare instant), control fin de acces (RBAC + RLS per org_id), limitare abuz (rate-limit) È™i legare dispozitiv (device binding). Totul mÄƒsurat prin SLO-uri clare.

6.2 CerinÈ›e funcÈ›ionale (resume)
SSO: email+parolÄƒ, OAuth (Google iniÈ›ial; extensibil GitHub/Apple).
MFA: TOTP (RFC 6238) + backup 10 recovery codes (one-time).
Recuperare: reset parolÄƒ via email; dezactivare MFA cu 2Ã— factori (cod recovery + link email).
Sesiuni: HTTP-only cookies; refresh rotation; revocare instant; logout all devices.
RBAC (5 roluri): owner, admin, editor, support, viewer.
Izolare date: RLS pe org_id (deny-by-default).
Rate limit & device binding: protecÈ›ie login/OTP/export; token legat de device_id.
Audit & alertare: evenimente cheie logate (auth, roles, policy denials) + alerte anomalii.

6.3 Fluxuri principale
6.3.1 Signup / Login
Signup: emailâ†’link verificare â†’ seteazÄƒ parolÄƒ â†’ (opÈ›ional) MFA on-boarding.
Login: email/parolÄƒ sau OAuth â†’ verificÄƒ MFA (dacÄƒ activ) â†’ emite session cookie + refresh.
OAuth (Google): email_verified=true necesar; altfel fallback verificare email.

6.3.2 MFA & Recovery
Enroll: afiÈ™eazÄƒ secret TOTP + QR; confirmÄƒ cu 2 coduri consecutive; genereazÄƒ 10 recovery codes.
Fallback: dacÄƒ TOTP indisponibil â†’ 1 recovery code + link confirmare pe email.
Rotate: invalidarea vechilor recovery; limitÄƒ descÄƒrcare 1Ã— (download/print).

6.3.3 Sesiuni & Revocare
Session cookie scurt (â‰¤ 8h) + refresh token (â‰¤ 30 zile).
Rotire refresh la fiecare reÃ®mprospÄƒtare (rotate-on-use); scrie Ã®n token blacklist pe revocare.
Logout all: invalideazÄƒ toate refresh tokens + marcheazÄƒ sesiuni active ca revoked.

6.3.4 InvitÄƒ Ã®n organizaÈ›ie
Owner/Admin trimite invitaÈ›ie (email, rol).
Invitatul acceptÄƒ â†’ devine member cu role_key stabilit; audit + notificare.

6.4 RBAC â€” matrice de permisiuni (rezumat)
AcÈ›iune / ResursÄƒ	owner	admin	editor	support	viewer
GestioneazÄƒ abonament/org	âœ…	âœ…	âŒ	âŒ	âŒ
InvitÄƒ/È™terge membri, schimbÄƒ rol	âœ…	âœ…	âŒ	âŒ	âŒ
CreeazÄƒ/editeazÄƒ conÈ›inut (CMS)	âœ…	âœ…	âœ…	âŒ	âŒ
RuleazÄƒ module (simulate/live)	âœ…	âœ…	âœ…	âœ…	â˜‘ read-only (simulate if gated)
Export .pdf/.json/.zip (plan gate)	âœ…	âœ…	âœ…	âŒ	âŒ
VizualizeazÄƒ telemetrie & rapoarte	âœ…	âœ…	âœ…	âœ…	âœ…
Acces API keys	âœ…	âœ…	âŒ	âŒ	âŒ

RBAC este prima barierÄƒ; RLS este ultima (aplicatÄƒ Ã®n DB).

6.5 RLS per org_id (tipare esenÈ›iale)
Isolare: USING (org_id = current_setting('app.org_id')::uuid) pentru SELECT/UPDATE/DELETE.
Inserare controlatÄƒ: WITH CHECK (org_id = current_setting('app.org_id')::uuid) pe INSERT.
Admin local: EXISTS (membership.role IN ('owner','admin')) pentru operaÈ›iuni sensibile.
Public content: excepÈ›ii doar pentru posts/pages cu status='published' (fÄƒrÄƒ scurgere de org_id).

6.6 Rate limiting (valori de start)
Login password: 5 Ã®ncercÄƒri / 10 min / IP + email.
OTP TOTP: 5 / 10 min / user.
Reset password requests: 3 / 60 min / email.
Exporturi live: 10 / zi / org (plan-dependent).
API public (faza 2): 60 req / min / key; burst 120; backoff exponenÈ›ial.
ReacÈ›ie: la depÄƒÈ™ire â†’ 429 + Retry-After + CTA upgrade (dacÄƒ e plafon de plan).

6.7 Device binding (opÈ›ional, recomandat Pro/Ent)
La login, se genereazÄƒ device_id (UUID) stocat Ã®n cookie secure separat.
Tokenul de sesiune include device_id Ã®n claims; la nepotrivire â†’ re-autentificare.
Revocare selectivÄƒ: â€logout all except this deviceâ€.

6.8 Politici parole & securitate
ParolÄƒ: min 12 caractere, pwned-passwords check, interzise patternuri simple.
Cookie: Secure, HttpOnly, SameSite=Lax, expirÄƒ la 8h; re-issue la 4h de inactivitate.
Headers: CSP strict, Referrer-Policy: strict-origin-when-cross-origin, X-Frame-Options: DENY, Permissions-Policy minimizat.
Secrete: doar server-side; niciun secret Ã®n client.

6.9 Evenimente & audit (ce logÄƒm)
auth.signup, auth.email_verified, auth.login_success/fail, auth.mfa_enrolled, auth.mfa_c hallenge_success/fail, auth.recovery_used, auth.password_reset_requested/completed,session.revoked/all, roles.changed, rls.denied, rate_limit.hit.
Payload minim: org_id, user_id, IP, UA, timestamp; fÄƒrÄƒ PII inutil.
Alerte: 5Ã— auth.login_fail Ã®n 10 min pe acelaÈ™i IP/email â†’ Slack #sec-alerts.

6.10 API & UI (puncte de contact)
API (route handlers Next.js)
POST /api/auth/signup â†’ create + email verify.
POST /api/auth/login â†’ password/OAuth callback â†’ session cookie + refresh.
POST /api/auth/mfa/enroll|verify|disable
POST /api/auth/recovery/request|use
POST /api/auth/logout (curent) / POST /api/auth/logout-all
GET /api/session (whoami + claims + orgs/roles)
POST /api/orgs/invite|accept
POST /api/orgs/members/{id}/role (owner/admin only)
UI
/login, /signup (tab OAuth + password)
/security (MFA, recovery, sessions, devices, logout all)
/org/settings (roluri, invitaÈ›ii)
Banners: enforce email verify Ã®nainte de acÈ›iuni sensibile.

6.11 Teste & acceptance (DoD pentru capitolul 6)
Autentificare:
Signup+verify+login (password & OAuth) â€” âœ…
MFA enroll+challenge+recovery â€” âœ…
Reset parolÄƒ â€” âœ…
Revocare sesiune curentÄƒ + â€logout allâ€ â€” âœ…
RBAC:
10 scenarii pozitive (owner/admin/editor/support/viewer) â€” âœ…
10 scenarii negative (escaladÄƒri, acces trans-org) â€” âœ…
RLS:
3 org-uri fictive â†’ select/update/delete cross-org imposibil â€” âœ…
Rate-limit:
login brute-force blocat; OTP flood blocat; export flood blocat â€” âœ…
Device binding: nepotrivire device_id â†’ re-login â€” âœ…
Observabilitate: evenimente Ã®n audits/events + alerte Slack la tipare anormale â€” âœ…
SLO-uri:
Login (P95) â‰¤ 400 ms; MFA challenge (P95) â‰¤ 800 ms;
Revocare token: efect â‰¤ 5 s;
Rata eroare auth < 0.5% 7-day (excluding user mistakes).

6.12 Snippets utile (indicativ)
RLS (model generic)
alter table runs enable row level security;

create policy org_isolation_select on runs
for select using (org_id = current_setting('app.org_id')::uuid);

create policy org_isolation_write on runs
for insert with check (org_id = current_setting('app.org_id')::uuid)
for update using (org_id = current_setting('app.org_id')::uuid)
for delete using (org_id = current_setting('app.org_id')::uuid);

Tabel sesiuni (minimal)
create table sessions (
  id uuid primary key,
  user_id uuid not null references users(id),
  device_id uuid not null,
  created_at timestamptz default now(),
  expires_at timestamptz not null,
  revoked boolean default false,
  ip inet, ua text
);
create index on sessions (user_id, expires_at);

Blacklist token (revocare instant)
create table token_blacklist (
  jti uuid primary key,
  user_id uuid not null,
  revoked_at timestamptz default now(),
  reason text
);

6.13 LegÄƒtura cu KPI-uri (din Charter)
Mai puÈ›in friction la login â†’ Activation â‰¤ 10 min â†’ creÈ™te Freeâ†’Paid.
MFA + RLS â†’ scade risc incident â†’ Error budget protejat â†’ uptime/Ã®ncredere â†’ NRR.
RBAC clar â†’ mai puÈ›ine tichete suport â†’ CSAT â†‘ È™i cost â†“.
Rate-limit & device binding â†’ protecÈ›ie cost (live tests/export) â†’ Payback respectat.





7) Abonamente & PlÄƒÈ›i â€” â€motorul de baniâ€ (Stripe-first)

Alegere: Stripe Billing + Stripe Tax + Stripe Checkout (primar). Lemon Squeezy/Paddle pot fi evaluate ulterior, dar MVP livreazÄƒ pe Stripe pentru acoperire globalÄƒ, taxe automate È™i API matur.

7.1 Obiective & Principii
North Star: MRR net + Payback â‰¤ 2 luni (Pro).
ArhitecturÄƒ: Hosted Checkout (minimizÄƒm PCI), Billing Portal (self-service), Stripe Tax (VAT OSS + US sales tax), Webhooks idempotente + DLQ.
Model: planuri + add-ons (seats, storage, API calls), trial pe Pro, annual = 10Ã— monthly.
Entitlements: derivate din subscriptions + plan + addons â†’ evaluate Ã®n lib/gating.ts.
Complianta: PCI DSS SAQ A-EP, facturi corecte, evidenÈ›Äƒ jurisdicÈ›ii.

7.2 Planuri & Add-ons (catalog)
Planuri
Plan	PreÈ› lunar	PreÈ› anual	Drepturi cheie
Free	â‚¬0	â€”	Simulate Test, export .txt, istoric local
Creator	â‚¬19	â‚¬190	Toate Free + export .md, module nelimitate (simulate), cloud history
Pro	â‚¬49	â‚¬490	Toate Creator + Run Real Test, export .pdf/.json, Evaluator live, RUM dashboards
Enterprise	â‚¬299 (5 seats)	â‚¬2990	Toate Pro + API, bundle.zip, seats, white-label, rate-limits extinse
Trial Pro 7 zile (watermark la export). Annual = 10Ã— lunar (discount ~17%).
Add-ons (per org)
Seats extra: â‚¬59/seat/m (Enterprise; opÈ›ional Pro).
Evaluator Advanced: â‚¬19/m.
Export Designer (brand kit PDF): â‚¬29/m.
API burst pack: â‚¬9 / +50k call-units.
Toate preÈ›urile Ã®n minor units Ã®n DB; multipli valutar gestionaÈ›i de Stripe.

7.3 Model de date & mapare Stripe
products / prices â†” Stripe Product/Price (one-to-many).
subscriptions â†” Stripe Subscription (status, current_period).
invoices / payments / refunds / disputes â†” Stripe Invoice/PaymentIntent/Charge/Refund/Dispute.
entitlements (intern): (org_id, feature, value, source) calculat la webhook invoice.paid / customer.subscription.updated.
tax_records (intern): stocÄƒm tax_breakdown din invoice.tax (jurisdicÈ›ie, rate, amounts).
Chei externe:
external_sub_id (Subscription id)
external_price_id (Price id)
external_invoice_id, external_payment_id

7.4 Fluxuri principale
1) Checkout (nou client sau upgrade)
FE: POST /api/billing/checkout cu {plan, interval, addons?, seats?}.
BE: creeazÄƒ Checkout Session (mode='subscription'), seteazÄƒ line_items (plan + addons), tax_behaviour=exclusive, allow_promotion_codes=true, success_url, cancel_url.
User plÄƒteÈ™te â†’ Stripe redirecÈ›ioneazÄƒ pe success_url.
Webhook checkout.session.completed â†’ creÄƒm/actualizÄƒm subscriptions, invoices, entitlements (proviÈ›ional).
Webhook invoice.paid â†’ confirmare finalÄƒ, emitere facturÄƒ (â‰¤5s), set plan Ã®n orgs.

2) Trial â†’ Convert
trial_period_days=7 pe Pro (Checkout).
3 emailuri automate: D-5, D-2, D-0 (Stripe + Postmark).
trial_will_end event â†’ reminder + nudge Ã®n UI (badge roÈ™u).
Conversie = invoice.paid â†’ ridicare watermark.

3) Upgrade / Downgrade / Prorratare
Upgrade imediat: creeazÄƒ SubscriptionItem nou / modificÄƒ price â†’ Stripe face prorratare Ã®n invoice prorratare.
Downgrade la final de perioadÄƒ: proration_behavior='none', cancel_at_period_end=true sau schimbare price cu proration_behavior='none'.
Seats: ajustare quantity pe SubscriptionItem per-seat.
Webhook customer.subscription.updated â†’ recalcul entitlements.

4) Failed payments & Dunning
Config Stripe Smart Retries (ex: 3, 5, 7 zile).
Email-uri: invoice.payment_failed â†’ 1h, 48h, 5 zile (link portal).
Suspendare soft (read-only, fÄƒrÄƒ export plÄƒtit) la +3 zile; cancel la +14 zile (configurabil).
Re-activare automatÄƒ la invoice.paid.

5) Anulare / Re-activare
Cancel now sau at period end (portals).
Re-activate Ã®n 6 luni â†’ pÄƒstreazÄƒ istoricul; reinstaureazÄƒ entitlements la platÄƒ.

6) Dispute / Refund / Credit
charge.dispute.created â†’ marcÄƒm disputes, reducem provizoriu NRR.
Refund: total/parÈ›ial (backoffice); reclamÄƒ internÄƒ de licenÈ›Äƒ.
Credit note: Stripe Credit Notes pentru corecÈ›ii contabile (invoices).

7.5 Webhooks (idempotent + DLQ)
Endpoint: POST /api/webhooks/stripe (route handler Next.js)
Evenimente critice:
checkout.session.completed â†’ provis entitlements
invoice.paid / invoice.payment_failed â†’ status + dunning
customer.subscription.created|updated|deleted â†’ plan + seats + addons
charge.dispute.created|closed â†’ disputes
customer.tax_id.created|updated â†’ B2B VAT
Idempotency: salvaÈ›i event.id Ã®n webhooks (unique); if exists â†’ 200 OK.
DLQ: eÈ™ec > 3 retry â†’ mutÄƒ payload Ã®n webhooks_dlq + alertÄƒ #payments-tax.

Pseudocod:

switch (event.type) {
  case 'invoice.paid':
    upsertInvoice(event.data);
    syncSubscription(event.data.subscription);
    recalcEntitlements(orgId);
    emit('billing.invoice_paid', { orgId });
    break;
  case 'invoice.payment_failed':
    flagDunning(orgId, invoiceId);
    notifyOrg(orgId, 'payment_failed');
    break;
  case 'customer.subscription.updated':
    syncSubscription(event.data);
    recalcEntitlements(orgId);
    break;
}

7.6 Entitlements & gating
RegulÄƒ: UI nu se bazeazÄƒ pe â€plan stringâ€; cheamÄƒ withEntitlementGate(flags):
const allow = withEntitlementGate({ plan, addons, isTrial, usage, feature: 'export.pdf' });
if (!allow.ok) showUpgrade(allow.reason);
Exemple:
run.live: Pro+; blocheazÄƒ dacÄƒ cost_cap depÄƒÈ™it.
export.pdf/export.json: Pro+; watermark Ã®n trial.
export.bundle_zip: Enterprise.
api.access: Enterprise + seats>=5.
rate-limit: per plan (Free < Creator < Pro < Ent).

7.7 Taxe (VAT OSS + US sales tax)
Stripe Tax: automatic_tax=enabled.
CapturÄƒ adrese la Checkout (billing + optional shipping); deducere loc/jurisdicÈ›ie.
VAT ID (US B2B): verificare VIES; reverse-charge; facturÄƒ cu menÈ›iunea obligatorie.
US: configurare nexus + excluderi (servicii digitale).
Arhivare fiscalÄƒ: pÄƒstreazÄƒ invoice_pdf, tax_breakdown Ã®n tax_records (legal 10 ani Ã®n unele jurisdicÈ›ii).

7.8 Portal & Self-service
Customer Portal activat: card management, upgrade/downgrade, cancel, extrase.
Link Manage billing Ã®n /dashboard/billing (tokenized redirect).
UrmÄƒrire credit: card expiring â†’ email proactiv.

7.9 UI/UX de platÄƒ (acceptance)
/pricing: toggle monthly/annual; carduri plan; comparaÈ›ie feature list; CTA Checkout.
/checkout/success|cancel: status clar, buton Back to dashboard.
/billing: plan curent, usage, addons, seats, facturi (link invoice PDF), tax IDs.
Empty states: la plan insuficient â†’ CTA â€Upgrade pentru â€¦â€.
Error states: fallback clar (ex: webhook down â†’ â€VerificÄƒm plata, vei primi emailâ€).

7.10 SLO & metrici operaÈ›ionale
Checkout success rate â‰¥ 98.5% (post-3DS).
Emitere facturÄƒ â‰¤ 5s de la invoice.paid.
Dunning recover rate â‰¥ 30% la 7 zile.
Dispute rate â‰¤ 0.8%.
Tax correctness = 100% (audit lunar).
Lag webhook â‰¤ 2s P95.
Dashboards:
Revenue: MRR, NRR, ARPA, churn, expansion.
Funnel plÄƒÈ›i: checkout started â†’ completed, fail reasons.
Taxe: split pe È›Äƒri/state, B2B/B2C.
Dunning: cohort reuÈ™ite.

7.11 Rate-limits & cost-guard
Run live tests: Pro 200/zi/org, Enterprise 2000/zi/org (ajustabil).
Exports: Pro 100/zi/org; Enterprise 1000/zi/org.
API calls: Pro 50k/lunÄƒ; Enterprise 500k/lunÄƒ (burst packs).
Cost cap per org (config): dacÄƒ estimarea depÄƒÈ™eÈ™te â†’ degrade la â€Simulatedâ€.

7.12 Testare (DoD pentru capitolul 7)
Contracte Stripe: test webhooks cu fixtures â†’ invoice.paid, payment_failed, subscription.updated.
Prorratare: 6 scenarii (monthlyâ†’annual, add seat, remove seat, addon on/off, mid-cycle).
Dunning: simuleazÄƒ 3 retry; verificÄƒ suspendare soft & reactivare.
Taxe: US B2C, US B2B cu VAT, US (CA/NY) â€” verify breakdown.
Dispute/Refund: 1 flux complet fiecare.
Portal: change plan + cancel at period end + re-activate.
Idempotency: retrimite 3Ã— acelaÈ™i webhook â†’ fÄƒrÄƒ duplicare DB.
Reconciliere nocturnÄƒ: stripe.subscriptions.list(status='all') â†” DB (diferenÈ›e = alert).

7.13 Backoffice & reconciliere
/admin/billing: cÄƒutare org, status subs, seats, addons, facturi, dispute, export CSV.
Reconciliere zilnicÄƒ (cron/queue): comparÄƒ Stripe vs DB (subs/invoices/payments), reparÄƒ discrepanÈ›e, log â€diff_reportâ€.
Credit notes: generare din admin (cu reason), ataÈ™are la invoice.
Raport fiscal: export lunar pe È›Äƒri/state; TVA colectat; reverse-charge.

7.14 Edge cases & politici
Fraud 3DS: fallback cu 3DS; dacÄƒ requires_action eÈ™ueazÄƒ â†’ instruct user Ã®n UI.
Card expirate: pre-expiring emails; grace 7 zile.
Downgrade ce ar Ã®ncÄƒlca entitlements: anunÈ›Äƒ clar ce se pierde; aplicÄƒ la EoP.
Multiple subscriptions per org: interzis (unique constraint).
Multi-brand: un customer Stripe per org (evitÄƒ coliziuni cross-brand).
Refund policy: clarÄƒ Ã®n ToS (ex: 7 zile pentru erori de facturare).

7.15 InterfeÈ›e API (server)
POST /api/billing/checkout â†’ returneazÄƒ checkout_url.
GET /api/billing/portal â†’ redirect secure la portal.
POST /api/billing/seats â†’ {op: 'add'|'remove', qty} (owner/admin).
POST /api/billing/addons â†’ [{addon, op, qty?}].
GET /api/billing/invoices â†’ list + links.
POST /api/webhooks/stripe â†’ procesare evenimente (idempotent).

7.16 Trasabilitate KPI (din Charter)
Freeâ†’Paid CR, MRR, NRR, Payback: planuri/gates/portal â†’ upgrade vizibil.
Checkout success: >98.5% â†’ mai puÈ›ine pierderi pe â€ultima milÄƒâ€.
Tax correctness 100% â†’ risc legal zero, timp salvat.
Dunning recover â†’ protejeazÄƒ MRR, scade churn.

Verdict practic
Stripe end-to-end, hosted flows, webhooks robuste, entitlements deterministe È™i backoffice cu reconciliere automatÄƒ.
DacÄƒ webhook-urile cad, nu blocÄƒm Ã®n UI: afiÈ™Äƒm â€Plata Ã®n procesareâ€¦â€ È™i rulÄƒm reconciliere la 5 min.
DacÄƒ checkout CR scade >10% P7D â†’ auto-revert ultimul change (guardrail comercial).







8) Shop (B2C/B2B) â€” digital-first, fizic la faza 2

8.1 Obiectiv & KPI
Obiectiv: vÃ¢nzare sigurÄƒ È™i rapidÄƒ de produse digitale (licenÈ›e, fiÈ™iere, bundle) È™i, la faza 2, produse fizice.
KPI comerciale: CR checkout â‰¥ 2.5%, AOV â†‘, refund rate â‰¤ 2%, timp â€add-to-cart â†’ paidâ€ P95 â‰¤ 90s.
KPI tehnice: TTFB P75 < 200ms, LCP P75 < 2.5s, erroare 5xx < 0.2%.

8.2 Tipuri de produse
Digitale (MVP): licenÈ›e, template-uri, fiÈ™iere (.txt/.md/.pdf/.json/.zip), chei/links semnate, limitÄƒ descÄƒrcÄƒri.
Fizice (faza 2): SKU + greutate, dimensiuni, transportator, tracking.
Bundle: agregÄƒ produse (digital/fizic), preÈ› pachet, reguli combinatorii.

8.3 Catalog & prezentare
Modelare: products (digital/physical/bundle) â†’ variants (SKU, atribute) â†’ prices (currency, recurring?=false pentru shop).
Filtre & sortÄƒri: categorie, tag, preÈ›, tip, popularitate; sortare: recomandate, cele mai noi, preÈ› â†‘/â†“.
PreÈ›uri localizate: Stripe Prices pe valute (afiÅŸare Ã®n funcÈ›ie de geo/IP + preferinÈ›e user).
SEO Product: schema.org/Product + Offer; URL stabil: /shop/<slug>; imagini optimizate, OG/Twitter Cards.

8.4 PromoÈ›ii & preÈ›uri
Cupoane: percent/fixed, per org, perioadÄƒ, max redemptions, stacking off.
Cart rules: minim comandÄƒ, segment (plan, È›arÄƒ), prima comandÄƒ.
Volume pricing: preÈ›uri pe cantitate (variants).
Gift code / vouchere (opÈ›ional P1): emitere, sold, expirare.

8.5 CoÈ™ & Checkout
Cart UX: 1-page, persistent (cookie + server), guestâ†’account Ã®n pasul final.
Adrese & taxe: capturÄƒ billing (obligatoriu), shipping (fizice), Stripe Tax pentru calcul Ã®ntimp real.
PlatÄƒ: Stripe Checkout (Hosted) cu 3DS, Apple/Google Pay, cupon vizibil, Terms & Refund link.
Upsell/downsells: recomandÄƒri post-add-to-cart & Ã®n confirmation (cross-sell digital).
State: success / pending (webhook Ã®n tranzit) / failed cu motive.

8.6 Fulfillment
Digital (MVP)
Livrare: dupÄƒ invoice.paid â†’ generezi link semnat (S3) per item; TTL default 7 zile; max N descÄƒrcÄƒri (ex: 5).
LicenÈ›e: generare license_key (UUIDv4 sau pattern propriu) + validare la download.
Anti-abuz: rate-limit download (IP+org), revoke pe refund/dispute, watermark PDF (opÈ›ional).
Fizic (faza 2)
Transportatori: field carrier + tracking_number; webhook la status schimbat.
Pick/Pack/Ship: status fulfillments: queued â†’ in_progress â†’ completed â†’ failed.
EstimÄƒri cost & ETA: simplu (tabel greutateÃ—zonÄƒ) sau integrare 3PL.

8.7 Politici & returnÄƒri
Digital: â€nerefundabilâ€ by default; excepÈ›ii pentru erori de facturare (credit note/refund).
Fizic: fereastrÄƒ retur (ex: 14 zile), condiÈ›ii, flux RMA.
Dispute: marcare item ca â€lockedâ€, revocÄƒ acces download; reacÈ›ii Ã®n 48h.

8.8 Admin & backoffice
Catalog: CRUD produse/variante/preÈ›uri, activ/inactiv, preview.
PromoÈ›ii: cupoane, reguli de coÈ™, limitÄƒri segment.
Comenzi: listare, filtrare, statut, re-emitere linkuri digitale, re-trimitere email download.
Fizic: picking list, AWB, tracking; costuri transport.
Rapoarte: vÃ¢nzÄƒri pe produs/È›arÄƒ, conversii, cupoane utilizate, top bundle.

8.9 Email & notificÄƒri (Post-purchase)
Digital: â€Order confirmedâ€ + â€Your downloadsâ€ (linkuri cu TTL), â€Download expiringâ€ (D-1).
Fizic: â€Order shippedâ€ + tracking, â€Deliveredâ€ (feedback).
Failover: dacÄƒ webhook down â†’ â€Plata Ã®n procesareâ€; reconcilieri la 5 min.

8.10 Securitate & conformitate (shop)
PCI SAQ A-EP (Hosted Checkout), fÄƒrÄƒ card data on-prem.
Linkuri semnate pentru download; anti-hotlink; contorizare descÄƒrcÄƒri.
GDPR: minim PII; adrese pÄƒstrate strict pentru taxe/transport; drept de È™tergere.
Audit trail: create/update/delete product, change price, coupon create/apply, download events.

8.11 Integrare cu abonamente & entitlements
Cross-gating: achiziÈ›ia de bundle poate activa temporar entitlements (ex: Export Designer 30 zile).
Plan awareness: utilizatorii Pro/Ent primesc reduceri sau extra descÄƒrcÄƒri.
LicenÈ›e enterprise: seat-bound (N chei per org), audit utilizare.

8.12 API & webhooks (intern)
API (server):
GET /api/shop/products?filtersâ€¦ (public cacheable)
POST /api/shop/cart (add/remove/update)
POST /api/shop/checkout â†’ Stripe Checkout Session
GET /api/shop/orders (auth)
GET /api/shop/orders/{id}/downloads (signed links)
Webhooks:
invoice.paid â†’ order.paid (creare fulfillments)
charge.refunded|dispute.created â†’ revoke downloads/lock

8.13 PerformanÈ›Äƒ & SEO (shop)
Edge caching pentru pagini produs, listÄƒri; revalidate la update.
Imagini: next/image, dimensiuni declarate, AVIF/JPEG, lazy.
Prefetch inteligent (hover pe card produs).
CWV: LCP < 2.5s (hero/galerie), INP < 200ms (cart actions), CLS < 0.1.
Schema.org: Product + AggregateRating (cÃ¢nd existÄƒ), Offer (price, availability).

8.14 Testare & acceptanÈ›Äƒ (DoD)
Fluxuri: add-to-cartâ†’checkoutâ†’webhookâ†’download (digital), refund/dispute, limitÄƒ descÄƒrcÄƒri, expirare link.
PromoÈ›ii: cupoane valide/expirate/max redemption, stacking blocat.
Taxe: EU B2C, EU B2B (VAT ID), US CA/NY â€” breakdown corect.
Anti-abuz: download flood â†’ rate-limit + log; partajare link â†’ invalidare.
Perf: P75 TTFB/LCP ok pe /shop È™i /shop/<slug>.
SEO: validare schema.org, sitemap entries, canonical.

8.15 Roadmap incremental
P0 (MVP digital): catalog, cupon, 1-page checkout, linkuri semnate, limitÄƒ descÄƒrcÄƒri, rapoarte de bazÄƒ.
P1: bundle avansat, gift codes, recomandÄƒri ML-naive (co-occurrence), upsell Ã®n confirmation.
P2 (fizic): inventar, transportatori, tracking, RMA; costuri dinamice; 3PL opÈ›ional.

8.16 Trasabilitate KPI (â†’ Charter)
CR checkout, AOV, MRR non-recurring, refund â‰¤2%, Tax correctness 100%, timp add-to-cartâ†’paid â‰¤90s.
Perf/CWV susÈ›in SEO â†’ trafic â†’ conversie; audit trail protejeazÄƒ revenue.






9) CMS & Blog â€” â€publicÄƒ repede, sigur, SEO-corectâ€

9.1 Obiectiv & KPI
Obiectiv: pipeline de conÈ›inut care alimenteazÄƒ SEO, pricing È™i conversia Ã®n abonamente/vÃ¢nzÄƒri.
KPI: timp draftâ†’publish â‰¤ 24h P90, CR organicâ†’pricing â‰¥ 6%, erori build <0.2%, acoperire alt-text = 100%, sitemap valabil 100%.

9.2 Tipuri de conÈ›inut (schemÄƒ minimÄƒ)
post (blog): titlu, slug, excerpt, content_mdx, cover, categories[], tags[], status (draft/review/scheduled/published), published_at, author_id, canonical_url?, og_image?, noindex?
page (static/landing): titlu, slug, blocks JSON (hero/faq/cta/pricingâ€¦), template_key, status, published_at
docs (documentaÈ›ie/API): slug ierarhic (/docs/:section/:page), sidebar_order, version?
changelog: versiune, data, â€Added/Changed/Fixed/Securityâ€ (MDX), linkuri PR
media: path, mime, dimensiuni, alt obligatoriu, focal point, licenÈ›Äƒ
redirects: from, to, code (301/302), expires_at?
Toate entitÄƒÈ›ile au: org_id (dacÄƒ multi-brand), created_at/updated_at, created_by/updated_by, revisions.

9.3 Editor & UX autor
Editor MDX/Blocks:
MDX cu componente whitelisted: <Callout>, <Table>, <Code>, <Accordion>, <Video>, <Image> (responsiv + lazy)
Blocks builder (landing/docs) cu set minim: Hero, Section, Grid, CTA, FeatureList, Testimonial, FAQ, Pricing
Asistare la scriere: â€Read-timeâ€, numÄƒr headinguri, densitate intern-links (min 3), linter SEO (H1 unic, H2+ coerent, meta description 120â€“160)
OG generator (fallback automat din H1 + cover)
Media library:
Ã®ncÄƒrcare drag-drop, cropper (ratios: 1.91:1, 1:1, 1200Ã—630), focal point
deduplicare hash, optimizare (AVIF/JPEG), alt obligatoriu (nu salveazÄƒ fÄƒrÄƒ)
Snippets reutilizabile: â€legal disclaimerâ€, â€CTA universalâ€, â€author bioâ€
Preview instant (route privatÄƒ cu token, expirÄƒ la 30min)

9.4 Workflow & versionare
StÄƒri: draft â†’ review â†’ approved â†’ scheduled â†’ published â†’ (rollback)
Review gates:
Design gate (contrast, accesibilitate, layout breakpoints)
SEO gate (title â‰¤ 60, meta â‰¤ 160, H1 unic, internal links â‰¥ 3, schema validÄƒ)
Legal gate (no PII / claims sensibile)
Scheduling: cron din server; â€missed scheduleâ€ auto-recuperare la urmÄƒtorul tick
Revisions: diffs per cÃ¢mp, restore versiune, comentarii la paragraf (inline notes)

9.5 Generare & livrare (Next.js)
ISR/SSG pentru post/page/docs; SSR doar unde e necesar (dashboard).
Revalidare finÄƒ: la publish/update â†’ invalideazÄƒ exact rutele afectate (post, category, index, sitemap, RSS)
Assets: next/image cu dimensiuni declarate; srcset automat
Performance: code-splitting pentru editor, lazy pentru media grea; prefetch pe hover pentru linkuri interne

9.6 SEO tehnic (by default)
Schema.org: Article, BlogPosting, BreadcrumbList, FAQPage (dacÄƒ block-ul este FAQ), Product pe landing pricing
URL & canonical: slug scurt, stabil; rel=canonical setat; trailing slash politicÄƒ unicÄƒ
hreflang & i18n: cÃ¢nd existÄƒ localizÄƒri â†’ x-default + perechi corecte
OpenGraph/Twitter Cards: og:title/description/image; twitter:summary_large_image
Robots & sitemaps: robots.txt generat, sitemap index + sitemaps per secÈ›iune (blog/docs/pages); RSS/Atom (blog)
Links interne: generator de â€Related postsâ€ (BM25 simplu pe tags/categorii)

9.7 CÄƒutare & indexare
Index incremental:
La publish/update â†’ trimite payload minimal Ã®n Algolia/OpenSearch: title, slug, excerpt, headings[], tags[], lang, popularity score
Stop-words & synonyms (EN/RO); typo tolerance
Preview indexing guard: noindex pentru draft/review
404 inteligent: sugereazÄƒ 3 rezultate apropiate + link Ã®napoi

9.8 Acces, RBAC & RLS
RBAC:
editor/admin/owner: CRUD pe conÈ›inut
support: poate edita changelog È™i FAQ
viewer: read-only
RLS: conÈ›inut published acces public; altfel vizibil doar membrilor org-ului
Locks: cÃ¢nd un editor deschide un document â†’ lock optimistic 15min

9.9 GuvernanÈ›Äƒ & politici
Alt-text obligatoriu; imagini fÄƒrÄƒ alt â†’ build eÈ™uat (hard fail)
Outbound links: deschidere Ã®n nou tab, rel="noopener noreferrer", broken link checker Ã®n CI
PII guard: linter blocheazÄƒ email/telefon Ã®n corp dacÄƒ nu e whitelisted
LicenÈ›e media: cÃ¢mp obligatoriu; avertismente la â€unknownâ€

9.10 Telemetrie & mÄƒsurare
Events: content.view, content.read_complete (scroll depth 75% + min time), content.cta_click, content.share, content.search
KPIs: CTR din â€related postsâ€, rata bounce per categorie, organicâ†’pricing CR, timp mediu pe paginÄƒ, % pagini cu schema validÄƒ
Rapoarte: sÄƒptÄƒmÃ¢nal index nou, cele mai citite, cele mai convertibile, pagini lente (CWV), erori build

9.11 InterfeÈ›e API (server)
GET /api/content/posts?status=published&lang=ro&tag=â€¦ (cacheable, SWR)
POST /api/content/post (create) / PUT /api/content/post/:id (update) â€” RBAC
POST /api/content/publish|schedule|rollback
POST /api/content/preview (link temporar)
POST /api/revalidate (secure) â€” rute afectate
GET /api/sitemap.xml, GET /api/rss.xml

9.12 Build & CI
Lint SEO/accesibilitate pe PR (axe + reguli custom)
Test linkuri (intern/extern) + imagini lipsÄƒ
MDX type-check (component props whitelisted)
Previews Vercel pentru fiecare PR; check â€Publishabilityâ€ (gates)

9.13 AcceptanÈ›Äƒ (DoD pentru capitolul 9)
Editor funcÈ›ional (MDX + Blocks), preview live, media library cu cropper
Workflow complet cu review gate (design/SEO/legal) È™i programare
Versionare cu rollback la o versiune anterioarÄƒ
SEO valid: schema, OG/Twitter, canonical, hreflang (dacÄƒ i18n)
Sitemaps + RSS valide; redirects funcÈ›ionale
CÄƒutare: index incremental; rezultate relevante la 3 interogÄƒri test
Perf: P75 LCP < 2.5s pe post/page/docs; CLS < 0.1
Accesibilitate: axe score â€no serious/criticalâ€
Telemetrie: events apar Ã®n dashboard; raport sÄƒptÄƒmÃ¢nal generat

9.14 Roadmap incremental
P0: blog + pages + changelog, MDX, preview, sitemaps/RSS, schema, basic search
P1: docs cu sidebar & versiuni, Blocks landing, linter SEO avansat, related posts mai bun
P2: colaborare real-time (CRDT), A/B test headlines, content experiments cu auto-revert dacÄƒ CR scade

9.15 Trasabilitate KPI (â†’ Charter)
Draftâ†’Publish â‰¤24h È™i acoperire SEO corectÄƒ â†’ creÈ™te Organicâ†’Pricing È™i Freeâ†’Paid
CWV bune pe conÈ›inut â†’ rank & trafic stabil â†’ MRR indirect
Changelog/Docs -> mai puÈ›ine tichete â†’ CSAT â†‘ È™i cost suport â†“






10) InternaÈ›ionalizare â€” i18n UI + i10n preÈ›uri/date/valute, SEO corect

10.1 Obiectiv & KPI
Obiectiv: experienÈ›Äƒ nativÄƒ pe pieÈ›e diferite (UI, conÈ›inut, preÈ›uri, formatÄƒri), fÄƒrÄƒ a rupe SEO.
KPI: P75 TTFB < 200 ms pe toate localele; hreflang valid 100%; fallback rate UI < 2%; % pagini traduse â‰¥ 90% pe locale active; checkout CR fÄƒrÄƒ diferenÈ›e > Â±5% Ã®ntre locale.

10.2 Locale suportate (fazaÈ›i)
P0: ro-RO, en-US.
P1: de-DE, it-IT (pe baza traficului/cererii).
Reguli: fiecare locale are state: draft | partial | live. Doar live apare Ã®n selector È™i Ã®n hreflang.

10.3 Strategia URL & rutare
Prefix per limbÄƒ: /{locale}/â€¦ (ex: /en/pricing, /ro/blog).
Default locale: 301 â†’ /en/ (configurabil).
Canonical & hreflang: setate pe fiecare paginÄƒ:
link rel="alternate" hreflang="en" href="â€¦/en/â€¦", hreflang="ro", hreflang="x-default".
Redirecturi: dacÄƒ pagina nu existÄƒ Ã®ntr-un locale, 302 â†’ fallback (cu banner â€œtranslated from â€¦â€).

10.4 Content negotiation & detecÈ›ie
PreferinÈ›Äƒ utilizator: cookie pf_locale dacÄƒ a ales manual.
DetecÈ›ie iniÈ›ialÄƒ: Accept-Language + IP geo â†’ doar pentru prima vizitÄƒ (soft-redirect, non-blocant).
PersistenÈ›Äƒ: alegerea manualÄƒ bate auto-detectul.

10.5 i18n UI (interfaÈ›Äƒ)
Format: ICU MessageFormat (plural, gender), fiÈ™iere messages.{locale}.json.
Chei stabile; lint pentru chei lipsÄƒ/unused; build fail dacÄƒ lipseÈ™te cheie criticÄƒ.
Fallback: en-US â†’ afiÈ™Äƒm badge mic â€œEN fallbackâ€ Ã®n dev/preview, logÄƒm metricÄƒ i18n.fallback.hit.
Data/time/numere: Intl.DateTimeFormat, Intl.NumberFormat (per-locale);
â€“ ex: formatCurrency(amount, currency, locale) cu mapare Stripe prices.
Timezone-aware: afiÈ™Äƒri relative folosind TZ browser; server-side Ã®n UTC.

10.6 i10n preÈ›uri/valute/taxe
PreÈ›uri: multiple Stripe Price per valutÄƒ; selectÄƒm preÈ›ul potrivit per localÄƒ/geo.
AfiÈ™are: valuta localÄƒ dacÄƒ existÄƒ; altfel principalÄƒ (EUR/USD) + etichetÄƒ â€œâ‰ˆ convertedâ€.
Taxe: Stripe Tax calculeazÄƒ din adrese; UI aratÄƒ subtotal + taxÄƒ + total cu localizare numericÄƒ.

10.7 Contenut (CMS) & traduceri
Modelare: cÃ¢mpurile translatabile au tabel copil *_i18n:
posts â†’ post_i18n(post_id, locale, title, excerpt, content_mdx, slug_localized, seo_metaâ€¦).
StÄƒri pe traducere: missing | machine | human_review | approved.
Workflow:
Autor creeazÄƒ Ã®n locale sursÄƒ (ex: en-US).
Pre-traducere (machine) â†’ status machine.
Editor local verificÄƒ â†’ human_review â†’ approved.
Publish: doar approved intrÄƒ Ã®n sitemap/hreflang.
Glosar & stil: fiÈ™ier i18n/glossary.{locale}.md + tone.md pe È›arÄƒ (evitÄƒm inconsecvenÈ›e).
Media/OG: texte alternative per localÄƒ; OG-title/desc traduceri dedicate.

10.8 Selector de limbÄƒ & UX
ComponentÄƒ: Ã®n header + footer; mereu vizibilÄƒ.
AratÄƒ doar localele live; fallback cu modal dacÄƒ utilizatorul vine din altÄƒ limbÄƒ majorÄƒ (oferÄƒ switch).
Deep-link cross-locale: /en/page â†” /ro/page (pÄƒstreazÄƒ ruta cÃ¢nd existÄƒ traducere), altfel anunÈ›Äƒ fallback.

10.9 SEO i18n
hreflang complet (inclusiv x-default).
Sitemap per localÄƒ + sitemap index; fiecare URL indicÄƒ alternate.
Canonical corect Ã®n cadrul aceleiaÈ™i limbi; fÄƒrÄƒ duplicat cross-locale.
Slug-uri localizate (slug_localized); redirect 301 dacÄƒ se schimbÄƒ.
Noindex pentru pagini non-approved sau partial.

10.10 E-mailuri & tranzacÈ›ional
È˜abloane pe limbÄƒ: emails/{locale}/â€¦ cu fallback en-US.
Event-driven: la trimitere, determinÄƒ locale din preferinÈ›e/org; pentru invitaÈ›i â†’ Accept-Language din invitaÈ›ie.
ConÈ›inut legal (ToS/Privacy): versiune/limbÄƒ corectÄƒ, linkatÄƒ din emailuri.

10.11 RBAC, RLS & permisiuni
RBAC editorial: traducÄƒtorii au rol editor_{locale} cu acces doar la *_i18n din localÄƒ.
RLS: separÄƒ conÈ›inutul pe org_id (multi-brand) + locale; published rÄƒmÃ¢ne public.

10.12 Monitorizare & telemetrie
Events: i18n.fallback.hit, i18n.locale_switch, i18n.missing_key, i18n.machine_to_human, i10n.price_currency_mismatch.
Dashboards: % trafic per localÄƒ, % conÈ›inut aprobat, CR per localÄƒ, erori hreflang, rate fallback.
Alerte: hreflang invalid Ã®n crawler, missing_key > 20/zi, diferenÈ›Äƒ CR > Â±5% Ã®ntre locale 7 zile.

10.13 PerformanÈ›Äƒ
Edge caching per-limbÄƒ (vary by locale), Cache-Control corect.
Bundle splitting: Ã®ncÄƒrcÄƒm doar messages.{locale}.json necesar.
Prefetch linkuri interne pe aceeaÈ™i localÄƒ; nu prefetch cross-locale.

10.14 Teste (DoD pentru i18n)
Unit: formatÄƒri Intl, selectare price per valutÄƒ; slug builder.
Contract: sitemap/hreflang pentru 3 pagini (home, pricing, blog post).
E2E: switch limbÄƒ pÄƒstrÃ¢nd ruta; publish traducere â†’ apare Ã®n sitemap/hreflang; fallback banner pe pagini lipsÄƒ.
Accessibility: citire corectÄƒ RTL dacÄƒ vom adÄƒuga locale RTL (future-proof).
SEO lint: verificare automatÄƒ alternate + canonical per paginÄƒ.

10.15 Operare
Cadenta: revizie lunarÄƒ de localizare (top-20 pagini traffic).
Prioritizare: Ã®ntÃ¢i pricing/landing/docs critice; apoi blog evergreen.
SLA traduceri: machine â‰¤ 1h; human review â‰¤ 72h; urgent (lansÄƒri) â‰¤ 24h.
Memorie de traduceri: export/import TMX (pentru continuitate dacÄƒ schimbÄƒm furnizorul).

10.16 InterfeÈ›e API
GET /api/i18n/locales â†’ listeazÄƒ locale live + percent coverage.
GET /api/i18n/messages?locale=ro-RO â†’ pachet UI (cacheable).
POST /api/i18n/translate (internal) â†’ creeazÄƒ task de traducere (machine) + status.
POST /api/i18n/approve â†’ marcheazÄƒ ca aprobat (RBAC required).
POST /api/revalidate â†’ invalideazÄƒ rutele localizate.

10.17 Trasabilitate KPI (â†’ Charter)
hreflang corect + conÈ›inut local â†’ creÈ™tere Organic pe pieÈ›e + CR pricing stabil.
i10n preÈ›uri reduce fricÈ›iune la checkout â†’ Freeâ†’Paid â†‘.
Fallback scÄƒzut È™i latency mic pe toate localele â†’ NRR È™i brand trust.






11) UX & Design System â€” â€un singur limbaj vizual, fÄƒrÄƒ excepÈ›iiâ€

11.1 Obiectiv & KPI

Obiectiv: interfaÈ›Äƒ coerentÄƒ, accesibilÄƒ, rapidÄƒ, care converteÈ™te.

KPI:
P75 LCP < 2.5s, INP < 200ms, CLS < 0.1;
WCAG 2.2 AA â€“ 0 erori critice/serioase pe axe;
CR landingâ†’pricing â‰¥ 35%, pricingâ†’signup â‰¥ 7%;
timp â€primul exportâ€ â‰¤ 10 min (din UX flow, nu doar tehnic).

11.2 Design tokens (singura sursÄƒ de adevÄƒr)
Format recomandat: tokens.json â†’ build pentru Tailwind/React (CSS vars).
Culori (semantic-first)
Background: --bg-primary, --bg-secondary, --bg-elevated
Foreground: --fg-primary, --fg-secondary, --fg-muted
Accent (brand): --accent, --accent-foreground
Status: --success, --warning, --danger, --info
Border: --border, --ring
States: --hover, --active, --disabled
Dark/light: mapare automatÄƒ (media/prefers-color-scheme) + toggle manual (persistÄƒ Ã®n localStorage).
Tipografie
Font families: --font-sans, --font-mono
Scale: --text-xs/sm/base/lg/xl/2xl/3xl/4xl (valori REM), leading/letter-spacing preset
DensitÄƒÈ›i: --line-compact (1.2), --line-normal (1.5)
SpaÈ›ii & radius
Spacing: --space-1..8 (4px grid), container widths (xsâ€¦7xl)
Radius: --radius-xs/sm/md/lg/full
Shadow: --shadow-1/2/3 (elevaÈ›ii consistente)
Z-index & layout
Layers: --z-header, --z-modal, --z-toast, --z-drawer
Container: max-w-prose pentru content, max-w-7xl pentru dashboard
Regula: componentele folosesc doar tokeni semantic; niciun hex Ã®n CSS.

11.3 Componente canonice (UI kit)
Toate livrate ca Headless + Skins (stil separat), cu stÄƒri focus/aria.
Nav (Header + Mobile Drawer): logo, nav primar, CTA, selector limbÄƒ/temÄƒ.
Hero (Landing): titlu, sub, bullet value, CTA dual (primar/secundar), proof (badges).
Card: header, body, footer, suport pentru â€selectable/pressableâ€.
Table (DataTable): head sticky, sort/filter, empty state, paginare accesibilÄƒ.
Form: input, select, checkbox/radio, switch, fieldset cu descriere/eroare; aria-describedby.
Modal/Dialog: focus trap, esc, role dialog, aria-labelledby/aria-describedby.
Stepper (flows multi-pas: Generate â†’ Test â†’ Export): persistÄƒ progres, permite back fÄƒrÄƒ pierdere.
Toast/Inline Alert: role=alert, auto-dismiss cu pauzÄƒ la hover.
Empty/Error/Skeleton: icon, titlu, explicaÈ›ie, CTA; skeleton cu lÄƒÈ›imi/Ã®nalÈ›imi declarate.
Tabs/Accordion: keyboard-first, aria-controls, roving tabindex.
Badge/Tag: semantic (plan, status), truncare la overflow.
Telemetry Badge: run_id, score, duration, status (simulated/live) â€“ compact.
Pricing Matrix: comparÄƒ planuri; sticky CTA; col res-friendly; plan recomandat evidenÈ›iat.
Pentru fiecare: stÄƒri (default/hover/active/focus/disabled/error/loading), dimensiuni (sm/md/lg), variante (primary/secondary/ghost).

11.4 Accesibilitate â€” WCAG 2.2 AA (non-negociabil)
Contrast: min 4.5:1 text normal, 3:1 large. Verificare automatÄƒ Ã®n CI.
Focus states vizibile: ring semantic (nu doar culoare), ordine tab logicÄƒ.
ARIA corect: landmarkuri (header/nav/main/aside/footer), roluri, etichete pentru form.
Keyboard-first: orice interacÈ›iune esenÈ›ialÄƒ se poate face de pe tastaturÄƒ.
Motion: respectÄƒ prefers-reduced-motion; fÄƒrÄƒ parallax greoi; tranziÈ›ii â‰¤ 150ms.
Ergonomie mobil: È›inte â‰¥ 44Ã—44px; spaÈ›iere suficientÄƒ; safe-areas.

11.5 Motion & micro-interacÈ›iuni
Timings: enter 120â€“150ms, exit 90â€“120ms; easing standardizate (in/out).
Feedback: butoanele au â€press feedbackâ€ (scale subtil), toasts la acÈ›iuni asincrone.
Transitions: evitÄƒ animarea layout-urilor mari; animÄƒ opacitate/transform.

11.6 Pattern-uri UX critice (legate de KPI)
Landing â†’ Pricing â†’ Signup: CTA sticky, secÈ›iune â€œWhy Pro/Enterpriseâ€, sociale/dovezi.
Onboarding scurt: 3 paÈ™i max â€“ alege modul â†’ set 7D â†’ ruleazÄƒ â€Simulateâ€ â†’ CTA â€Run Real Testâ€.
Empty states: explicÄƒ urmÄƒtorul pas (buton direct cÄƒtre acÈ›iunea valoroasÄƒ).
Error states: limbaj clar, fÄƒrÄƒ coduri brute; oferÄƒ â€Try againâ€ sau â€Contact supportâ€.
Upgrade gates: paginÄƒ/overlay cu listÄƒ beneficii, preÈ›, â€continue where you left offâ€ dupÄƒ platÄƒ.
Download flow: buton clar, format + mÄƒrime, notÄƒ checksum, info watermark Ã®n trial.

11.7 Sistem de iconografie & ilustraÈ›ii
Icon set coerent (24px grid); prefer vector mono; semantice (success/warning/danger).
IlustraÈ›ii: greutate micÄƒ (SVG/PNG optimizat), stil consistent; nu blocheazÄƒ LCP.

11.8 Redlines & documentare
Fiecare componentÄƒ are pagina de spec: props, state, exemple, cod, redlines (margini, spacing, radius), capcane.
Storybook cu controls; a11y addon; vizual regresion (Chromatic/Playwright screenshots).

11.9 Theming & branduri multiple
Theme tokens per brand (overrides pe accent/og-image, nu pe bazele de contrast).
Suport white-label (Enterprise): favicon/logo/color-accent override, export PDF cu brand-kit.

11.10 Integrare tehnicÄƒ (Next.js + Tailwind)
CSS vars la :root + [data-theme="dark"].
Tailwind config mapeazÄƒ cÄƒtre vars (ex: colors.bg = var(--bg-primary)).
Avoid stiluri inline/hex; foloseÈ™te clase utilitare standardizate.
Server Components: minimizeazÄƒ client bundles; componente interactive doar unde necesar.

11.11 Calitate vizualÄƒ pe mobil
Grid fluid (12 col desktop â†’ 4 col tablet â†’ 1 col mobil), fÄƒrÄƒ orizontal scroll.
Imagery: sizes corect; priority doar pentru hero.
CTAs: mari, deasupra fold-ului; â€thumb reachâ€ pentru acÈ›iuni frecvente.

11.12 Telemetrie UX
Evenimente: ui.cta_click, ui.stepper_next, ui.error_view, ui.empty_cta, ui.upgrade_view/accept, ui.download_click, ui.accessibility_fallback.
Dashboard: funnel pe CTA-uri, heat de erori UI, drop-off pe stepper, clicks pe upgrade gates.

11.13 QA vizual & accesibilitate (checklist DoD)
Contrast AA verificat (axe ci + raport salvat).
Focus order corect, fÄƒrÄƒ â€tab trapsâ€.
â€Skip to contentâ€ prezent.
alt complet la 100% imagini.
Nicio sÄƒriturÄƒ layout (CLS < 0.1) la H, W, aspect ratios.
Trei mÄƒrimi ecran testate: 360Ã—740, 768Ã—1024, 1440Ã—900.
Storybook: toate componentele cu stÄƒri (loading/error/disabled).

11.14 Anti-regresie & guvernare
Design Lint (Figma) + Lint CSS (tokens-only) Ã®n CI.
PR Template: secÈ›iune â€Affected components/tokensâ€.
Visual Regression la rutele critice (landing, pricing, generator, dashboard, billing).

11.15 AcceptanÈ›Äƒ (DoD pentru capitolul 11)
tokens.json + build â†’ CSS vars Ã®n producÈ›ie (dark/light auto + toggle).
12+ componente canonice implementate cu stÄƒri & exemple Storybook.
Axe: 0 critical/serious, Lighthouse Accessibility â‰¥ 95 pe 3 rute.
CWV Ã®n RUM: P75 LCP/INP/CLS sub È›intele date, pe desktop & mobil.
Empty/Error/Gates implementate conform pattern-urilor; upgrade flow mÄƒsurat.
DocumentaÈ›ie Ã®n /docs/design-system/* + link Storybook live.

11.16 Trasabilitate KPI (â†’ Charter)
Tokens + componente â†’ vitezÄƒ de livrare + consistenÈ›Äƒ â‡’ TTV â‰¤ 10m, CR mai mare.
A11y + CWV bune â‡’ SEO, bounce mic â‡’ trafic & conversie.
Gates UX curate â‡’ Freeâ†’Paid creÈ™te fÄƒrÄƒ suport manual.






12) PerformanÈ›Äƒ & SEO tehnic â€” â€rapid, stabil, indexabilâ€
12.1 Obiectiv & SLO (negociabile doar Ã®n sus)

SLO CWV (RUM, P75 pe mobil): LCP < 2.5s, INP < 200ms, CLS < 0.1.

TTFB (EU/US, P75): < 200ms (edge-first).

Error budget performanÈ›Äƒ: timp > SLO pe >5% din sesiuni 7 zile â‡’ incident Perf Sev-2.

Crawl & index: sitemap valid 100%, robots.txt corect, erori GSC = 0 critice.

12.2 Bugete de performanÈ›Äƒ (per tip de paginÄƒ)
PaginÄƒ	HTML (KB)	JS exec (ms)	JS total (KB)	CSS (KB)	Imagini LCP (KB)	LCP È›intÄƒ
Landing /	â‰¤ 25	â‰¤ 120	â‰¤ 160	â‰¤ 40	â‰¤ 120	â‰¤ 1.8s
Pricing /pricing	â‰¤ 28	â‰¤ 140	â‰¤ 180	â‰¤ 50	â‰¤ 140	â‰¤ 2.0s
Blog post	â‰¤ 30	â‰¤ 120	â‰¤ 140	â‰¤ 45	â‰¤ 160	â‰¤ 2.2s
Dashboard	â‰¤ 35	â‰¤ 180	â‰¤ 220	â‰¤ 60	â‰¤ 80	â‰¤ 2.3s

Build eÈ™ueazÄƒ dacÄƒ bugetele sunt depÄƒÈ™ite (lint + CI check).

12.3 Tactici â€edge-firstâ€

Caching la margine: Cache-Control: public, s-maxage=86400, stale-while-revalidate=604800 pe SSG/ISR; private, no-store pe dashboard.

ISR/SSG pentru landing, blog, docs; SSR doar unde e obligatoriu (pricing dinamic, dashboard).

Middleware uÈ™or: doar i18n/redirecturi; fÄƒrÄƒ stat sincron blocant.

Compression: Brotli nivel 5+; Accept-Encoding corect.

HTTP/2 push â€” nu; folosim resource hints moderne (preload/prefetch).

12.4 Imagini & LCP

next/image cu dimensiuni declarate & priority doar pentru LCP.

Formate: AVIF primar, fallback WebP/JPEG; limitÄƒ max 160KB LCP.

CDN cu Accept negotiation; srcset/sizes corect; lazy pentru non-critical.

Placeholder blur datÄƒ-URI; evitÄƒ layout shift (width/height setate).

12.5 Fonturi

System stack by default; dacÄƒ se folosesc web fonts:

display=swap, preconnect la origin, un singur weight per family critic.

Self-hosted WOFF2; subset pe charset; fÄƒrÄƒ FOIT.

Preload doar pentru un font LCP, altfel penalizeazÄƒ.

12.6 JavaScript & CSS

Server Components by default; client components numai unde interactivitatea e indispensabilÄƒ.

Code-splitting pe rute + tree-shaking; zero librÄƒrii grele Ã®n layout global.

Defer JS non-critic; module/nomodule pentru fallback vechi.

CSS: doar ceea ce e folosit (Tailwind JIT), CSS vars pentru tokens; fÄƒrÄƒ CSS blocking Ã®n <head> peste 50KB.

12.7 Resource Hints & prefetch

rel=preconnect cÄƒtre Stripe/Postmark/Algolia numai pe rutele care le folosesc.

prefetch inteligent (on-hover) pentru linkuri interne cu â€intenÈ›ieâ€.

preload strict pentru LCP-image, font LCP; fÄƒrÄƒ over-preload.

12.8 TerÈ›i & Consent Mode

Consent Mode V2: GA4/Segment ruleazÄƒ numai dupÄƒ consimÈ›ÄƒmÃ¢nt.

Politica â€terÈ›i sub 50KBâ€: orice snippet >50KB sau care blocheazÄƒ LCP â†’ reject/async/late-load.

Data-layer server-side pentru evenimente; client colecteazÄƒ doar RUM & interacÈ›iuni.

12.9 RUM (Real User Monitoring) & mÄƒsurare

ColectÄƒm CWV (LCP, INP, CLS) per route Ã— geo Ã— device.

Evenimente: web_vitals, resource_timing, longtask, cls_shift.

Dashboards: percentila 75 pe 7/28 zile; outliers; comparaÈ›ie vs. synthetic.

Alerte: LCP P75 > 2.5s 60m â‡’ sev-2; INP > 250ms pe o rutÄƒ â‡’ backlog â€Perf Fixâ€.

12.10 Synthetic & CI

Lighthouse CI pe PR (mobile): scor Perf â‰¥ 90 pe 3 rute cheie; rapoarte artefact Ã®n pipeline.

k6 pentru SSR endpoints (p95 < 300ms, error <0.2%).

Bundle analyzer: eÈ™ueazÄƒ PR dacÄƒ JS per rutÄƒ > buget.

Visual diff (optional) pentru a detecta regrese LCP/CLS.

12.11 SEO tehnic (automatizat)

Structured data (JSON-LD): Product, Offer, Article, BreadcrumbList, FAQPage (pe bloc FAQ).

Canonic & noindex: canonical explicit; noindex pe draft/preview/dupÄƒ parametri â€?utm=..â€.

Sitemaps: sitemap index + sitemaps pe secÈ›iuni (blog/docs/pages/shop); re-generate la publish/update.

Hreflang: pentru locale live + x-default; validare Ã®n CI (regex + e2e).

OpenGraph/Twitter: og:title/desc/image; twitter:summary_large_image.

Pagination (liste blog/shop): rel="next/prev"; fÄƒrÄƒ infinite scroll fÄƒrÄƒ fallbacks.

Redirect policy: 301 definitive, 302 temporare; 410 pentru pagini eliminate.

Facete/filtre: parametri cu ?sort=, ?page= indexabili; restul noindex, follow (ex: ?color=, ?debug=).

12.12 Anti-CLS & anti-INP

Dimensiuni declarate la imagini/anunÈ›uri/cards; fallback fonts cu metrici apropiate.

Skeletons cu Ã®nÄƒlÈ›imi fixe; fÄƒrÄƒ inserare dinamicÄƒ Ã®naintea LCP.

Evenimente input: debounce/throttle, â€optimistic UIâ€ cu confirmÄƒri asinc; evitÄƒ calcul intens pe main thread.

12.13 Logica de auto-revert (guardrail)

DacÄƒ checkout CR scade >10% P7D sau LCP P75 pe /pricing >2.5s 24h dupÄƒ un release â‡’ auto-revert la ultima versiune + alertÄƒ â€Perf Gate trippedâ€.

12.14 Check-list PR (fail hard)

 LCP media â‰¤ buget & preload doar 1 resursÄƒ criticÄƒ

 JS per rutÄƒ â‰¤ buget, fÄƒrÄƒ deps noi grele Ã®n layout

 Fonts self-hosted + swap, subset

 No blocking third-party fÄƒrÄƒ consimÈ›ÄƒmÃ¢nt

 JSON-LD valid (Rich Results test)

 Canonical/hreflang corecte

 Sitemaps regenerate la schimbÄƒri conÈ›inut

 CWV RUM nu a regresat Ã®n ultimele 24h pe route-ul editat

12.15 AcceptanÈ›Äƒ (DoD pentru capitolul 12)

RUM live cu LCP/INP/CLS pe route/geo/device + alerte.

Lighthouse CI integrat, scoruri artefact Ã®n PR.

Edge caching & ISR configure, header-e corecte.

Image pipeline: AVIF/WebP, dimensiuni declarate, LCP < 160KB.

Structured data valabil pe pricing/blog; sitemaps & robots OK.

Consent Mode operaÈ›ional; terÈ›i Ã®ncÄƒrcaÈ›i dupÄƒ consimÈ›ÄƒmÃ¢nt.

Auto-revert configurat pe scÄƒderi semnificative CWV/checkout.

12.16 Trasabilitate KPI (â†’ Charter)

CWV bune â‡’ SEO mai bun â‡’ trafic organic â†’ CR pricing â†‘.

TTFB mic & INP < 200ms â‡’ percepÈ›ie de vitezÄƒ â‡’ TTV â‰¤ 10 min & NRR mai mare.

Sitemaps/structured data corecte â‡’ indexare stabilÄƒ â‡’ MRR indirect.






13) Securitate & Conformitate â€” â€fÄƒrÄƒ scurgeri, fÄƒrÄƒ surprize, verificabilâ€
13.1 Èšinte & indicatori

ÈšintÄƒ standard: OWASP ASVS Level 2 (web apps cu date sensibile).

SLO securitate: 0 vulnerabilitÄƒÈ›i High/Critical la release; MTTD â‰¤ 15 min, MTTR â‰¤ 4 h (Sev-1); rate 5xx < 0.2%/h.

SLO conformitate: DSR (export/È™tergere) â‰¤ 7 zile, incident notice (dacÄƒ e cazul) â‰¤ 72h, audit trail 100% acoperire.

13.2 Model de ameninÈ›are & guvernanÈ›Äƒ

Threat modeling pe epic (STRIDE) cu checklist ASVS; risc â‰¥ â€Mediuâ€ â†’ task dedicat.

Politici minime (vive Ã®n repo /docs/policies): Access Control, Backup & DR, Change Management, Vulnerability Management, Incident Response, Data Retention & Deletion, Acceptable Use (admin), Third-Party Management.

13.3 Control acces & identitate

RBAC: owner/admin/editor/support/viewer (cap. 6).

RLS: izolare org_id (deny-by-default).

Auth: SSO (email+parolÄƒ, OAuth), MFA TOTP, recovery codes, device binding.

Principiul cel mai mic drept: acces la producÈ›ie doar prin conturi personale + Just-In-Time (8h), auditat.

Sesiuni: cookie HttpOnly/Secure/SameSite=Lax; refresh rotation + blacklist; revocare globalÄƒ â‰¤ 5s.

13.4 Configurare securitate la nivel HTTP

CSP strictÄƒ (default-src 'self'; script-src 'self' 'strict-dynamic' 'nonce-<rand>' https://js.stripe.com
; connect-src 'self' *.stripe.com *.supabase.co; img-src 'self' data: blob:; style-src 'self' 'unsafe-inline'; frame-ancestors 'none').

SRI pe scripturi/stylesheet self-hosted.

Alte headere: X-Frame-Options: DENY, X-Content-Type-Options: nosniff, Referrer-Policy: strict-origin-when-cross-origin, Permissions-Policy minimizatÄƒ (ex: geolocation=()).

CSRF: double submit cookie sau SameSite + token anti-CSRF pe rutele sensibile.

Rate-limit: login/OTP/export/API (cap. 6/7).

SSRF: deny-all outbound; allowlist strict pentru Stripe/Email/Search; timeouts & size caps.

13.5 Securitate aplicaÈ›ie (OWASP ASVS L2 â€“ selecÈ›ie)

Validare input: schemÄƒ zod/Yup la edge; sanitizare MDX (allowlist components).

Output encoding: React escapare by default; dangerouslySetInnerHTML interzis fÄƒrÄƒ review de securitate.

Autorizare: verificÄƒri server-side la fiecare acÈ›iune (nu doar Ã®n UI).

Uploaduri: MIME allowlist, renumire random, scan AV opÈ›ional, URL-uri semnate cu TTL.

Secrets: numai server-side; rotation trimestrial; stocare Ã®n secret store; niciun secret Ã®n client.

DependenÈ›e: lockfile semnat, approvals pentru postinstall scripts, Dependabot + audit sÄƒptÄƒmÃ¢nal; SBOM (CycloneDX) per release.

Criptografie:

In-transit: TLS 1.2+; HSTS (preload) dupÄƒ verificare.

At-rest: Postgres & Storage criptate (provider); chei de semnare token rotite.

13.6 GDPR (EU) â€” implementare operaÈ›ionalÄƒ

Temeiuri legale: contract (serviciu), consimÈ›ÄƒmÃ¢nt (analytics/marketing), interes legitim documentat (securitate).

DPA cu toÈ›i sub-procesatorii (Stripe, Supabase, Vercel, Postmark etc.).

DPIA pentru: telemetrie, procesÄƒri marketing, joburi AI (dacÄƒ prelucreazÄƒ PII).

Registre prelucrÄƒri (RoPA) Ã®n /docs/gdpr/ropa.csv (sistem, scop, baza legalÄƒ, categorii date, retenÈ›ie, transferuri).

Drepturi utilizator:

Export: JSON + arhivÄƒ exporturi (link semnat).

È˜tergere: soft-delete imediat + hard-delete Ã®n batch (â‰¤ 30 zile), pÄƒstrÃ¢nd minime evidenÈ›e financiare.

Rectificare, restricÈ›ionare: UI / ticket.

ConsimÈ›ÄƒmÃ¢nt granular: Consent Mode V2; toggle per scop; logs de consimÈ›ÄƒmÃ¢nt (cine, ce, cÃ¢nd, versiune).

Transferuri internaÈ›ionale: SCCs pentru US vendors; listÄƒ subprocessors publicÄƒ; notificare prealabilÄƒ la schimbÄƒri.

Cookie banner: blocare scripturi pÃ¢nÄƒ la accept (strict necesare exceptate).

13.7 ISO/IEC 27001 â€“ aliniere (minim viabil)

A.5 Politici: cele enumerate la 13.2.

A.6 OrganizaÈ›ional: responsabil securitate (Security Lead), rol DPO (intern/extern).

A.8 Asset mgmt: inventar sisteme & date (data map).

A.9 Control acces: RBAC/JIT, revizuire trimestrialÄƒ permisiuni.

A.12 OperaÈ›iuni: logging, capacity, anti-malware (scan la upload), backup.

A.14 Dezvoltare securizatÄƒ: SAST/DAST Ã®n CI, code review obligatoriu.

A.16 Incidente: playbook, post-mortem 48h, lecÈ›ii Ã®n backlog.

A.17 Continuitate: RPO â‰¤ 1h, RTO â‰¤ 4h (cap. 18).

A.18 Conformitate: licenÈ›e, DPIA, arhivÄƒ fiscale.

13.8 Minim PII & clasificare date

Clasificare: Public / Intern / ConfidenÈ›ial / Sensibil (PII).

Minimizare: colectÄƒm strict email, nume opÈ›ional; niciodatÄƒ card data (Stripe tokenize).

Pseudonimizare: telemetrie agregatÄƒ; IP trunchiat; user_id/ org_id pseudonime Ã®n analytics.

13.9 Logare & audit trail (tamper-evident)

Audit events: auth., roles.changed, org.updated, billing., content.publish, export., webhook., policy_denied.

Tamper-evident: lanÈ› de hash (prev_hash, hash) la audits; semnÄƒturÄƒ HMAC a rÃ¢ndului; acces doar append.

RetenÈ›ie: audit 18 luni (minim); loguri tehnice 90 zile (rotire).

ProtecÈ›ie: acces read-only pentru auditori; export CSV/JSON cu checksum.

13.10 Backups & DR

Postgres: snapshot orar (retenÈ›ie 7 zile) + zilnic (retenÈ›ie 30 zile).

Storage: versiuni + cross-region (dacÄƒ suportÄƒ).

Teste: restaurare trimestrialÄƒ (table-top + restaurare realÄƒ Ã®n Stage).

RPO â‰¤ 1h, RTO â‰¤ 4h documentate È™i mÄƒsurate.

13.11 Vulnerability management

SAST: pe PR (Semgrep/CodeQL) â€“ fail hard la High/Critical.

DAST: sÄƒptÄƒmÃ¢nal pe Stage + Ã®nainte de lansÄƒri majore.

Dependency audit: automat; patch Ã®n â‰¤ 14 zile (High) / â‰¤ 48h (Critical).

Bug bounty light: adresa security@ + pagina /security; SLA rÄƒspuns â‰¤ 72h.

13.12 TerÈ›i & date cÄƒtre exterior

Stripe: plÄƒÈ›i, taxe, dispute (date minime de facturare).

Supabase: Auth/DB/Storage (RLS).

Vercel: edge/hosting.

Postmark/Resend: email tranzacÈ›ional.

Algolia/OpenSearch: cÄƒutare (fÄƒrÄƒ PII).

Contracte & DPA documentate; data map menÈ›ioneazÄƒ cÃ¢mpurile exact transmise.

13.13 ReÈ›inere & È™tergere

Cont: È™tergere la cerere â†’ anonimizÄƒm user fields; pÄƒstrÄƒm invoicing conform legal.

Exporturi: TTL la linkuri; È™tergere fiÈ™iere Ã®n 30 zile de la cont Ã®nchis (dacÄƒ nu contravine obligaÈ›iilor legale).

Telemetrie: agregate dupÄƒ 90 zile; raw events È™terse.

13.14 Incident response (Sev-levels)

Sev-1 (date compromise / plÄƒÈ›i indisponibile): call rota 24Ã—7, blocare vector, investigaÈ›ie, anunÈ› DPO/management; notificÄƒri legale â‰¤ 72h dacÄƒ e necesar.

Sev-2 (degradare performanÈ›Äƒ / partial outage): rollback/canary stop, update statuspage la 15â€™.

Post-mortem 48h: cauzÄƒ, impact, timeline, acÈ›iuni & owner + due date.

13.15 AcceptanÈ›Äƒ (DoD pentru capitolul 13)

CSP + headere securitate servite pe toate rutele; raport de verificare Ã®n CI.

SAST/DAST integrate; 0 High/Critical; Dependency audit verde.

RLS testat (cross-org imposibil).

Politici publicate Ã®n /docs/policies/*; RoPA, DPIA È™abloane completate.

DSR workflow: cerere â†’ export/erase Ã®n â‰¤ 7 zile; log de consimÈ›ÄƒmÃ¢nt 100%.

Audit trail cu hash chain activ, export cu checksum.

Backups/verificare DR trecute; RPO/RTO mÄƒsurate.

Subprocessors list & DPA semnate; cookie banner + Consent Mode funcÈ›ional.

13.16 Exemple â€gata de lipitâ€ (indicativ)
CSP (Next.js middleware â€“ schemÄƒ)
const nonce = crypto.randomUUID().replace(/-/g,'');
const csp = [
  "default-src 'self'",
  `script-src 'self' 'strict-dynamic' 'nonce-${nonce}' https://js.stripe.com`,
  "style-src 'self' 'unsafe-inline'",
  "img-src 'self' data: blob:",
  "connect-src 'self' https://api.stripe.com https://*.supabase.co",
  "frame-ancestors 'none'"
].join('; ');

PoliticÄƒ RLS (ex.)
alter table exports enable row level security;
create policy org_scoped on exports
for all using (org_id = current_setting('app.org_id')::uuid)
with check (org_id = current_setting('app.org_id')::uuid);

Audit tamper-evident (hash chain)
-- coloane: id, prev_hash, record_json, hash, at
create function audit_insert() returns trigger as $$
declare last_hash text;
begin
  select hash into last_hash from audits order by at desc limit 1;
  new.prev_hash := coalesce(last_hash,'GENESIS');
  new.hash := encode(digest(new.prev_hash || to_jsonb(new.record_json)::text, 'sha256'),'hex');
  return new;
end $$ language plpgsql;

13.17 Trasabilitate KPI (â†’ Charter)

Zero High/Critical + CSP/RLS/MFA â‡’ risc operaÈ›ional scÄƒzut â‡’ NRR mai mare & churn mic.

DSR â‰¤ 7 zile, consimÈ›ÄƒmÃ¢nt corect â‡’ risc legal scÄƒzut â‡’ focus pe MRR.

Backups/DR â‡’ 99.9% uptime menÈ›inut â‡’ Error budget sub 0.1%.





14. Analytics & Observabilitate
Obiectiv (ce mÄƒsurÄƒm È™i de ce)

AsigurÄƒm o buclÄƒ completÄƒ â€vedeâ†’Ã®nÈ›elegeâ†’acÈ›ioneazÄƒâ€ prin: evenimente first-party pe server (fÄƒrÄƒ PII), telemetrie unificatÄƒ (logs structurate, metrics, traces), SLO + error budget, È™i 4 dashboard-uri operaÈ›ionale (funnel, cohort, revenue, conÈ›inut). Totul ruleazÄƒ cu Consent Mode & first-party analytics, astfel Ã®ncÃ¢t trackingul respectÄƒ consimÈ›ÄƒmÃ¢ntul utilizatorului.

Instrumentare: server-side events + first-party analytics

Model de evenimente (canon):
module_open, module_run_requested, module_run_started, module_run_scored, module_run_succeeded | module_run_blocked, export_performed, legacy_redirect_hit â€” toate conÈ›in module_id (Mxx), trace_id, plan, ts È™i payload minim necesar pentru KPI-uri (fÄƒrÄƒ PII). Exemplu: module_run_scored = {quality, risk, cost, overall} (0â€“100).

Colectare: pe server (Next.js App Router) la rutele API / execuÈ›ie È™i Ã®n middleware pentru legacy_redirect_hit (308). Evenimentele sunt scrise Ã®n DB Ã®mpreunÄƒ cu run-uri/exporturi; nu trimitem date brute Ã®n terÈ›i fÄƒrÄƒ consimÈ›ÄƒmÃ¢nt.

Consent Mode & first-party: activÄƒm Consent Mode; fÄƒrÄƒ consimÈ›ÄƒmÃ¢nt pÄƒstrÄƒm doar evenimente operaÈ›ionale agregate (fÄƒrÄƒ user identifiers). CÃ¢nd existÄƒ consimÈ›ÄƒmÃ¢nt, trimitem È™i cÄƒtre GA4/Sentry Ã®n limitele politicii.

Integrare minimÄƒ (MVP): GA4 (trafic, funnel viziteâ†’signup), Sentry (erori client/server). Variabile: GA_MEASUREMENT_ID, SENTRY_DSN.

Telemetrie: logs structurate, metrics, traces

Logs structurate: un singur format JSON cu cÃ¢mpuri cheie (evt, module_id, trace_id, status, duration_ms, tokens, cost_cents). Se emit Ã®n momentele cheie (start, score, success/block, export).

Metrics: contorizÄƒm run_started/run_completed/run_failed, histograme pentru execution_time_ms, token_usage, overall_score. Agregare zilnicÄƒ Ã®n daily_usage (runs, users, exports, avg_score, revenue_usd).

Traces: fiecare execuÈ›ie poartÄƒ trace_id din pre-run pÃ¢nÄƒ la export, permiÈ›Ã¢nd legarea evenimentelor Ã®n rapoarte È™i alerte.

Observabilitate (stivÄƒ): librÄƒria de telemetrie expediazÄƒ metrici locali + opÈ›ional cÄƒtre Datadog/PostHog; erorile critice declanÈ™eazÄƒ alerte Slack/email (canal incident).

SLO + Error Budget (gÄƒrzi de calitate)

SLO platformÄƒ (MVP):

Success-rate (top-10 module) â‰¥ 95%;

P95 latency: simulate â‰¤ 3s, live â‰¤ 8s;

Export success â‰¥ 98% (0 artefacte fÄƒrÄƒ manifest + checksum);

SEO snapshot (home, index, 2 module) â‰¥ 90;

Legacy Redirect Share â‰¤ 5%; 404 pe pagini modul = 0.

Error budget & acÈ›iuni:

DepÄƒÈ™ire error budget â†’ Ã®ngheÈ› lansÄƒri, activare auto â€degrade-to-simulateâ€ pentru live test, canary/rollback. Alertare Ã®n Admin.

Dashboards (MVP)
1) Funnel (openâ†’runâ†’success)

Carduri: Openâ†’Run Rate, Success Rate, TTV median (<300s), P95 latency, Export success, Redirect share.

Filtre: plan, modul, cohortÄƒ 7/14 zile, from_legacy.

Alerte: success_rate < 95%, export fÄƒrÄƒ checksum, 404/5xx spike.

2) Cohort & RetenÈ›ie

D2/D7 Retention: % utilizatori cu â‰¥1 run Ã®n ziua 2/7;

Cross-module adoption: % utilizatori cu â‰¥2 module diferite Ã®n 14 zile;

TTV: median de la run_started la run_succeeded.

3) Revenue

MRR/ARR estimativ & revenue_usd zilnic (agregat din users/plan, cu upsert Ã®n daily_usage); corelÄƒm conversii freeâ†’paid È™i cohortele. (GA4 pentru atribuire, revenue model Ã®n daily_usage pentru dashboard intern).

4) ConÈ›inut & Cost

Calitate execuÈ›ie: scoruri quality/risk/cost/overall (medii È™i distribuÈ›ii);

EficienÈ›Äƒ: tokens/run, cost/rulÄƒre, P95 exec time;

SEO & compat: scor SEO, 308 hits, 404=0.

Model de date & retenÈ›ie

Tabele cheie: prompt_runs (execuÈ›ii + scoruri + cost), exports (artefacte, status, checksum), daily_usage (agregate), plus evenimente/analytics.

RetenÈ›ie recomandatÄƒ: agregate zilnice pe termen lung; loguri detaliate la 90 zile; fÄƒrÄƒ PII Ã®n telemetrie (policy â€zero PIIâ€).

AcceptanÈ›Äƒ (DoR/DoD â€“ â€gata de tras la rÄƒspundereâ€)

DoR (gata de instrumentare): evenimentele standard sunt implementate; Consent Mode activ; GA4/Sentry configurate.

DoD (gata de operat):

Dashboard Funnel & Cohort online (filtre, alerte);

daily_usage se populeazÄƒ (runs, users, exports, avg_score, revenue_usd);

SLO verzi pe canary 24h: success-rate â‰¥95%, export success â‰¥98%, P95 Ã®n È›intÄƒ, SEO â‰¥90, 404=0;

Rule â€degrade-to-simulateâ€ testatÄƒ, alerte Slack funcÈ›ionale.

Note operaÈ›ionale

Front-end/UX: ruta /dashboard listeazÄƒ run-uri, scoruri, exporturi È™i KPIs per modul; badge â€Telemetryâ€ (run_id + score) vizibil Ã®n istorice.

DevOps: adÄƒugÄƒm logging & monitoring Ã®n â€Critical Week 1â€“2â€ (Sentry/Analytics), backup DB zilnic; acestea sunt blocante pentru â€go-liveâ€.

Exemple utile (ready-to-use)

SQL â€“ success rate 14 zile / modul:
â€success_rate = sum(run_succeeded) / sum(run_started)â€ (agregare pe evenimente).

Agregare zilnicÄƒ (cron): upsert Ã®n daily_usage cu total runs/users/exports, avg_score, revenue_usd; folosit de tile-urile din Dashboard.







15) API Public & IntegrÄƒri â€” â€deschis, dar gated, versiuni clare, observabilâ€
15.1 Obiectiv & principii

Enterprise-first: API public pentru clienÈ›ii Enterprise (È™i Pro acolo unde e logic), cu rute clare, versionare È™i rate-limit per plan/flag. Gatingul se face prin entitlements (feature flags), exact ca Ã®n produs.

SSOT: respectÄƒ ruleset.yml (enum-uri 7D, DoR/DoD, export pipeline, telemetry). Nicio abatere: UI/SDK/API citesc aceleaÈ™i reguli.

Secure by default: RLS pe DB, chei API cu hash, OAuth2 Client Credentials pentru integrÄƒri server-to-server, webhooks semnate, idempotency.

Observabilitate: run_id ca cheie, evenimente standard (open/run/scored/export), fÄƒrÄƒ conÈ›inut brut Ã®n loguri (redactare by design).

15.2 SuprafaÈ›a API (MVP) â€” rute È™i gating

Namespace REST v1 (path versioning): /api/v1/*. Pentru backward-compat, menÈ›inem È™i rutele existente pÃ¢nÄƒ la stabilizare.

RutÄƒ	MetodÄƒ	Cine	Scop (pe scurt)
/api/v1/run/{moduleId}	POST	Enterprise	RuleazÄƒ Mxx cu 7D + inputs, produce artefacte (DoD gates)
/api/v1/gpt-test	POST	Pro+	Teste GPT live + scor (clarity/execution/ambiguity/business_fit)
/api/v1/gpt-editor	POST	Creator+	â€Tighten/optimizeâ€ prompt (editor asistat)
/api/v1/entitlements	GET	Auth	ReturneazÄƒ flags efective (plan + add-ons/packs)
/api/v1/export	POST	Pro+ / Ent	Export .md/.pdf/.json sau bundle.zip (manifest + checksum)

Aceste rute sunt deja schiÈ›ate Ã®n tree-ul actual (App Router) È™i Ã®n checklist-ul de lansare.

Gating (pre-run)

VerificÄƒ planul + entitlements (ex: canUseGptTestReal, canExportBundleZip, hasAPI) Ã®nainte de execuÈ›ie; Ã®n caz negativ â†’ 403 ENTITLEMENT_REQUIRED + payload cu â€upsell hintâ€.

RespectÄƒ DoR (7D valid/enum-only, output_spec Ã®ncÄƒrcat, tests definite) È™i DoD (score â‰¥80, manifest+checksum, telemetry) â€” altfel nu marchezi success.

15.3 Autentificare & autorizare

API Keys (Enterprise): chei stocate â€hash-uiteâ€ Ã®n api_keys, cu rate-limit per cheie È™i revocare/rotaÈ›ie. Header: X-PF-Api-Key.

OAuth2 Client Credentials (integrÄƒri): pentru parteneri server-to-server; token_url intern, scoping la org. (Compatibil cu HubSpot/Zendesk ingesters.)

JWT (user context): pentru rutele care opereazÄƒ Ã®n numele userului (front-end), dar export/bundle È™i run Enterprise vor prefera API Key.

15.4 Versionare & contract

Path versioning: /api/v1/â€¦ (+ X-PF-Ruleset-Version Ã®n request). DacÄƒ versiunea ruleset nu corespunde cu serverul â†’ 409 RULESET_CONFLICT.

OpenAPI (YAML) publicat Ã®n /docs/api (existent Ã®n site tree). SDK-uri uÈ™oare (TS/Python) generate din spec.

15.5 Rate-limits & cost-guard

Exemplu iniÈ›ial (ajustÄƒm din entitlements):

Pro: 50 req/min (burst 100), API disabled (cheie indisponibilÄƒ).

Enterprise: 120 req/min (burst 240), elevat pe rute /run È™i /export.

Per org + per key + per IP, idempotency prin Idempotency-Key. DepÄƒÈ™ire â†’ 429 + Retry-After.

15.6 Model de eroare (standardizat)

Payload:

{ "error": "ENTITLEMENT_REQUIRED", "message": "Pro needed for live test", "details": {...} }


Coduri uzuale: 400 INVALID_7D_ENUM, 401 UNAUTHENTICATED, 403 ENTITLEMENT_REQUIRED, 409 RULESET_CONFLICT, 422 INPUT_SCHEMA_MISMATCH, 429 RATE_LIMITED, 500 INTERNAL_RUN_ERROR. (Map identic cu arhitectura.)

15.7 Rute cheie (contracte)
a) POST /api/v1/run/{moduleId} (Enterprise)

Auth: X-PF-Api-Key

Body: { sevenD: {...}, inputs: {...}, options?: {export: ["md","json","pdf"]} }

Flow: validateâ†’executeâ†’evaluate (score)â†’export (Ã®n limitele planului: manifest + checksum)â†’persist telemetry.

Return: { runId, score, verdict, artifacts: { md, json, pdf? }, manifest, checksum }

Gates: DoR/DoD È™i entitlements (api, export format).

b) POST /api/v1/gpt-test (Pro+)

Auth: session JWT sau API Key (org)

Body: { prompt, sevenD }

Return: { runId, breakdown: { clarity, execution, ambiguity, business_fit }, verdict }

Note: foloseÈ™te evaluatorul standard; dacÄƒ score <80, â€tighten onceâ€ (auto-fix) apoi verdict final.

c) POST /api/v1/export (Pro+/Ent)

Body: { runId, formats: ["md","json","pdf","zip?"] }

Return: { artifacts, manifest, checksum } (ZIP numai Enterprise).

d) GET /api/v1/entitlements

Return: { flags: { canUseGptTestReal, canExportPDF, canExportJSON, canExportBundleZip, hasAPI, ... } } (agregat org âŠ• user).

15.8 Webhooks â€” semnate, sigure, reziliente

Semnare: X-PF-Signature: sha256=<hex> (HMAC cu secret per endpoint).

Evenimente interne (exemple): run.succeeded, run.failed, export.ready.

Retry: backoff exponenÈ›ial; DLQ pentru 3 eÈ™ecuri consecutive; UI admin aratÄƒ â€dead lettersâ€. (Stripe webhooks sunt consolidate Ã®ntr-o singurÄƒ rutÄƒ.)

Idempotency: event.id logat; duplicate â†’ 200 OK fÄƒrÄƒ re-procesare.

15.9 IntegrÄƒri standard (pragmatic, MVP)

Email (Postmark/Resend)

Transactional: welcome, reset, â€export readyâ€; fallback la Resend. Hook Ã®n /export â†’ email cu linkuri semnate.

CRM (HubSpot)

Lead-in: form submit & checkout events; OAuth2 CC pentru sync companii/contacts. Mapezi org_idâ†”company_id.

Support (Zendesk)

Ticket la run.failed Sev-2; include run_id, module, scor, trace.

Marketing (GA4/Segment)

Only after consent (Consent Mode); track pricing_view, signup, module_run_simulated/live, export_*. (ExistÄƒ checklist integrÄƒri Ã®n requirements.)

CÄƒutare (Algolia/OpenSearch)

Index incremental pe published (CMS); preview/noindex pentru draft. (Aliniat cu CMS & SEO.)

PlÄƒÈ›i (Stripe/Paddle), taxe (Stripe Tax/TaxJar)

Stripe principal: Checkout/Billing/Tax + webhook unic â†’ subs/entitlements. TaxJar opÈ›ional pentru jurisdicÈ›ii speciale. (Conform fluxurilor de billing din checklist.)

Storage & bundles

Supabase Storage; linkuri semnate; persist manifest.json + checksum Ã®n bundles.

15.10 Telemetrie & observabilitate

Chei minime: run_id, model, tokens_in/out, cost_usd, tta_seconds, score_total, policy_hits, ruleset_version. Nu logÄƒm conÈ›inut brut.

Dashboard: funnel openâ†’runâ†’success pe modul; hit-uri legacy_redirect; erori 4xx/5xx per rutÄƒ. (ExistÄƒ structuri È™i SLO deja definite.)

15.11 Securitate

DB RLS by membership; api_keys doar server-side; X-Frame-Options: DENY, CSP strict; rotaÈ›ie chei; Idempotency-Key la POST. (Completat de bundle & export constraints.)

15.12 AcceptanÈ›Äƒ (DoR/DoD pentru API)

DoR (nu expui ruta pÃ¢nÄƒ nu): 7D enum-only validat; entitlements OK; output_spec & tests Ã®ncÄƒrcate.
DoD (nu livrezi â€successâ€ pÃ¢nÄƒ nu): score â‰¥80; manifest+checksum scrise; telemetry salvatÄƒ; error model standardizat; rate-limits testate.

15.13 Exemple
cURL â€” run Enterprise
curl -X POST "https://app.promptforge.com/api/v1/run/M14" \
  -H "X-PF-Api-Key: <your_enterprise_key>" \
  -H "Idempotency-Key: 8c1c8f1f-..." \
  -H "Content-Type: application/json" \
  -d '{
    "sevenD": {"domain":"ecommerce","output_format":"playbook"},
    "inputs": {"brand":"ACME","goal":"+15% CR 30 days"},
    "options": {"export":["md","json","pdf"]}
  }'

Webhook handler (pseudo)
app.post('/webhooks/pf', (req,res)=>{
  verifySignature(req.headers['x-pf-signature'], req.rawBody);
  const evt = JSON.parse(req.body);
  switch(evt.type){
    case 'export.ready': saveArtifacts(evt.data); break;
    case 'run.failed': openZendeskTicket(evt.data); break;
  }
  res.sendStatus(200);
});

15.14 Implementare Ã®n repo (unde pui ce)

Rute: app/api/v1/run/[moduleId]/route.ts, .../gpt-test/route.ts, .../gpt-editor/route.ts, .../export/route.ts, .../entitlements/route.ts. (conform tree-ului actual).

Docs publice: /docs/api (OpenAPI + exemple).

15.15 De ce e corect pentru PromptForge

Conform checklistului v3 (rute, gating, bundle), ruleset.yml (SSOT: 7D/telemetry/export/entitlements) È™i modelului DB (api_keys/bundles), plus integrarea rutelelor deja prezente Ã®n cod.






16) Admin & Backoffice â€” â€control total, cu frÃ¢ne È™i centuriâ€
16.1 Obiectiv & razÄƒ

Obiectiv: un panou sigur, rapid È™i auditat pentru operare de zi-cu-zi: utilizatori/org-uri, roluri, conÈ›inut, catalog & comenzi, abonamente & finanÈ›e, cupoane, loguri, webhooks, feature flags, exporturi (CSV/JSON) È™i rapoarte fiscale.

Principii: least-privilege, douÄƒ confirmÄƒri pe acÈ›iuni riscante, audit trail nemodificabil, rollback/undo, preview/canary pe schimbÄƒri cu impact.

16.2 Acces & roluri (model operaÈ›ional)

SuperAdmin (intern, global): numai echipa noastrÄƒ; scope cross-org; IP allowlist + MFA obligatoriu + break-glass (motiv + OTP).

Owner (per org): tot ce È›ine de orgul propriu (abonamente, seats, facturi, membri).

Admin (per org): membri/roluri, conÈ›inut, catalog, comenzi, cupoane; fÄƒrÄƒ refund/facturi.

Support (per org): tichete, re-trimitere emailuri, re-livrare webhooks; fÄƒrÄƒ preÈ›uri/roluri.

Finance/Tax (intern sau delegat): facturi, refund, dunning, rapoarte fiscale; nu schimbÄƒ conÈ›inut sau preÈ›uri.

Toate acÈ›iunile sunt verificate È™i Ã®n DB prin RLS pe org_id. Sensitive: 2-person approval (SuperAdmin+Finance).

16.3 ArhitecturÄƒ de navigaÈ›ie (secÈ›iuni)

Overview: health (uptime, error budget), MRR/NRR, bilete deschise, webhooks restante.

Users & Orgs: cÄƒutare, detalii membru, roluri, invitaÈ›ii; mutÄƒri Ã®ntre orguri (SuperAdmin only, cu motiv).

Roles & Entitlements: vizualizare/ajustare flags (plan, add-ons, seats).

Content: posts/pages/docs/changelog, workflow, programÄƒri, revizii, linkuri rupte.

Catalog (Shop): produse/variante/preÈ›uri, bundle, stoc (faza 2), media.

Orders & Fulfillment: comenzi digitale/fizice, descÄƒrcÄƒri, tracking (faza 2).

Subscriptions & Billing: plan curent, trial, dunning, facturi, plÄƒÈ›i, dispute.

Coupons & Promotions: cupoane, reguli, ferestre, capuri.

Logs & Telemetry: evenimente, erori, RUM CWV, cereri API; filtre rapide.

Webhooks: istoric, payload, re-livrare, DLQ.

Feature Flags: definire, targetare (plan/segment), rollout %, expirare.

Exports & Reports: CSV/JSON, rapoarte fiscale (EU VAT OSS/US), arhivÄƒ descÄƒrcÄƒri.

Settings: branding (Enterprise), zone orare, politicile de retenÈ›ie.

16.4 Fluxuri cheie (cap-coadÄƒ)
A) User & org management

InvitÄƒ membru: email â†’ rol â†’ exp editor; revocare instant cu undo 10 min.

Reset rol: adminâ†’editor â†’ audit â€who/whyâ€.

Transfer ownership: ownerâ†’alt membru (dublÄƒ confirmare + e-mail ambelor pÄƒrÈ›i).

B) Subscriptions & Billing (Stripe-first)

Upgrade/Downgrade/Seats: modificÄƒ price/quantity (Stripe), confirmÄƒ prorratare; recalcul entitlements.

Dunning: vizualizeazÄƒ ciclurile; trimite manual â€pay nowâ€; seteazÄƒ suspendare soft.

Refund/Dispute: Finance: refund parÈ›ial/total; marcheazÄƒ dispute; read-only pentru restul.

C) Catalog & preÈ›uri

SchimbÄƒ preÈ›: creeazÄƒ nou price (nu editezi in-place); marcheazÄƒ vechiul â€inactiveâ€; preview live; canary 5% dacÄƒ vizibil FE.

Bundle digital: selectezi iteme, setezi discount, generezi art cover automat (opÈ›ional).

Fizic (faza 2): inventar, AWB, cost transport; webhook â€shippedâ€.

D) Contenut & workflow

Draftâ†’Reviewâ†’Approveâ†’Schedule: gates design/SEO/legal; programare cu failover.

Rollback: alege versiune anterioarÄƒ; regen ISR; log â€reverted-to:<rev>â€.

E) Webhooks & DLQ

Re-livrare: selectezi eveniment, endpoint; semnÄƒturÄƒ re-calculatÄƒ; backoff; blocare dacÄƒ 3Ã— fail.

DLQ: filtre (tip, org), inspectezi payload, re-queue; export JSON.

F) Feature Flags (gated rollout)

Creezi flag â†’ target (plan, org, % random) â†’ window (start/end) â†’ strategie (kill-switch, gradual).

Blast radius: afiÈ™aj a rute/feature afectate; auto-revert dacÄƒ scade checkout CR >10% (7 zile) sau creÈ™te 5xx >0.5% (30 min).

G) Exports & rapoarte fiscale

CSV/JSON cu scheme stabile: users, orgs, subscriptions, invoices, orders, downloads, events.

Rapoarte fiscale:

EU VAT OSS (lunar): È›arÄƒ, venit net, TVA colectat, numÄƒr tranzacÈ›ii, COTA; CSV + PDF sumare.

US sales tax (lunar): stat/county/city, venit, taxÄƒ, numÄƒr tranzacÈ›ii; coduri nexus.

Semnare & arhivare: fiecare export are checksum SHA256 + manifest; link semnat, TTL configurabil.

16.5 UI & UX (pattern-uri productive)

Tabele rapide: cÄƒutare full-text, sortÄƒri, filtre salvabile, col. selector, export curent.

Bulk actions: invite/revoke, re-send email, re-deliver webhooks, activate/deactivate SKUs.

Inline edit pentru cÃ¢mpuri low-risk; side-panel pentru detalii; wizard pentru paÈ™i sensibili (refund, price change).

Empty/Error/Skeleton cu acÈ›iune imediat utilÄƒ (ex: â€CreeazÄƒ cuponâ€).

Banner â€riskâ€ cÃ¢nd editezi preÈ›uri/roluri/flags; cere motiv obligatoriu.

16.6 Securitate & guardrails

Break-glass: pentru acÈ›iuni globale (mutare org, È™tergere definitivÄƒ), ceri motiv + OTP + confirmare 2nd operator.

Redactare PII: Ã®n liste apare parÈ›ial (email truncat); â€View fullâ€ cere motiv È™i e logat.

Rate-limit admin: 60 acÈ›iuni/min/cont; protecÈ›ie Ã®mpotriva scriptÄƒrii.

Rule checks: ruleset.yml (enum-only, DoR/DoD) rulat pe schimbÄƒri de module/exports.

RBAC fin: refund/price/flags numai Finance/SuperAdmin; Support nu poate schimba roluri.

16.7 Observabilitate Admin (ce mÄƒsurÄƒm)

Evenimente: admin.login, admin.user_invited/role_changed, admin.price_created/activated, admin.refund_issued, admin.flag_changed, admin.webhook_redelivered, admin.export_generated, admin.break_glass_used.

Dashboards:

Operare: t imp mediu de rezolvare ticket, nr. re-delivery reuÈ™ite, DLQ size, top erori.

Financiar: venit/È›arÄƒ, taxe, refund/dispute rate.

Securitate: break-glass, â€view full PIIâ€, Ã®ncercÄƒri eÈ™uate.

Alerte: DLQ > 100, dispute rate >0.8%, fail webhooks 3Ã— Ã®n 15 min.

16.8 PerformanÈ›Äƒ & SLO

TTFB Admin P75 < 300 ms; p95 acÈ›iune admin < 800 ms (ex: update produs).

Exporturi: < 30 s pentru 100k rÃ¢nduri (streaming); webhook re-deliver la click < 2 s pÃ¢nÄƒ la accept 2xx.

Uptime: â‰¥ 99.9% (panou).

16.9 API (server) pentru backoffice

GET /api/admin/orgs|users|members (+filtre)

POST /api/admin/invite, POST /api/admin/members/{id}/role

POST /api/admin/catalog/product|price|bundle

POST /api/admin/billing/refund, POST /api/admin/billing/seats

GET /api/admin/webhooks, POST /api/admin/webhooks/{id}/redeliver

GET /api/admin/flags, POST /api/admin/flags/{key}

POST /api/admin/exports (dataset, format, filtre)

GET /api/admin/reports/tax?period=YYYY-MM

Toate cer route handlers cu RLS + role check + audit per acÈ›iune; rÄƒspunsurile includ request_id.

16.10 Exporturi & rapoarte (detalii)

CSV/JSON: col. ordonate, header consistent, delimitator ,, escaping RFC4180; JSON â€recordsâ€.

Tax reports:

EU: country, currency, net_amount, vat_amount, vat_rate, count, period.

US: state, county, city, net_amount, tax_amount, rate, count, period.

Semnare: manifest (dataset, period, row_count, checksum) + checksum.txt (SHA256); arhivÄƒ .zip pentru seturi multiple.

16.11 AcceptanÈ›Äƒ (DoD pentru Admin & Backoffice)

RBAC aplicat corect (teste pozitive/negative pe roluri).

Audit trail complet (hash chain) pentru toate acÈ›iunile; export verificat cu checksum.

Webhooks: re-deliver funcÈ›ional; DLQ vizibil È™i rezolvabil.

Flags: createâ†’targetâ†’rolloutâ†’expire; auto-revert la condiÈ›ii de risc.

Billing: upgrade/downgrade/seats/refund acÈ›ioneazÄƒ corect Ã®n Stripe + DB.

Exporturi & rapoarte fiscale: generate, descÄƒrcate, validate (schemÄƒ + checksum).

PII guard: â€view fullâ€ cere motiv È™i logheazÄƒ.

Perf: SLO atinse pe 3 rute cheie (users, billing, webhooks).

16.12 Trasabilitate KPI (â†’ Charter)

Backoffice solid â†’ mai puÈ›ine tichete & re-lucrÄƒri â†’ NRR â†‘, churn â†“.

Flags & DLQ controlate â†’ Error budget protejat, checkout CR stabil.

Rapoarte fiscale corecte â†’ risc legal 0 â†’ focus pe MRR.






17) Calitate & Testare â€” â€œfÄƒrÄƒ surprize Ã®n producÈ›ieâ€
17.1 Èšinte & KPI de calitate

Defect escape rate (buguri apÄƒrute doar Ã®n Prod): â‰¤ 2 per lunÄƒ, fÄƒrÄƒ â€High/Criticalâ€.

Flake rate E2E â‰¤ 2% (rolling 14 zile).

Timp PRâ†’verde: â‰¤ 12 min (unit+contract+build); rulare e2e pe preview â‰¤ 8 min.

Acoperire: core lib/* â‰¥ 80% (lines), route handlers â€publiceâ€ 100% contracte acoperite.

SLO test suite: p95 unit < 4 min, contract < 5 min, e2e < 8 min.

17.2 Piramida de testare (ce, cu ce, unde)
A) Unit (rapid, izolabil)

Scope: lib/gating.ts, lib/exports.ts, lib/simulate.ts, lib/scoring.ts, utilitare.

Tooling: Vitest (sau Jest), ts-node, ts-morph pentru fixture-uri.

Practici: TDD pentru reguli (entitlements, rate-limit), stubs pentru timp/ID.

B) Contract (API & webhook)

Scope: route handlers Next.js (/api/*), Stripe webhook, /api/run/[moduleId], /api/export.

Tooling: Supertest/undici, validare cu Zod (schema input/output), Prism/Dredd opÈ›ional pe OpenAPI.

AsigurÄƒri: idempotency, coduri eroare standard, cÃ¢mpuri obligatorii.

C) Integrare (DB/queue/external in test-mode)

Scope: Supabase (Postgres RLS), Storage S3-compat (linkuri semnate), Stripe test-mode, Postmark sandbox.

Tooling: DB â€ephemeralâ€ pe CI, seed deterministic (factory bot), testcontainers (dacÄƒ nu folosim Supabase hosted test).

Teste tipice: webhook idempotent, prorratare upgrade, dunning, checksum/manifest la export.

D) E2E (fluxuri reale)

Scope: signupâ†’verifyâ†’MFA, pricingâ†’checkoutâ†’export, Admin refund, Webhook redeliver, Blog publishâ†’sitemap.

Tooling: Playwright (preferat) sau Cypress pe Preview Deploy.

Practici: date seed per run (org demo), â€screenshots+traces as artifactsâ€, retries 1â€“2.

E) Accesibilitate

Tooling: axe-core (Playwright), lint ARIA Ã®n CI.

Gates: 0 â€critical/seriousâ€ pe home, pricing, generator, dashboard, billing.

F) Securitate

SAST: Semgrep/CodeQL pe PR (fail la High/Critical).

DAST: OWASP ZAP pe Stage (sÄƒptÄƒmÃ¢nal + Ã®nainte de lansÄƒri majore).

Scannere: dependency audit, secret scanner (regex + trufflehog).

Teste negative: bypass RLS, upload MIME non-allowlist, CSRF pe rute sensibile.

G) PerformanÈ›Äƒ

Lighthouse CI (mobile) pe preview: /, /pricing, /blog/:slug, /dashboard (authed).

k6: /api/run/*, /api/webhooks/stripe (idempotency sub load), p95 < 300 ms, error < 0.2%.

17.3 Medii & date

Dev: DB local sau Supabase project â€devâ€; fixture-uri.

Preview (per PR): Vercel preview + Supabase â€preview-<sha>â€; seed cu: 1 org, 5 users (toate rolurile), 1 sub Pro activÄƒ, 3 produse, 5 posts.

Stage: Stripe test-mode, Postmark sandbox, domain protejat; DAST/k6 ruleazÄƒ aici.

Prod: doar synthetic probes.

Date test: nu clonÄƒm PII din Prod; generÄƒm sintetic; exportÄƒm doar meta.

17.4 CI: pipeline pe PR (rapid) È™i pe main (complet)

Pe PR (max ~12 min):

Typecheck + ESLint.

Unit + Contract.

Build + Preview Deploy (Vercel).

Playwright (pe preview) + axe.

Lighthouse CI (mobile) + bugete.

SAST + Dependency Audit.

Artefacte: rapoarte, screenshots, traces, LH JSON.

Pe main:

Tot ce e pe PR + Integration DB, Stripe webhook fixtures.

k6 pe Stage; ZAP scan.

PublicÄƒ rezultate Ã®n Dashboards Calitate; gate â€releaseâ€ dacÄƒ e roÈ™u.

17.5 Praguri & quality gates (fail hard)

Coverage: core libs â‰¥ 80% lines; dacÄƒ scade >2pp Ã®ntr-un PR â†’ fail.

Axe: 0 critical/serious (fail).

Lighthouse: Perf â‰¥ 90, A11y â‰¥ 95 pe rutele urmÄƒrite (fail).

k6: p95 > 300 ms sau error > 0.2% (fail).

SAST: High/Critical (fail), Medium (warn + ticket).

DAST: High/Critical (fail Stage, blocare release).

17.6 DoR / DoD per epic (sablon operabil)

Definition of Ready (DoR)

Scope clar + criterii de succes legate de KPI.

Scheme Zod pentru input/output + OpenAPI draft.

Teste minime definite (unit, contract, e2e).

Flags/rollout plan + metrici (events).

Riscuri & rollback plan.

Definition of Done (DoD)

Toate testele verzi; acoperire atinsÄƒ.

Lighthouse & axe trecute pe rutele afectate.

Telemetrie: events & dashboards create/actualizate.

Docs: changelog + runbook (dacÄƒ relevant).

Canary OK; auto-revert setat pe KPI critic (ex: checkout CR).

17.7 Checklist de lansare (release)

DB: migraÈ›ii aplicate, seed minim OK, RLS policies verificate.

Chei: Stripe, Supabase, Postmark â€“ prezente È™i corecte; rotire dacÄƒ e cazul.

Robots: robots.txt conform (Stage: noindex; Prod: allow).

Cache warm: revalidare ISR pagini â€greleâ€ (home, pricing, blog index).

Webhooks: health check Stripe â†’ 200; DLQ gol.

Backups: snapshot DB â€pre-releaseâ€.

Status page: anunÈ› fereastrÄƒ (dacÄƒ existÄƒ) + monitor pornit.

17.8 P0 scenarii (trebuie sÄƒ existe teste)

Auth & RBAC: signup+verify, login OAuth, MFA enroll/challenge, revocare sesiune, device binding, rate-limit login, RLS cross-org negativ.

Billing: checkout success, invoice.paid â†’ entitlements, upgrade/downgrade (prorratare), dunning 3 paÈ™i, refund, dispute created/closed (efecte).

Exports: .txt/.md/.pdf/.json, checksum SHA256, watermark trial, bundle.zip doar Enterprise, linkuri semnate (TTL, max downloads).

Run: simulate (free) vs live (Pro+), DoR invalid â†’ blocat, DoD score <80 â†’ blocat/label â€Simulatedâ€.

CMS: draftâ†’reviewâ†’approveâ†’scheduleâ†’publish, sitemap & RSS regenerat, OG/Schema corect.

Shop digital: add-to-cartâ†’checkoutâ†’download; revocare la refund/dispute.

API: /api/v1/run idempotency, /export rights, /entitlements corect; webhooks semnate + retry+DLQ.

Admin: rol schimbat, feature flag on/off (rollout 5%â†’25%â†’100%), re-deliver webhook, raport fiscal generat.

Securitate: CSP setatÄƒ, CSRF token validat, upload allowlist, SSRF blocat.

Perf: bugete LCP/INP/CLS & TTFB respectate pe rutele cheie.

17.9 Exemple minime (indicativ)

Unit (Vitest) â€“ gating export PDF

it('blocks pdf export for non-Pro', () => {
  const ok = withEntitlementGate({plan:'creator', feature:'export.pdf'});
  expect(ok).toMatchObject({ok:false, reason:'plan'});
});


Contract â€“ Stripe webhook idempotent

await request(app).post('/api/webhooks/stripe')
 .set('Stripe-Signature', sig)
 .send(fixture('invoice.paid'));
await request(app).post('/api/webhooks/stripe')
 .set('Stripe-Signature', sig)
 .send(fixture('invoice.paid'))
 .expect(200); // no duplicates in DB


Playwright â€“ checkoutâ†’export

test('pro user can export pdf', async ({ page }) => {
  await page.goto('/pricing'); await page.getByRole('button', {name:'Go Pro'}).click();
  await completeStripeTestCheckout(page);
  await page.goto('/generator'); await runLiveAndWait(page);
  await expect(page.getByText('Download PDF')).toBeVisible();
});


k6 â€“ /api/run p95

import http from 'k6/http'; import { check, sleep } from 'k6';
export const options = { vus:20, duration:'2m', thresholds:{http_req_duration:['p(95)<300']}};
export default ()=>{ const r=http.post(__ENV.API+'/api/v1/run/M01', payload, {headers}); check(r,{ '200':(res)=>res.status===200}); sleep(1); };

17.10 GuvernanÈ›Äƒ calitate & Ã®mbunÄƒtÄƒÈ›ire continuÄƒ

Bug triage sÄƒptÄƒmÃ¢nal (PM+Eng+Support): root-cause, etichetÄƒ â€preventabilâ€, acÈ›iuni la backlog.

Flake board: testele marcate flaky â†’ fix â‰¤ 7 zile sau â€quarantine + ticketâ€.

Raport calitate lunar: defecte, flake, SLO test suite, timp PRâ†’verde, trend LH.

17.11 AcceptanÈ›Äƒ (DoD pentru capitolul 17)

Pipeline PR + main configurat (toate etapele), artefacte salvate.

Bugete Lighthouse + axe + k6 active (gates).

Set minim de teste P0 implementat È™i verde.

DoR/DoD template Ã®n repo; checklist release Ã®n /docs/checklists/release.md.

Dashboard â€Qualityâ€ live (defecte, flake, runtime timpi, LH scoruri).

17.12 LegÄƒtura cu KPI (â†’ Charter)

Gates automate â†’ mai puÈ›ine outage & regresii â‡’ Error budget Ã®n È›intÄƒ, Uptime â‰¥ 99.9%.

Bugete CWV È›inute Ã®n CI â‡’ CR landingâ†’pricing È™i TTV â‰¤ 10 min cresc.

Testele P0 pe plÄƒÈ›i/export â‡’ protejeazÄƒ MRR, scade churn È™i suportul.





18) CI/CD & InfrastructurÄƒ â€” â€lansezi des, lansezi sigurâ€
18.1 Obiectiv & SLO DevOps

Scop: pipeline rapid, verificat, reversibil, cu vizibilitate totalÄƒ È™i cost controlat.

SLO pipeline: p95 â€PRâ†’verdeâ€ â‰¤ 12 min (lint+unit+contract+build), e2e pe preview â‰¤ 8 min.

SLO deploy: p95 â€mergeâ†’prod canaryâ€ â‰¤ 6 min, â€promote canaryâ†’100%â€ â‰¤ 30 min (dacÄƒ trece gates).

MTTR release ratat: â‰¤ 10 min (rollback automat sau promovare release anterior).

18.2 Branching & release train

Trunk-based: ramuri scurte feat/*, fix/*; PR obligatoriu Ã®n main (protecÈ›ie: 2 review-uri, checks verzi).

Conventional Commits + SemVer (taguri vX.Y.Z pe main).

Release train: zilnic dacÄƒ existÄƒ PR gata (fÄƒrÄƒ â€batchingâ€ artificial); â€freezeâ€ doar pe ferestre comunicate.

18.3 Pipeline (GitHub Actions recomandat)

Pe PR (rapid, â‰¤ ~12 min):

Typecheck + ESLint

Unit + Contract (Vitest + Supertest/Zod)

Build (Next.js)

Preview Deploy (Vercel) + set env preview

Playwright + axe pe preview (fluxuri P0 scurte)

Lighthouse CI (mobil) pe 3 rute cheie

SAST (Semgrep/CodeQL) + Dependency Audit

Approvals post-install (vezi Â§18.11) â€“ fail dacÄƒ nu sunt aprobate

Pe main (complet):

tot ce e pe PR

Integration (DB/Storage/Stripe test)

k6 (API p95 < 300ms) pe Stage

DAST (OWASP ZAP) pe Stage

Publish artefacte (rapoarte, SBOM, LH, traces)

Gate canary (criterii obiective; vezi Â§18.6)

18.4 Environments & routing

Dev (local): .env.local, DB dev, Stripe test, Postmark sandbox.

Preview (per PR): Vercel Preview + Supabase â€preview-<sha>â€ (ephemeral) + seed minim.

Stage: domeniu stage.<brand>; Stripe test; acces protejat; ruleazÄƒ DAST/k6.

Prod: app.<brand>; Stripe live; status page conectat.

Config env (exemplu chei critice):
NEXT_PUBLIC_APP_URL, SUPABASE_URL/ANON/SERVICE, STRIPE_SECRET, POSTMARK_TOKEN, SENTRY_DSN, ALGOLIA_*, CONSENT_MODE_ENABLED, RULESET_VERSION.

18.5 IaC (Terraform/Pulumi)

Module: vercel_project, supabase_project, storage_bucket (S3/R2), dns, status_page, stripe_webhook (url + secret), alerting (PagerDuty/Slack).

State: remote backend (S3 + DynamoDB lock / Supabase pg-state).

Tagging: env, service, owner, cost-center.

Drift check Ã®n CI; plan â†’ review â†’ apply numai cu 2 aprobÄƒri (infra + securitate).

18.6 Deploy model (Vercel-first) & canary

Preview Deploy per PR (auto).

Prod Canary: distribuÈ›ie trafic 5% â†’ 25% â†’ 100% (15 min paÈ™i).

Gates canary (auto-promote sau auto-revert):

Perf: LCP P75 /pricing â‰¤ 2.5s; erori 5xx â‰¤ 0.3% (15 min).

Biz: checkout success â‰¥ 98.5%, fÄƒrÄƒ scÄƒdere CR > 10% faÈ›Äƒ de media 7 zile.

Securitate: 0 hituri noi High/Critical (SAST/DAST).

Auto-revert dacÄƒ oricare gate picÄƒ; alerte Slack #releases + #sec-alerts.

18.7 MigraÈ›ii DB (safe rollout)

Strategie â€expand â†’ migrate â†’ contractâ€:

Expand: adaugÄƒ coloane/tabele noi compatibile.

Migrate data: job controlat; progres logat.

Contract: scoate vechiul doar dupÄƒ o versiune.

Ordine deploy: Stage (verificÄƒri funcÈ›ionale) â†’ Prod (hold manual scurt).

Rollback: nu facem â€downâ€ distrugÄƒtor Ã®n Prod; restore PITR Ã®ntr-o instanÈ›Äƒ paralelÄƒ + â€blue/green cutoverâ€ dacÄƒ e nevoie.

Seed minim pentru preview/stage (fÄƒrÄƒ PII reale).

18.8 Backups & DR

RPO â‰¤ 1h: snapshot Postgres orar (+ zilnic 30 zile).

RTO â‰¤ 4h: runbook DR + exerciÈ›iu trimestrial (table-top + restaurare realÄƒ Ã®n Stage).

Storage: versionare + cross-region (dacÄƒ suportÄƒ).

Checklist DR: cap. separat Ã®n /docs/runbooks/dr.md.

18.9 Secret management

Surse: Vercel Encrypted Env + (opÈ›ional) un manager central (Doppler/Vault/1Password).

Principii: niciun secret Ã®n client; rotaÈ›ie trimestrialÄƒ; acces pe nevoie; audit acces; pull-request secret scan (trufflehog).

Env groups per mediu; propagare automatÄƒ la preview cu valori minime/mascate.

18.10 Feature flags (server-side)

Store Ã®n DB (feature_flags), citite server-side (nu Ã®n client).

Rollout: targetare dupÄƒ plan/org, % random, time window.

Kill-switch global; auto-revert dacÄƒ scade checkout CR sau cresc 5xx (vezi Â§18.6).

Docs per flag (scop, metrici, data de expirare).

18.11 â€Approvalsâ€ pentru dependenÈ›e cu scripturi post-install

PoliticÄƒ: orice pachet cu postinstall/install/preinstall/prepare ne-vendorized cere aprobare explicitÄƒ.

MecanicÄƒ Ã®n CI: pas pnpm approve-builds comparÄƒ pnpm-lock.yaml cu allowlist (approved_builds.json).

RegulÄƒ: fÄƒrÄƒ aprobare â†’ pipeline fail; motiv È™i link securitate Ã®n PR.

Audit lunar la allowlist (expirÄƒ aprobÄƒri vechi).

18.12 Observabilitate DevOps

Events: deploy.started/succeeded/reverted, db.migration.started/completed, canary.promoted/reverted, feature_flag.changed.

Dashboards: timp PRâ†’verde, duratÄƒ deploy, rata revert, costuri per env, alerte recente.

Alerte: revert automat, eÈ™ec migraÈ›ie, drift IaC, lipsÄƒ backup, creÈ™tere cost > 20% WoW.

18.13 Change management & aprobÄƒri

2-person rule: Stripe/Tax, migraÈ›ii destructurante, flags cu impact la preÈ›/plan.

Changelog la fiecare release (public + intern).

Status page: anunÈ› ferestre È™i incidente; post-mortem Ã®n 48h.

18.14 Cost guardrails

Bugete pe proiect/mediu (Vercel/Supabase/observabilitate).

Alerte la depÄƒÈ™iri; etichetare resurse; autoscale cu limite.

Raport lunar cost/utilizare (â‚¬/MRR %) â€“ È›intÄƒ â‰¤ 15% din MRR.

18.15 Exemple (schelet)

.github/workflows/ci.yml (extras)

on: [pull_request]
jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v3
      - run: pnpm i --frozen-lockfile
      - run: pnpm lint && pnpm typecheck && pnpm test:unit && pnpm test:contract
      - run: pnpm build
      - run: pnpm approve-builds  # fail dacÄƒ apar postinstall noi
      - name: Deploy Preview
        run: pnpm vercel:deploy:preview
      - run: pnpm test:e2e:playwright
      - run: pnpm lhci autorun
      - run: pnpm sast && pnpm deps:audit


.github/workflows/release.yml (extras)

on:
  push:
    branches: [main]
jobs:
  stage:
    steps: [ ... run integration, k6, zap ... ]
  prod-canary:
    needs: stage
    steps: [ deploy canary, run gates, promote-or-revert ]

18.16 AcceptanÈ›Äƒ (DoD pentru capitolul 18)

Workflows PR & main operative; artefacte (LH/SAST/k6/ZAP/SBOM) salvate.

Preview deploy funcÈ›ional cu seed minim È™i Playwright pe preview.

Canary cu auto-promote/auto-revert dupÄƒ gates (perf/biz/sec).

IaC aplicÄƒ proiectele (Vercel, Supabase, DNS, webhooks, alerte) fÄƒrÄƒ drift.

Backups active, test DR trecut; RPO/RTO mÄƒsurate.

Secret management configurat; rotaÈ›ie documentatÄƒ; secret scan activ.

Regula â€post-install approvalsâ€ activÄƒ â€“ testatÄƒ (blocare fÄƒrÄƒ aprobare).

Dashboards DevOps live (timpi, revert rate, costuri, alerte).

18.17 LegÄƒtura cu KPI (â†’ Charter)

Canary + auto-revert protejeazÄƒ Uptime 99.9% È™i error budget â‰¤ 0.1%.

Pipelines rapide + preview cu e2e â†’ TTV â‰¤ 10 min (utilizator) nu se degradeazÄƒ.

IaC + DR â†’ risc operaÈ›ional mic â†’ NRR mai bun, churn mai mic.

Cost guardrails â†’ hosting+vendor â‰¤ 15% MRR (rolling 30d).






19) Migrare & Import â€” â€fÄƒrÄƒ pierderi, fÄƒrÄƒ dubluri, fÄƒrÄƒ downtime inutilâ€
19.1 Obiectiv & KPI

Obiectiv: aducem datele necesare Ã®n noul sistem fÄƒrÄƒ pierderi, fÄƒrÄƒ dubluri, cu integritate referenÈ›ialÄƒ 100%, È™i timp de tÄƒiere (cutover) â‰¤ 60 min.

KPI verificabile:
â€“ Fidelitate datÄƒ: abateri numerice (conturi, comenzi, subs, fiÈ™iere) â‰¤ 0.1%.
â€“ Dedupliare rezidualÄƒ: â‰¤ 0.1% per entitate.
â€“ Integritate FK: 100%, zero rÃ¢nduri orfane.
â€“ Rata reluare job (retry) < 3%.
â€“ Troughput: â‰¥ 5k rÃ¢nduri/min la import incremental; â‰¥ 50 MB/min media streaming.

19.2 Domenii & prioritate (ce migrÄƒm)

Identitate & acces: users, orgs, memberships, roles (primul).

Comercial: products, variants, prices, coupons.

Financiar (istoric): subscriptions, invoices, payments, refunds, disputes (doar metadate; fÄƒrÄƒ card data).

ConÈ›inut: posts, pages, categories, tags, media, revisions.

Comenzi (shop): orders, order_items, fulfillments, shipments.

Telemetrie & audit (opÈ›ional, agregat): events, audits (rezumat, NU raw PII).

Multi-tenant: toate rÃ¢ndurile primesc/confirmÄƒ org_id corect.

19.3 Strategii (alegere per sursÄƒ)
Strategie	CÃ¢nd	Avantaje	Riscuri
Big-bang	volum mic/mediu, dependinÈ›e simple	un singur freeze; mai puÈ›ine runde	fereastrÄƒ mai mare, risc de rollback complex
Incremental + cutover scurt (recomandat)	volum mare, sisteme active	rehearsal/dry-run, delte mici, rollback uÈ™or	logicÄƒ delta, reconciliere

Recomandare: incremental (T-14: uscat, T-7: repetiÈ›ie, T-1: delta finalÄƒ, T0: freeze scurt + cutover).

19.4 Plan operaÈ›ional (incremental)

Discovery & inventar: listezi tabele/cÃ¢mpuri, volume, PII, â€surse adevÄƒrâ€.

Contracte de date: defineÈ™ti schema de destinaÈ›ie + mapping (enum-uri, normalizÄƒri).

Registry ID: tabel migration_map(source, table, source_id, target_table, target_id, status, seen_at).

Dry-run #1 (T-14): import parÈ›ial (10â€“20%), mÄƒsori KPI, notezi abateri.

Dry-run #2 (T-7): volum Ã®ntreg fÄƒrÄƒ cutover, validezi rapoarte.

Delta sync (T-7â†’T-1): rulezi la 6â€“12h; captezi modificÄƒrile.

Freeze (T0âˆ’60â€™): opreÈ™ti scrierile Ã®n vechiul sistem (sau redirecÈ›ionezi), rulezi delta finalÄƒ.

Cutover (T0): comuÈ›i DNS/feature flag; smoke tests; backout predefinit.

Hypercare (T0+72h): monitorizare, fixuri rapide, reconciliere.

19.5 Mapare cÃ¢mpuri (reguli)

Chei & tipuri: toate ID-urile devin UUID v7 la destinaÈ›ie; pÄƒstrezi external_id pentru trasabilitate.

Timp & fus orar: toate datele Ã®n UTC (timestamptz), normalizezi input (RFC3339).

Enum-uri: mapare explicitÄƒ (ex.: status: 'enabled'|'disabled' â†’ 'active'|'blocked').

Monede: sume Ã®n minor units (int), pÄƒstrezi currency.

i18n: conÈ›inut tradus Ã®n tabele *_i18n(locale, â€¦).

GDPR: fÄƒrÄƒ parole; dacÄƒ existÄƒ hashuri legacy, marchezi must_reset_password=true.

Exemplu de mapping (produse):

SRC.products.name       â†’ DST.products.name
SRC.products.slug       â†’ DST.products.slug (slugify strict, unic pe org)
SRC.products.type       â†’ map(product_type)  // digital|physical|bundle
SRC.variants.sku        â†’ DST.variants.sku (unique per product)
SRC.prices.amount_float â†’ DST.prices.unit_amount (int, minor units)

19.6 Dedupliare (reguli per entitate)

users: cheie canonicÄƒ lower(trim(email)); fuzzy pe name doar pentru raport, nu pentru merge automat.

orgs: slug normalizat; dacÄƒ coliziune â†’ sufix â€-2â€, alertezi operatorul.

products: org_id + slug; variants: product_id + sku; coupons: org_id + code.

posts/pages: org_id + slug (+ locale); mutÄƒ duplicatele Ã®n revisions.

media: SHA256 fiÈ™ier; dacÄƒ acelaÈ™i hash â†’ referinÈ›Äƒ unicÄƒ, nu re-upladezi.

SQL util:

-- gÄƒseÈ™te duplicate users pe email (case-insensitive)
select lower(email) e, count(*) c from src_users group by lower(email) having count(*)>1;

19.7 FiÈ™iere & checksum (integritate media)

Calcul SHA256 la sursÄƒ; compari cu hash la destinaÈ›ie dupÄƒ upload.

S3 streaming: PUT cu Content-MD5 (dacÄƒ suportat) + meta x-hash-sha256; verifici Content-Length.

Multipart: nu te baza pe ETag ca MD5; pÄƒstreazÄƒ propriul SHA256.

Retry: 3Ã— exponential; la eÈ™ec â†’ media_dlq cu motiv; niciun link public pÃ¢nÄƒ la validare.

Node (indicativ):

import { createHash } from 'crypto';
const sha256 = (buf) => createHash('sha256').update(buf).digest('hex');

19.8 ExecuÈ›ie & idempotency

Chunking: 1â€“5k rÃ¢nduri / 10â€“50 MB media; paralelism controlat (CPUÃ—2).

TransacÈ›ii: â€per chunkâ€; commit la succes.

UPSERT: ON CONFLICT (...) DO UPDATE doar pentru cÃ¢mpuri non-sensibile; NU suprascrii status plÄƒÈ›i.

RLS: importul ruleazÄƒ cu service role; setezi app.org_id Ã®nainte de operaÈ›ii; reactivezi RLS la final.

Idempotent: verifici migration_map Ã®nainte de inserare; dacÄƒ existÄƒ, sari sau actualizezi.

Exemplu UPSERT:

insert into products(id, org_id, slug, name, type)
values($1,$2,$3,$4,$5)
on conflict(org_id, slug) do update set name=excluded.name, type=excluded.type
returning id;

19.9 ValidÄƒri pre/post (contabilitate de date)

Pre-import:

contezi rÃ¢nduri per entitate; sumÄƒ venituri pe perioade; numÄƒr media & total bytes.

Post-import:

verifici egalitatea (Â± toleranÈ›a admisÄƒ);

FK checks (0 orfani);

rapoarte: subs active, MRR estimat, orders status mix;

SEO: sitemap plin, slug unice, linkuri valide.

Raport final (automat): migration_report.json (diferenÈ›e, duplicate rezolvate, erori, timp).

19.10 Stripe & plÄƒÈ›i (atenÈ›ie legalÄƒ & PCI)

Card data NU se migreazÄƒ (niciodatÄƒ).

DacÄƒ vii din Stripe: imporÈ›i customers/subscriptions prin API/CSV Stripe (mode â€importâ€), pÄƒstrezi external_sub_id; facturile istorice rÄƒmÃ¢n la Stripe (link).

DacÄƒ vii din alt procesator: creezi conturi Stripe + â€re-collect paymentâ€ (portal link) sau coupon compensator pentru perioada rÄƒmasÄƒ.

MRR de start: calculezi din subs active; verifici vs. sursÄƒ.

19.11 Content (CMS) & i18n

posts/pages â†’ creezi Ã®ntÃ¢i rÃ¢ndul sursei (ex: en), apoi *_i18n pentru locale;

media re-inseratÄƒ cu SHA256; re-scrii referinÈ›ele Ã®n MDX (mapper de cÄƒi);

redirects: generezi 301 pentru sluguri schimbate.

19.12 Tooling & CLI (schelet)
pf-import \
  --source=csv|mysql|api \
  --entities=users,orgs,products,media,orders \
  --org-map=map.json \
  --dry-run \
  --chunk=2000 \
  --parallel=4 \
  --since=2024-01-01 \
  --report=/exports/migration_report.json


Moduri: discover, validate, import, delta, cutover, rollback.

Loguri: ND-JSON pe disc + tabel migration_logs(run_id, entity, ok, fail, duration_ms, notes).

19.13 Observabilitate & SLO de migrare

Events: migration.started, chunk.ok/fail, entity.done, dlq.media, cutover.started/completed, rollback.triggered.

Dashboards: progres pe entitate, ratÄƒ erori, timp estimat, throughput, top cauze eÈ™ec.

Alerte: eroare > 1% 10min â†’ pauzÄƒ automatÄƒ È™i ping operator; DLQ media > 100 â†’ escaladare.

19.14 Rollback & backout

Ãnainte de cutover: snapshot DB + listÄƒ resurse Storage (manifest).

Backout T0: readuci DNS/flag la vechiul sistem; curÄƒÈ›i datele inserate dupÄƒ T0 (folosind migration_map); validezi.

Post-cutover: ferestre â€degrupareâ€ 72h; È›ine ambele sisteme read-only pÃ¢nÄƒ la â€Verdeâ€.

19.15 Securitate & GDPR

DPIA pentru operaÈ›iunea de migrare dacÄƒ conÈ›ine PII.

Transport criptat (TLS), fiÈ™iere Ã®n tranzit ZIP+AES (dacÄƒ e nevoie).

Temp storage: È™ters la final (max 7 zile); accesul pe nevoie; log acces.

Minimizare: nu imporÈ›i cÃ¢mpuri inutile (ex.: IP istoric).

19.16 AcceptanÈ›Äƒ (DoD pentru capitolul 19)

Plan scris (timeline T-14â†’T0), dry-runs 2Ã— trecute.

Mapping validat, migration_map & CLI funcÈ›ionale.

ValidÄƒri pre/post automate + raport migration_report.json.

FiÈ™iere cu SHA256 verificate; media_dlq gol sau rezolvat.

Stripe: subs active reflectate, portal funcÈ›ional pentru re-collect.

Cutover executat Ã®n â‰¤ 60 min; backout testat.

Documente: runbook migrare & rollback Ã®n /docs/runbooks/migration.md.

19.17 Trasabilitate KPI (â†’ Charter)

Cutover scurt & zero dubluri â†’ uptime & Ã®ncredere (brand) â‡’ NRR protejat.

Integritate financiarÄƒ (subs/invoices/ordere) â†’ MRR/Payback realiste.

Import media corect (SHA256) â†’ lipsÄƒ 404/SEO pierderi â‡’ acquisition stabil.






20) Ghid Operare & Suport â€” â€cÃ¢nd arde, È™tii ce faci È™i spuiâ€
20.1 Obiectiv & arie

Obiectiv: rÄƒspuns rapid, previzibil È™i verificabil la incidente + suport clienÈ›i fÄƒrÄƒ fricÈ›iune, cu transparenÈ›Äƒ publicÄƒ.

Scope: Playbook incidente (sev-levels, rota on-call), runbooks acÈ›ionabile, status page, SLA public / SLO intern, comunicare schimbÄƒri (changelog + newsletter), retenÈ›ie date & È™tergere cont.

20.2 Roluri & responsabilitÄƒÈ›i (Ã®n incident)

Incident Commander (IC): decide, deblocheazÄƒ, coordoneazÄƒ (de obicei Eng Lead/SRE on-call).

Comms Lead: redacteazÄƒ update-urile pentru status page / clienÈ›i (PM/Support Lead).

Scribe: timestamp/cronologie, linkuri, evidenÈ›e (oricine din echipa on-call).

Domain SMEs: payments, infra, securitate, content, tax (DRI per domeniu).

20.3 Severity matrix & timpi
Nivel	Exemplu	MTTA (ack)	Update public	MTTR (È›intÄƒ)
Sev-1	PlÄƒÈ›i indisponibile â‰¥10 min, exporturi plÄƒtite blocate global, breach confirmat	â‰¤ 5 min	15 min È™i apoi la 15 min	â‰¤ 2 h
Sev-2	Degradare TTFB/LCP globalÄƒ, API 5xx >0.5% 15 min, webhook DLQ mare	â‰¤ 15 min	30 min È™i apoi la 30â€“60 min	â‰¤ 8 h
Sev-3	Buguri non-critice, regresii UX, indexare SEO parÈ›ialÄƒ	â‰¤ 4 h	la rezolvare sau recap sÄƒptÄƒmÃ¢nal	â‰¤ 5 zile

DefiniÈ›ii de Ã®nchidere: â€Mitigatedâ€ (impact oprit), â€Resolvedâ€ (cauzÄƒ fixatÄƒ), â€Post-mortem publicatâ€.

20.4 Rota on-call & program

24Ã—7 SRE/Eng primar, secundar: Eng Lead; Business Comms: PM + Support Lead.

Fus orar operaÈ›ional: EET/EEST; rota acoperÄƒ È™i US/EU prin handed-off.

Handover zilnic (10 minute): tichete deschise, erori, alerte.

20.5 Status Page (public)

Componente: Web App, Admin, API, Exports, Webhooks, Payments, Search, Email.

Indicatori: uptime, latenÈ›Äƒ P50/P95, rate 4xx/5xx, backlog webhooks/DLQ.

Procese: AnunÈ› mentenanÈ›e planificate (â‰¥48h), incident live (template), timeline + RCA (Ã®n 48h).

Template update scurt

[Incident â€¢ Sev-1] Payments degraded in EU
Start: 14:05 EEST â€¢ Impact: checkout fails ~40% â€¢ Workaround: retry
Next update in 15 min. Track: status.promptforge.com

20.6 Playbook incidente (executive summary)
A) Payments down (Stripe)

ConfirmÄƒ sÄƒnÄƒtatea la Stripe status + logurile noastre.

Canary OFF / auto-revert ultim release dacÄƒ corelat cu deploy.

ActiveazÄƒ fallback â€Plata Ã®n procesareâ€ + porneÈ™te reconciliere la 5 min.

Comms: update la 15 min; dupÄƒ rezolvare, verificÄƒ facturi/entitlements.

B) Exports failing

VerificÄƒ coada â€exportsâ€ È™i Storage semnÄƒturi/permisiuni.

Degrade la Simulated cu watermark; marcheazÄƒ exporturile eÈ™uate pentru re-try.

Comms: mesaj UI pe export + status page; dupÄƒ fix â†’ re-livrare automatÄƒ.

C) Webhooks backlog / DLQ

InspecteazÄƒ ultimii 50 fails, clasificÄƒ (4xx client vs 5xx server).

CreÈ™te workers + retry cu backoff; notificÄƒ clienÈ›ii cu endpoint nevalid.

Comms: â€degradare livrareâ€ Sev-2; close cÃ¢nd backlog < prag.

D) Perf degradat (LCP/TTFB)

ConfirmÄƒ RUM; coreleazÄƒ cu deploy (assets, image, font).

Auto-revert dacÄƒ gating-ul perf picÄƒ (vezi CI/CD).

Comms: Sev-2 perf; RCA: asset / query / cache.

E) Securitate (suspect/confirmat)

IzoleazÄƒ vector, opreÈ™te rulÄƒri riscante, reset secret/chei afectate.

NotificÄƒ DPO/Legal; dacÄƒ e breach â†’ notificÄƒri legale â‰¤72h.

Comms: model â€œsecurity advisoryâ€; post-mortem cu acÈ›iuni.

Fiecare playbook are runbook detaliat Ã®n /docs/runbooks/* (comenzi, screen-uri, rollback).

20.7 Runbooks (schelet minim reutilizabil)
RUNBOOK: <Numele>
Scop & Sev: <Sev-1/2/3>
Detectare: <alerte, grafice, praguri>
DiagnozÄƒ: <paÈ™i, comenzi, dashboards, log queries>
Mitigare: <feature flag, revert, rate-limit, degrade>
Remediere: <fix steps, migraÈ›ii, verificÄƒri>
Verificare: <test P0, KPIs>
Comms: <status text, frecvenÈ›Äƒ>
ÃnvÄƒÈ›are: <post-mortem TODO>


Runbooks predefinite: payments_down, exports_queue_stuck, webhooks_dlq_high, perf_lcp_regression, db_pressure, storage_s3_errors, search_index_lag, auth_spike_login_fail.

20.8 SLA public & SLO intern (pe planuri)
SLA (public)
Plan	Uptime lunar	RÄƒspuns suport iniÈ›ial	Canal
Free/Creator	best-effort	2 zile lucrÄƒtoare	email
Pro	99.9%	â‰¤ 8 h business	email + in-app
Enterprise	99.95%	â‰¤ 1 h (24Ã—7 incident)	email + Slack Connect

SLA nu acoperÄƒ terÈ›i independenÈ›i (ex.: Stripe outage).

Credite (Enterprise): la Ã®ncÄƒlcÄƒri majore, credite procentuale pe MRR (definite contractual).

SLO (intern)

Uptime: â‰¥ 99.9%; Error budget â‰¤ 0.1%/lunÄƒ.

Checkout success: â‰¥ 98.5%.

Export success: â‰¥ 99.0% (excl. user cancel).

MTTA/MTTR: conform tabel Â§20.3.

Support CSAT: â‰¥ 4.6/5; backlog tichete > 7 zile = 0.

20.9 Suport & canale

Email (Pro/Ent prioritar), in-app (widget), Slack Connect (Enterprise).

Program: L-V 09:00â€“18:00 EET/EEST (Pro); 24Ã—7 pentru incidente Sev-1 (Enterprise).

Limbi: EN/RO (ES la cerere Enterprise).

KB/Help Center: ghiduri â€Cum sÄƒâ€¦â€, FAQ, diagrame, â€Known issuesâ€.

Macros & triere: taxonomy: Billing, Exports, API, Performance, CMS, Shop, Security.

KPIs suport: FRT, FCR (First Contact Resolution), CSAT, tichete/1000 MAU, median resolution time, â€reason codesâ€ top.

20.10 Comunicare schimbÄƒri

Changelog public (docs/changelog): entry la fiecare release (Added/Changed/Fixed/Security).

Newsletter (lunar): highlight-uri, foaie de parcurs, â€breaking changesâ€.

Deprecation policy: notificare â‰¥ 60 zile pentru API/flags; email la Pro/Ent; â€compat layerâ€ unde e posibil.

ComunicÄƒri fiscale/juridice: email targetat (org owners) + entry changelog.

20.11 Politici retenÈ›ie date & È™tergere cont

RetenÈ›ie:

Loguri tehnice: 90 zile (rotire).

Audit trail: 18 luni.

Facturi/financiar: conform legislaÈ›iei (ex. 10 ani UE).

Backups: snapshot orar 7 zile; zilnic 30 zile.

È˜tergere cont (GDPR-ready):

Export date: JSON + arhivÄƒ exporturi (link semnat, TTL).

Delete: soft-delete imediat, hard-delete â‰¤ 30 zile (exceptÃ¢nd evidenÈ›e fiscale).

Anonimizare pentru conÈ›inut/comentarii asociate, pÄƒstrÃ¢nd integritatea rapoartelor.

ExcepÈ›ii: dispute legale, prevenirea fraudei, obligaÈ›ii fiscale.

Flow UI: /account/delete â†’ confirmare â†’ email â€Are you sure?â€ â†’ fereastrÄƒ de graÈ›ie 7 zile (undo) â†’ È™tergere.

20.12 Telemetrie operaÈ›ionalÄƒ & rapoarte

Evenimente: incident.open/ack/mitigated/resolved, status.update, ticket.open/closed, sla.breach, dsr.request/closed.

Dashboards:

Incidente: volum/lunÄƒ, MTTA/MTTR, root-cause clasÄƒ (code, config, third-party).

Suport: FRT, CSAT, backlog, rezoluÈ›ii pe categorie, NPS (Pro/Ent).

Conformitate: DSR SLA, consimÈ›ÄƒmÃ¢nt, export/erase la timp.

Revizuiri: sÄƒptÄƒmÃ¢nal (operare), lunar (board snapshot).

20.13 È˜abloane gata de folosit

A) Comunicat incident (status page)

Titlu: [Sev-X] <scurt> â€¢ <componentÄƒ>
Impact: <ce vede utilizatorul>
Timeline: <start, detecÈ›ie, acÈ›iuni>
Workaround: <dacÄƒ existÄƒ>
UrmÄƒtorul update: <timp>
RCA (dupÄƒ rezolvare): <cauzÄƒ>, <fix>, <acÈ›iuni preventive>


B) Post-mortem (blameless)

Rezumat: <1 paragraf>
Impact: <metrice, clienÈ›i>
Timeline: <timestamps cheie>
CauzÄƒ rÄƒdÄƒcinÄƒ: <tehnicÄƒ, proces>
Ce a mers bine / rÄƒu: <bullet-uri>
AcÈ›iuni & owner & due date: <listÄƒ>
LecÈ›ii: <2â€“3>


C) AnunÈ› schimbare (newsletter/changelog)

Ce se schimbÄƒ + de ce | Cine e afectat | CÃ¢nd intrÄƒ Ã®n vigoare
Ce trebuie sÄƒ faci | Link docs | Suport & Ã®ntrebÄƒri


D) Confirmare È™tergere cont

Solicitare: <data> | Cont: <org/user>
Export: <link/TTL> | È˜tergere finalÄƒ Ã®n: <data-limitÄƒ>
Contact: privacy@<brand>

20.14 AcceptanÈ›Äƒ (DoD pentru capitolul 20)

Status page live cu componente È™i uptime monitorizat.

Playbook + runbooks pentru top 8 scenarii (payments, exports, webhooks, perf, DB, storage, search, auth).

Rota on-call documentatÄƒ + pager integrat.

SLA public & SLO intern publicate È™i urmÄƒrite; alerte la Ã®ncÄƒlcÄƒri.

Help Center public (KB), macros suport, triere funcÈ›ionalÄƒ.

Changelog & newsletter operaÈ›ionale; deprecation policy publicatÄƒ.

Flow DSR & Account Deletion testate end-to-end; retenÈ›ie aplicatÄƒ.

Telemetrie live (incidente, suport, conformitate) + rapoarte lunare.

20.15 LegÄƒtura cu KPI (â†’ Charter)

MTTA/MTTR mici + comunicare transparentÄƒ â‡’ NRR â†‘, churn â†“.

SLA/SLO respectate â‡’ Ã®ncredere de brand, Freeâ†’Paid mai mare.

Politici clare de date â‡’ risc legal scÄƒzut, focus pe MRR.







21) Roadmap & Etapizare â€” â€livrezi Ã®n valuri, blochezi riscul la poartÄƒâ€
21.1 Vedere de ansamblu

Horizon: 24 sÄƒptÄƒmÃ¢ni, 3 faze, release continuu (trunk-based, canary).

Principiu: fiecare fazÄƒ are KPI comerciale + tehnice mÄƒsurabile È™i un Gate Go/No-Go. DacÄƒ un Gate picÄƒ â†’ auto-revert la versiunea anterioarÄƒ, amÃ¢nare funcÈ›ionalitÄƒÈ›i noi, focus pe remediere.

21.2 Faza 1 (sÄƒpt. 0â€“8) â€” â€Baza care produce baniâ€

Obiectiv: prima monetizare realÄƒ (MRR iniÈ›ial), artefacte exportabile, blog/CMS pentru SEO.

Scope (trebuie sÄƒ fie live)

Auth & RBAC (email+parolÄƒ, OAuth Google, MFA, recovery, RLS).

PlÄƒÈ›i (Stripe Billing + Tax): planuri Free/Creator/Pro/Enterprise, trial Pro 7 zile, portal.

Catalog module (M01â€“M50) + 7D; Simulate Test (gratis) vs Run Real Test (Pro+).

Export pipeline: .txt (Free), .md (Creator+), .pdf/.json (Pro+), checksum; watermark Ã®n trial.

CMS & Blog: landing, pricing, docs/api, changelog, blog (MDX), sitemap + RSS.

Shop digital (MVP): liste/produse digitale, cupoane, 1-page checkout.

Admin minim: users/orgs, billing, webhooks log, flags, exporturi.

Observabilitate: RUM CWV, logs metrice, dashboards minime.

Milestones (ritm sugerat)

S0â€“1: Auth+RBAC, DB+RLS, design tokens, landing/pricing.

S2â€“3: Stripe (checkout, portal, taxe), gating & entitlements, export .txt/.md.

S4â€“5: Run Simulate/Live, evaluator & scoreâ‰¥80 gate, export .pdf/.json.

S6: CMS/blog cu SEO, sitemap/RSS, 3 demo bundles pe landing.

S7â€“8: Shop digital, cupon, Admin minim, stabilizare + hardening.

Gate Faza 1 (Go/No-Go)
KPI Comercial	ÈšintÄƒ	KPI Tehnic	ÈšintÄƒ
MRR iniÈ›ial	â‰¥ â‚¬5k	TTFB P75 (EU/US)	< 220 ms
Freeâ†’Paid (28d)	â‰¥ 4%	LCP P75	< 2.8 s
Activation (primul export â‰¤10m)	â‰¥ 50%	Uptime lunar	â‰¥ 99.9%
Checkout success	â‰¥ 98.5%	Error budget	â‰¤ 0.1%

DoD Faza 1: toate rutele critice trec Lighthouse (Perf â‰¥90, A11y â‰¥95), SAST/DAST fÄƒrÄƒ High/Critical, webhooks Stripe idempotente, seed + 3 demo bundles publice.

21.3 Faza 2 (sÄƒpt. 8â€“16) â€” â€Deschizi pieÈ›e È™i suprafeÈ›e noiâ€

Obiectiv: extindere ofertÄƒ, reducere fricÈ›iune globalÄƒ, integrabilitate.

Scope (trebuie sÄƒ fie live)

Produse fizice + fulfillment (inventar, transportator, tracking).

i18n (ro/en + una secundarÄƒ), hreflang, localizare preÈ›uri.

API public (v1, read + run) cu rate-limit, webhooks out semnate + DLQ.

CÄƒutare (BM25/Algolia) pentru CMS/Shop.

Backoffice extins: rapoarte fiscale (EU VAT OSS/US), re-deliver webhooks, flags avansate.

Milestones

S8â€“10: fizic+fulfillment, rapoarte fiscale; Admin Orders.

S11â€“12: i18n (UI+content), hreflang, sitemaps locale.

S13â€“14: API v1 + OAuth CC, webhooks out + DLQ.

S15â€“16: cÄƒutare, hardening, QA multi-locale.

Gate Faza 2
KPI Comercial	ÈšintÄƒ	KPI Tehnic	ÈšintÄƒ
MRR	â‰¥ â‚¬15k	hreflang valid	100%
Freeâ†’Paid	â‰¥ 6%	Lag webhook P95	â‰¤ 2 s
AOV Shop	+10% vs F1	LCP P75 (multi-locale)	< 2.5 s
NRR (rolling 3m)	â‰¥ 102%	API 95p /run	< 300 ms

DoD Faza 2: API v1 documentat (/docs/api + OpenAPI), webhooks out cu retry+DLQ, rapoarte fiscale validate pe sandbox, i18n fÄƒrÄƒ fallback rate >2%.

21.4 Faza 3 (sÄƒpt. 16â€“24) â€” â€CÄƒutare inteligentÄƒ, AI-ops, marketplace internâ€

Obiectiv: productivitate & re-venituri prin automÄƒri + reÈ›ea internÄƒ.

Scope (trebuie sÄƒ fie live)

CÄƒutare avansatÄƒ: hibrid (BM25 + embeddings) pentru module/conÈ›inut.

AI-ops: joburi programate (rezumare, scoring, recrawl), cu cost caps & degrade la Simulated.

Marketplace intern (curatoriat): bundles/module presets (fÄƒrÄƒ terÈ›i la Ã®nceput).

Enterprise nicÈ™e: white-label PDF, seats avansate, rate-limits crescute.

Milestones

S16â€“18: embeddings pipeline, indexare incrementalÄƒ, UI search.

S19â€“21: joburi AI-ops (queue, cost guard), dashboards usage.

S22â€“24: marketplace intern (curatori, licenÈ›iere), enterprise add-ons.

Gate Faza 3
KPI Comercial	ÈšintÄƒ	KPI Tehnic	ÈšintÄƒ
MRR	â‰¥ â‚¬25k	Cost vendors / MRR	â‰¤ 15%
NRR	â‰¥ 105%	INP P75	< 200 ms
Exporturi â€paidâ€ / total	â‰¥ 55%	Job fail rate AI-ops	< 1%

DoD Faza 3: cost caps + auto-degrade funcÈ›ionale, marketplace cu licenÈ›iere clarÄƒ, search hibrid mÄƒsurat pe relevanÈ›Äƒ (NDCG@10 â‰¥ 0.7 pe set de test).

21.5 GuvernanÈ›Äƒ & ritualuri pe faze

Weekly: KPI stand-up (MRR, Freeâ†’Paid, TTV, CWV, error budget, checkout).

Fortnightly: Steering (reprioritizÄƒri, flags, canary outcomes).

Pre-Gate Review (final de fazÄƒ): tabel KPI vs È›inte + rapoarte calitate (SAST/DAST/LH/k6), raport fiscal & SEO, RCA-uri Ã®nchise.

21.6 Resurse & capacitate (estimativ)

Nucleu: 1 PM, 2 FE, 1 BE, 1 SRE/DevOps, 1 Designer, 1 Data/Analytics, 0.5 Legal/GRC, 0.5 Finance/Tax, 1 Support (part-time iniÈ›ial).

Peak F2â€“F3: +1 FE (shop/i18n), +0.5 BE (API/webhooks), +0.5 Data (search/AI-ops).

21.7 Pachete de livrare pe fazÄƒ (artefacte obligatorii)

F1: /, /generator, /pricing, /dashboard, /docs/api live; 3 demo bundles; manual operare billing; dashboards Revenue/Funnel/Perf.

F2: /admin extins (orders, flags, webhooks), /api/v1 + docs, i18n complet, rapoarte fiscale export.

F3: /search avansat, /marketplace, AI-ops dashboards.

21.8 MÄƒsuri de protecÈ›ie cross-phase

Auto-revert canary: dacÄƒ checkout CR scade > 10% P7D sau LCP /pricing > 2.5s 24h.

Cost guardrails: vendor/hosting â‰¤ 15% MRR (rolling 30d).

Securitate: 0 High/Critical (SAST/DAST) ca Gate absolut.

Legal/GDPR: DSR SLA â‰¤ 7 zile, consimÈ›ÄƒmÃ¢nt valid (Consent Mode).

21.9 Roadmap vizual (rezumat)

S0â€“8: Bazele monetizabile â†’ primul cash.

S8â€“16: Extindere & integrare â†’ pieÈ›e noi.

S16â€“24: InteligenÈ›Äƒ & re-venituri â†’ scalare ARPU/NRR.

21.10 AcceptanÈ›Äƒ (DoD Roadmap)

Tabel KPI pe fazÄƒ Ã®n /docs/spec/21_roadmap_kpi.md.

Checklists Gates (PDF/MD) ataÈ™ate pe release-urile de fazÄƒ.

Dashboard â€Roadmapâ€ (live) cu semafoare pe KPI: verde/galben/roÈ™u.






22) Matrice Riscuri â€” â€vezi devreme, loveÈ™ti repede, revii sigurâ€
22.1 Cadru & scorare

Scor risc (R): R = Probabilitate (1â€“5) Ã— Impact (1â€“5)
Praguri: 15â€“25 = Critic, 8â€“14 = Major, 4â€“7 = Mediu, 1â€“3 = Minor.

Impact mÄƒsurat pe: (a) MRR/checkout, (b) Uptime/Error budget, (c) Legal/Tax, (d) Brand/SEO.

ToleranÈ›Äƒ: niciun risc â€Criticâ€ acceptat fÄƒrÄƒ fallback documentat + exerciÈ›iu de DR.

22.2 Heatmap (vedere rapidÄƒ)
Domeniu	Risc	P	I	Scor	Status
Securitate	Breach / RLS misconfig	3	5	15	Critic
PlÄƒÈ›i	Stripe outage / 3DS fail	3	5	15	Critic
Taxe	TVA/US tax greÈ™it pe facturi	3	4	12	Major
SEO	De-indexare (robots, canonical, hreflang)	3	4	12	Major
Cost cloud	DepÄƒÈ™ire buget >20% WoW	4	3	12	Major
Third-party	Schimbare de API / limitÄƒ	3	3	9	Mediu
Date	Pierdere/CorupÈ›ie (DB/Storage)	2	5	10	Major
PerformanÈ›Äƒ	LCP/TTFB degrade â€“ auto-revert	4	2	8	Mediu
Conformitate	DSR > 7 zile, cookie/consent greÈ™it	2	4	8	Mediu
AI-ops/cost	Abuz API / export live runaway	3	3	9	Mediu
22.3 Registru de risc (detaliat â€” top 8)
R1. Breach / RLS misconfig (Securitate) â€” R=15 (Critic)

Cauze: policy RLS lipsÄƒ/greÈ™itÄƒ; token leakage; CSP relaxatÄƒ.

Semnale timpurii: spike rls.denied, acces cross-org Ã®n log simulat, ZAP/DAST hit â€Highâ€.

PrevenÈ›ie: ASVS L2, test RLS pe 3 org, SAST/DAST gates, secrets rotate trimestrial.

Mitigare: kill-switch export/API; izolarea traficului; reset chei; notificare DPO; plan RCA 48h.

Owner: Security Eng + Legal/GRC. Runbook: /docs/runbooks/security_breach.md.

R2. Stripe outage / 3DS fail (Procesator plÄƒÈ›i) â€” R=15 (Critic)

Cauze: incident Stripe, 3DS provider down, greÈ™eli webhooks.

Semnale: checkout success < 98.5% (60m), invoice.payment_failed spike, status Stripe roÈ™u.

PrevenÈ›ie: hosted Checkout, idempotency, healthcheck webhook, test fixtures pe CI.

Mitigare (fallback provider):

Plan A: queue â€Pending Paymentâ€ + UI â€Plata Ã®n procesareâ€; reconciliere la 5 min.

Plan B: Lemon/Paddle â€standbyâ€ pentru one-time (doar digitale) â€” comutare prin feature flag.

Owner: Finance/Tax + Eng Lead. Runbook: /docs/runbooks/payments_down.md.

R3. TVA/US tax greÈ™it (Taxe) â€” R=12 (Major)

Cauze: configurare greÈ™itÄƒ Stripe Tax/TaxJar; adrese incomplete; bug localizare.

Semnale: tichete fiscale, diferenÈ›e Ã®n raport, devieri >1% pe È›arÄƒ/stat.

PrevenÈ›ie: sandbox fiscal, teste lunare EU/US, È™abloane facturÄƒ verificate, RoPA actualizatÄƒ.

Mitigare: re-emitere facturi (credit notes), mail clienÈ›i, blocare temporarÄƒ vÃ¢nzÄƒri pe jurisdicÈ›ia afectatÄƒ.

Owner: Legal/GRC + Finance. Runbook: /docs/runbooks/tax_correction.md.

R4. De-indexare SEO (robots/canonical/hreflang) â€” R=12 (Major)

Cauze: robots.txt greÈ™it la deploy, canonical nepotrivit, hreflang incomplet.

Semnale: GSC erori, scÄƒdere bruscÄƒ Ã®n index, crawl anomalies.

PrevenÈ›ie: CI checks (robots/canonical/hreflang), sitemaps per secÈ›iune, review SEO la PR.

Mitigare: hotfix robots, rebuild sitemaps, â€Fetch as Googleâ€/Resubmit; revert release.

Owner: Marketing + PM. Runbook: /docs/runbooks/seo_deindex.md.

R5. Cost cloud > buget (Vercel/Supabase/observ.) â€” R=12 (Major)

Cauze: trafic neprevÄƒzut, leaks, query scumpe, logs/traces flood.

Semnale: cost â†‘ >20% WoW, alerte vendor, cuÈ›ite la rate-limit.

PrevenÈ›ie: hard caps, sampling logs/traces, query budgets, â€cost dashboardsâ€.

Mitigare: throttling export/live, sampling agresiv, dezactivare features costisitoare (flags), renegociere limite.

Owner: Eng Lead + Finance. Runbook: /docs/runbooks/cost_overrun.md.

R6. Schimbare API / limitÄƒ (Third-party) â€” R=9 (Mediu)

Cauze: versiuni noi, EOL, throttling.

Semnale: 429/4xx pattern, anunÈ›uri vendor, test de compat eÈ™uat.

PrevenÈ›ie: contract tests cu sandbox, monitor â€changelog monitorsâ€, tampon lÄƒÈ›ime rate-limit.

Mitigare: â€compat layerâ€, retry/backoff, fallback intern (cache), switch provider cÃ¢nd existÄƒ.

Owner: Eng Lead. Runbook: /docs/runbooks/third_party_change.md.

R7. Pierdere/CorupÈ›ie date (DB/Storage) â€” R=10 (Major)

Cauze: migraÈ›ii greÈ™ite, bug workers, S3 ACL.

Semnale: integritate FK eÈ™uatÄƒ, checksum mismatch, 500 pe export link.

PrevenÈ›ie: expandâ†’migrateâ†’contract, back-ups RPO â‰¤1h, verif. checksum, test DR trimestrial.

Mitigare: restore PITR Ã®n paralel + blue/green cutover; reconstrucÈ›ie din manifest + SHA256.

Owner: SRE. Runbook: /docs/runbooks/data_restore.md.

R8. Abuz/Runaway cost (API/AI-ops) â€” R=9 (Mediu)

Cauze: cheie expusÄƒ, script flood, bucle export live.

Semnale: spike run.live, api.rate_limit.hit, cost forecast â†‘.

PrevenÈ›ie: rate-limit dur, cost caps per org, degrade la â€Simulatedâ€, chei rotaÈ›ie.

Mitigare: revocÄƒ chei, throttling temporar, credit â€goodwillâ€ dacÄƒ e necesar.

Owner: PM + Eng. Runbook: /docs/runbooks/api_abuse.md.

22.4 MÄƒsuri transversale (mitigÄƒri obligatorii)

Fallback provider: rezervÄƒ Lemon/Paddle pentru vÃ¢nzÄƒri digitale â€one-timeâ€ (flag).

Contracte SLA: Stripe, Supabase, Vercel, Postmark â€” SLA/credits & canale â€statusâ€.

Rate-limit dur: login/OTP/export/API; â€cost capsâ€ pe live tests/export.

Test fiscal sandbox: scenarii EU B2C/B2B + US CA/NY lunar (autotest + raport).

Auto-revert: cÃ¢nd checkout CR scade >10% P7D sau LCP /pricing > 2.5s/24h.

ExerciÈ›iu DR trimestrial: restore DB + storage + cutover script.

Checklist SEO Ã®n CI: robots, canonical, hreflang, sitemaps.

22.5 Monitorizare & alerte (KPI-triggers)

Payments: checkout success < 98.5%/60m â†’ Sev-2.

SEO: erori GSC â€Pages droppedâ€ sau hreflang invalid > 50 â†’ alert Marketing.

Cost: > 20% WoW oricÄƒrui vendor â†’ alert Finance+Eng.

Security: High/Critical Ã®n SAST/DAST â†’ blocare release.

Perf: LCP P75 /pricing > 2.5s 60m â†’ auto-revert.

Tax: diferenÈ›Äƒ > 1% Ã®ntre raport intern È™i Stripe Tax â†’ Sev-2 fiscal.

22.6 Template registru risc (operabil)
ID: R-<numÄƒr> | Domeniu: <Securitate/PlÄƒÈ›i/...> | Scor: <PÃ—I>
Descriere: <enunÈ› scurt>
Cauze probabile: <bullets>
Semnale timpurii: <metrics, evenimente, status vendor>
PrevenÈ›ie: <controale/gates/teste>
Mitigare: <fallback/flags/runbook>
Owner (A/R): <nume rol> | Revizie: <lunar/trimestrial>
Stare: Open/Mitigated/Closed | Ultimul review: <data>

22.7 AcceptanÈ›Äƒ (DoD pentru capitolul 22)

Matrice + registru complet Ã®n /docs/risk/risk_register.md (cu scoruri È™i owner).

Runbooks pentru top 8 riscuri + exerciÈ›iu DR logat.

Alerte configurate pe toÈ›i triggerii de mai sus (Slack + email).

Fallback provider testat (sandbox) + ghid comutare (flags).

Raport lunar â€Risk & Resilienceâ€ (scoruri, incidente, acÈ›iuni Ã®n curs).

22.8 LegÄƒtura cu KPI (â†’ Charter)

Securitate/PlÄƒÈ›i controlate â‡’ protejezi MRR, Payback, NRR.

SEO stabil â‡’ acquisition constant â‡’ Freeâ†’Paid mai mare.

Cost guardrails â‡’ hosting+vendor â‰¤ 15% din MRR.

Auto-revert & DR â‡’ Uptime 99.9%, error budget â‰¤ 0.1%.





23) Anexe Standard â€” â€kitul operabil, verificabil, versiuni la sÃ¢ngeâ€
23.1 StructurÄƒ Ã®n repo (SSOT clar)
/docs/
  policies/
    csp_policy.md
    backup_policy.md
    incident_response_policy.md
    access_control_policy.md
    data_retention_policy.md
  templates/
    erd.dbml
    c4_context.puml
    c4_container.puml
    c4_component.puml
    raci_template.md
    dod_template.md
    dpia_template.md
    dpa_template.md
    dpia_checklist.md
    wcag_audit_checklist.md
    asvs_traceability.csv
  checklists/
    release_gate.md
    seo_gate.md
    perf_gate.md
    security_gate.md
  versions/
    manifest.json         # hash-uri, versiuni, TTL, owner per anexÄƒ


Reguli: fiecare anexÄƒ are Owner, TTL (revizuire: 90/30/7 zile), Last-Reviewed, checksum SHA256 È™i link spre testul care o dovedeÈ™te Ã®n CI.

23.2 Politici (operabile, cu dovadÄƒ)
A) CSP Policy (/docs/policies/csp_policy.md)

Obiectiv KPI: 0 rapoarte XSS confirmate; score ZAP â€script injectionâ€ = 0.

PoliticÄƒ minimÄƒ:

default-src 'self';
script-src 'self' 'strict-dynamic' 'nonce-{runtime}' https://js.stripe.com;
style-src 'self' 'unsafe-inline';
img-src 'self' data: blob:;
connect-src 'self' https://api.stripe.com https://*.supabase.co;
frame-ancestors 'none';


SLO: header prezent pe 100% rute.

DovadÄƒ Ã®n CI: test E2E care verificÄƒ headerul; raport ZAP ataÈ™at la release.

B) Backup Policy (/docs/policies/backup_policy.md)

Èšinte: RPO â‰¤ 1h, RTO â‰¤ 4h.

Plan: snapshot DB orar + zilnic 30 zile; versionare Storage; cross-region.

Test recurent: restaurare trimestrialÄƒ (Stage) + raport.

DovadÄƒ: log â€DR exerciseâ€ + checksum dump.

C) Incident Response (/docs/policies/incident_response_policy.md)

Sev levels, roluri, timpi (MTTA/MTTR) ca Ã®n cap. 20.

Obligatoriu: post-mortem Ã®n 48h, fÄƒrÄƒ blame.

DovadÄƒ: link post-mortem + timeline statuspage.

D) Access Control (/docs/policies/access_control_policy.md)

Principii: RBAC, JIT, MFA obligatoriu pentru admin, revizie trimestrialÄƒ permisiuni.

JML: Joiner/Movers/Leaver cu SLA 24h.

DovadÄƒ: export trimestrial permisiuni + semnÄƒtura reviewer.

E) Data Retention & Deletion (/docs/policies/data_retention_policy.md)

RetenÈ›ie: loguri 90d, audit 18m, financiar 10y, backups 30d.

È˜tergere cont: export (JSON+ZIP), È™tergere â‰¤ 30 zile (except. fiscale).

DovadÄƒ: tabele de retenÈ›ie + job logs + E2E delete flow.

23.3 Template-uri (gata de umplut)
ERD (DBML) â€” /docs/templates/erd.dbml
Project PromptForge {
  database_type: "PostgreSQL"
}
Table orgs { id uuid [pk]; name text; plan text; created_at timestamp }
Table users { id uuid [pk]; email text [unique]; name text; created_at timestamp }
Table memberships { id uuid [pk]; org_id uuid [ref: > orgs.id]; user_id uuid [ref: > users.id]; role_key text }
Table subscriptions { id uuid [pk]; org_id uuid [ref: > orgs.id]; plan text; status text; current_period_end timestamp }
Table runs { id uuid [pk]; org_id uuid [ref: > orgs.id]; module_id text; status text; score int }

C4 Context/Container (PlantUML) â€” /docs/templates/c4_context.puml
@startuml
!include C4_Context.puml
Person(user, "User")
System_Boundary(pf, "PromptForge") {
  System(web, "Web App")
  SystemDb(db, "Postgres (RLS)")
  System_Ext(stripe, "Stripe")
}
Rel(user, web, "Uses")
Rel(web, db, "R/W")
Rel(web, stripe, "Checkout / Billing")
@enduml

RACI â€” /docs/templates/raci_template.md
| Activitate | R | A | C | I | KPI afectat |
|---|---|---|---|---|---|
| Checkout & Taxe | Finance | PM | Eng, Legal | Data, Support | Checkout success, Payback |

DoD â€” /docs/templates/dod_template.md
**Feature:** <nume> â€¢ **Owner:** <nume> â€¢ **Due:** <data>
- [ ] Teste unit/contract/integr./e2e verzi
- [ ] Lighthouse â‰¥ 90, axe 0 crit/ser
- [ ] Telemetrie & dashboards actualizate
- [ ] Docs + changelog
- [ ] Gate business: CR/scoreâ‰¥80/â€¦ OK

DPIA â€” /docs/templates/dpia_template.md
Titlu | Sistem | Date PII | Baza legalÄƒ | Riscuri | MÄƒsuri | Rezidual | DPO OK
---|---|---|---|---|---|---|---

DPA â€” /docs/templates/dpa_template.md
PÄƒrÈ›i | Scop | Tip date | Sub-procesatori | Transferuri | SLA | Securitate | È˜tergere
---|---|---|---|---|---|---|---

DPIA Checklist â€” /docs/templates/dpia_checklist.md

 Mapare date/fluxuri

 Minim PII / scop adecvat

 Drepturi subiect

 MÄƒsuri tehnice (MFA, RLS, CSP)

 Evaluare risc (Ã®nainte/dupÄƒ)

 Aprobare DPO

WCAG Audit â€” /docs/templates/wcag_audit_checklist.md

 Contrast 4.5:1 / 3:1 large

 Focus vizibil / ordine tab

 ARIA landmarks/labels

 Media alt text 100%

 Prefers-reduced-motion respectat

 Raport axe: 0 crit/ser

ASVS Traceability â€” /docs/templates/asvs_traceability.csv
ASVS_ID,Descriere,Implementare,Test,Status,PR_Link
V2.1.1,Autorizare pe fiecare cerere,server route guards + RLS,e2e_auth.spec.ts,PASS,<url>

23.4 Manifest & versionare (tamper-evident)

/docs/versions/manifest.json

{
  "csp_policy.md": {"sha256":"<hash>","owner":"Security Lead","ttl_days":90,"last_reviewed":"2025-08-15"},
  "backup_policy.md": {"sha256":"<hash>","owner":"SRE","ttl_days":90,"last_reviewed":"2025-08-12"},
  "erd.dbml": {"sha256":"<hash>","owner":"Eng Lead","ttl_days":30,"last_reviewed":"2025-08-18"}
}


Gate CI: dacÄƒ ttl_days depÄƒÈ™it â‡’ eÈ™ueazÄƒ buildul; dacÄƒ hash Ã®n manifest â‰  hash curent â‡’ cere review.

23.5 Dovada Ã®n CI (teste automate pe anexe)

CSP: Playwright verificÄƒ header pe 3 rute; ZAP raporteazÄƒ â€0 Highâ€.

Backup/DR: scriptul de restaurare ruleazÄƒ trimestrial Ã®n Stage; exportÄƒ â€DR_report.mdâ€.

Access: job care listeazÄƒ permisiuni admin â‡’ diffa faÈ›Äƒ de snapshot; dacÄƒ diferÄƒ fÄƒrÄƒ ticket, fail.

RetenÈ›ie: query de verificare a È™tergerii logurilor > 90 zile; raport ataÈ™at.

WCAG: pnpm axe:check pe rute cheie; rezultate Ã®ncÄƒrcate ca artefacte.

ASVS: verificÄƒ asvs_traceability.csv sÄƒ aibÄƒ 100% mape pentru â€V2, V3, V4â€ (auth, session, access control).

23.6 AcceptanÈ›Äƒ (DoD pentru Anexe)

Toate fiÈ™ierele de mai sus existÄƒ, au Owner/TTL/Hash Ã®n manifest.

Testele corelate ruleazÄƒ Ã®n CI È™i au artefacte salvate.

Ultimele revizii â‰¤ TTL; taskuri de review programate (calendar).

Linkuri cÄƒtre anexe apar Ã®n release notes È™i Ã®n /docs/README.md.

23.7 Trasabilitate KPI/SLO (cum le influenÈ›eazÄƒ)

CSP/ASVS â‡’ reduce riscul (breach) â‡’ NRR stabil, error budget protejat.

Backup/DR â‡’ livrare continuÄƒ â‡’ Uptime â‰¥ 99.9%, RPO/RTO atinse.

WCAG â‡’ SEO + CR mai bun â‡’ Freeâ†’Paid creÈ™te, TTV â‰¤ 10m.

DPIA/DPA/RetenÈ›ie â‡’ risc legal scÄƒzut â‡’ focus pe MRR È™i extindere.

Verdict (executabil)

Anexele sunt sistem, nu â€documente moarteâ€: au proprietar, TTL, versiune, hash È™i probe Ã®n CI. Fiecare promisiune are testul ei. ProiecteazÄƒ pentru edge, multi-tax, multi-brand, AI-ops, ancoreazÄƒ Ã®n KPI/SLO È™i norme reale (OWASP ASVS, WCAG 2.2, GDPR, PCI).
Simbolic: â€Scheletul decide viteza â€” defineÈ™te oasele acum.â€