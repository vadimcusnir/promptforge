project: PROMPTFORGE_v3
semver: 1.0.0
is_ssot: true
X-PF-Ruleset-Version: 1.0.0

policies:
  ui_cannot_override_defaults: true
  glitch_protocol:
    enabled: true
    version: 1.0.0
    scope:
      targets: ["h1","h2"]                  # doar H1/H2
      max_keywords_per_page: 6              # ≤6 cuvinte-cheie / pagină
    timing:
      total_ms: [280, 420]                  # 280–420ms
      once_per_viewport_entry: true         # o singură execuție la intrare
      hover_replay:
        enabled: true
        cooldown_ms: 6000
    determinism:
      seed_source: "text_hash"              # seed din text (hash)
      prng: "mulberry32"
    accessibility:
      overlay: true                         # overlay vizual peste text real
      aria_hidden_overlay: true
      sr_reads_real_text: true
    performance:
      driver: "requestAnimationFrame"
      infinite_loops: false
      avoid_style_thrashing: true           # fără reflow agresiv
      fixed_overlay_width_ch: true          # setezi width Nch ⇒ anti-CLS
    ambient:
      respect_reduced_motion: true          # oprește la prefers-reduced-motion
      html_data_motion_off_disables: true   # oprește la data-motion="off"
    selectors:
      container: ".kw[data-glitch]"
      real_text: ".kw__text"
      overlay: ".kw__glitch"
    whitelist_symbols: [">","<","|","/","\\","{","}","[","]","~","_","-","#","$","%","*","+","=","^",";",":"]
    acceptance:
      - page.h1_h2_glitch_count <= 6
      - every_kw_has_children == [".kw__text",".kw__glitch"]
      - overlay_has_aria_hidden_true == true
      - animation_total_duration_ms in [280,420]
      - animation_runs_once_on_viewport_entry == true
      - hover_replay_cooldown_ms >= 6000
      - deterministic_output_for_same_text == true
      - overlay_width_equals_text_length_ch == true
      - reduced_motion_disables == true
      - no_infinite_loops == true
      - perf.cpu_pct <= 1
      - perf.frame_time_ms_p95 <= 16
  ui_overlays:
    enabled: true
    target_selector: "#bg-overlay"
    route_class_map:
      "/": "route-marketing"
      "/generator": "route-generator"
      "/dashboard": "route-dashboard"
    state_class_map:
      quote_active: "quote-active"
      quote_focus: "quote-focus"
    diagnostics:
      log_level: "warn"        # no console.log în prod
    performance:
      hardware_accelerate: true
      respect_reduced_motion: true
    css_vars:
      route_marketing: { "--overlay-gradient": "linear-gradient(180deg, rgba(0,0,0,.1), rgba(0,0,0,.7))" }
      route_generator: { "--overlay-gradient": "radial-gradient(60% 60% at 50% 40%, rgba(0,0,0,.0), rgba(0,0,0,.6))" }
      route_dashboard: { "--overlay-gradient": "linear-gradient(160deg, rgba(0,0,0,.05), rgba(0,0,0,.65))" }
  content_policy:
    site_language: en
    reject_non_english: true
    enforce_at: [runtime_api, ci, seo_headers, routing]

security:
  agents_enabled: true
  live_test_enabled: false               # kill-switch de produs
  tool_allowlist:
    http: ["api.openai.com", "api.anthropic.com", "api.groq.com"]
    storage: ["supabase.storage"]
    internal_apis: ["/api/gpt-editor","/api/gpt-test","/api/export","/api/run"]
  sandbox:
    enabled: true
    network: "allowlist"                 # sau "deny_by_default"
    fs_scope: "/tmp/agents"              # niciun write în proiect
    cpu_ms_limit: 120000
    mem_mb_limit: 512
    timeout_ms: 20000
  budgets:
    tokens_max: 12000
    requests_per_min: 60
    cost_usd_max_run: 1.5

validation:
  enum_only: true
  raise_on_invalid: true
  require_replace_domains:
    enabled: true
    rules:
      - from: "promptforge.app"
        to: "chatgpt-prompting.com"
      - from: "PromptForge.com"
        to: "chatgpt-prompting.com"

prompts:
  enum_only: true
  guardrails_global:
    - "You must respond in English only. Reject or rewrite non-English input to English."
    - "Do not execute code outside the permitted sandbox."
    - "Do not access URLs outside the allowlist."
    - "Do not read or send secrets/PII. Mask everything in logs."
    - "If score < 80, stop the export."
  structure_required: [ROLE_GOAL, CONTEXT_7D, OUTPUT_SPEC, PROCESS, GUARDRAILS, EVAL_HOOKS, TELEMETRY]

api:
  rate_limit:
    editor: { rpm: 60 }
    test:   { rpm: 30 }
    run:    { rpm: 30, per_org: true }
  required_headers:
    - "x-org-id"
    - "x-run-id"
  cors:
    origins: ["https://chatgpt-prompting.com","https://promptforge.app"]
    methods: ["GET","POST","OPTIONS"]
    headers: ["content-type","authorization","x-org-id","x-run-id"]

export:
  formats: [txt, md, json, pdf, zip]
  watermark_on_trial: true
  manifest_required: true
  checksum_algo: "sha256"
  storage_bucket: "bundles"

  motion:
    enabled: true
    intents: ["guide","state","explain"]
    placement_allow:
      hero: false
      header_nav_export: false
      background_ambient_only: true
      how_it_works: true
      generator_steps: true
      success_empty_states: true
      gallery_routes: ["/test-ambient","/brand/motion"]
    budget:
      primary_per_page: 1
      micro_max: 4
      infinite_visible: 0
      cpu_pct_max: 1
      frame_budget_ms: 16
    params:
      durations_ms: { micro: [180,220], transition: [300,400] }
      easing: "cubic-bezier(.2,.8,.2,1)"
      translate_px_max: 12
      scale_range: [0.98, 1.02]
      opacity_range: [0.85, 1]
      loop_visible_secs_max: 2
    flags: { motion_primary: true, motion_micro: true, brand_scenes: false }
    respect_reduced_motion: true

acceptance:
  ui_overlays:
    - overlays.apply_within_ms <= 50
    - overlays.cleanup_on_unmount == true
    - overlays.classlist_has_single_route_class == true
    - overlays.quote_focus_controls_tokens_opacity == true
    - overlays.no_console_log_in_production == true
  motion:
    - page.primary_motion_count <= 1
    - page.micro_motion_count <= 4
    - page.infinite_visible == 0
    - perf.cpu_pct <= 1
    - perf.frame_time_ms_p95 <= 16
    - a11y.respects_reduced_motion == true
    - every_animation.intent in ["guide","state","explain"]
