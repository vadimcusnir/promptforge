---
description: GPT Live pentru Editor & Test Engine (înlocuiește simularea).
globs:
  - "app/api/gpt-*/**"
alwaysApply: false
---

# 04-gpt-live-editor-test.mdc — GPT Live Integration

## Înlocuiește simulările
- **simulateGptEditing()** → /api/gpt-editor (GPT live)
- **simulateGptResponse()** → /api/gpt-test (GPT live + scoring)
- Păstrează interface-ul UI identic, schimbă doar backend-ul

## /api/gpt-editor endpoint
```typescript
interface EditorRequest {
  prompt: string;
  action: "optimize" | "tighten" | "expand" | "crisis_mode";
  parameter_set_7d: ParameterSet7D;
  context?: string;
}

interface EditorResponse {
  optimized_prompt: string;
  changes_made: string[];
  confidence_score: number;
  tokens_used: number;
  cost_usd: number;
}
```

## /api/gpt-test endpoint  
```typescript
interface TestRequest {
  prompt: string;
  parameter_set_7d: ParameterSet7D;
  module_id: string;
}

interface TestResponse {
  scores: {
    clarity: number;        // 0-100
    execution: number;      // 0-100  
    ambiguity: number;      // 0-100 (lower is better)
    business_fit: number;   // 0-100
    composite: number;      // weighted average
  };
  verdict: "pass" | "partial_pass" | "fail";
  feedback: {
    clarity: string;
    execution: string;
    ambiguity: string;
    business_fit: string;
  };
  suggestions: string[];   // ["tighten", "optimize_enterprise"]
  telemetry: {
    model: string;
    tokens: number;
    duration_ms: number;
    cost_usd: number;
  };
}
```

## Rate limiting & gating
- **canUseGptTestReal** flag pentru Test Engine
- Free plan: doar simulări
- Creator+: acces la /api/gpt-editor  
- Pro+: acces la /api/gpt-test cu GPT live
- Rate limits: Pro 50/h, Enterprise 200/h

## Model configuration
- Editor: GPT-4o, temperature=0.3, max_tokens=2000
- Test Engine: GPT-4o, temperature=0.2, max_tokens=1000  
- Retry logic: 3 attempts cu exponential backoff
- Fallback la simulări dacă API down

## Evaluator AI integration
- Post-run evaluation cu rubrică 0–100 pe 4 criterii
- Threshold enforcement: clarity≥80, execution≥80, ambiguity≤20, business_fit≥75
- Auto-suggestions bazate pe scoruri: "tighten", "optimize_enterprise", "crisis_mode"

## Telemetry & cost tracking
- Log toate request-urile GPT cu cost real
- Track token usage per organizație
- Cost alerts la threshold-uri (10€, 50€, 100€/lună)
- Usage analytics per modul și domeniu