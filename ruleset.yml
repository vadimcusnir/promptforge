# PROMPTFORGE v3 — ruleset.yml (SSOT)
project: PROMPTFORGE_v3
schema_version: 1
semver: 1.0.0
is_ssot: true
description: >
  Single Source of Truth pentru UI, API, Security, Scoring, Export, Entitlements și 7D Engine.
  Orice execuție care nu respectă această schemă este blocată.

policies:
  ui:
    english_only: true                  # copy/UI generate în engleză
    glitch_protocol_enabled: true       # efecte "glitch" controlate (fără impact A11y)
    overlays_allowed: true              # module overlays & specs
    content_policy_no_pii: true         # niciun PII în artefacte publice
    a11y:
      prefers_reduced_motion: honor     # respectă preferința OS
      focus_visible: true               # focus rings everywhere
      min_touch_target_px: 44           # target tactil minim
  motion_budgets:
    cpu_time_percent_max: 1             # ≤1% CPU în idle/hover
    frame_time_ms_p95: 16               # ≤16ms/frame (P95)
    disable_animations_when:            # condiții de dezactivare
      - "prefers-reduced-motion"
      - "low_power_mode"
  security:
    sandbox: strict
    allowlist_api:
      - "/api/gpt-editor"
      - "/api/gpt-test"
      - "/api/export"
      - "/api/run/*"
    token_budgets:
      default_max_tokens: 2000
      editor_max_tokens: 1200
      test_max_tokens: 1600
    max_cost_usd_per_run: 1.50
    knowledge_scoping_tag: safe_to_use  # doar resurse marcate astfel pot fi folosite
    pii_public_export: anonymize        # anonimizare obligatorie la exporturi publice
  validation:
    enum_only: true
    raise_on_invalid: true              # eroare hard la prima abatere
  telemetry:
    do_not_log_raw_client_content: true # nu salva prompturi brute
    redact_keys: ["email","phone","address","api_key"]

sevenD:
  required: [domain, output_format]
  enums:
    domain: [saas, fintech, ecommerce, consulting, education, healthcare, legal, marketing, media, real_estate, hr, ngo, government, web3, aiml, cybersecurity, manufacturing, logistics, travel, gaming, fashion, beauty, spiritual, architecture, agriculture]
    scale: [personal_brand, solo, startup, boutique_agency, smb, corporate, enterprise]
    urgency: [low, planned, sprint, pilot, crisis]
    complexity: [foundational, standard, advanced, expert]
    resources: [minimal, solo, lean_team, agency_stack, full_stack_org, enterprise_budget]
    application: [training, audit, implementation, strategy_design, crisis_response, experimentation, documentation]
    output_format: [txt, md, checklist, spec, playbook, json, yaml, diagram, bundle]
  aliases:
    scale: { program: org, department: org }
    output_format: { document: txt, pack: bundle }
  fallback:
    by_domain_defaults: true
  variability:
    diversity_budget:
      applies_to: [style, angle]        # DOAR formă, nu fapte
      not_applied_to: [facts]
      range: { min: 0.0, max: 1.0 }
      default: 0.2
  domain_defaults:                       # defaults per industrie (exemple reprezentative)
    saas:        { scale: startup,       urgency: planned, complexity: advanced,  resources: lean_team,        application: implementation, output_format: spec }
    fintech:     { scale: enterprise,    urgency: sprint,  complexity: advanced,  resources: full_stack_org,   application: implementation, output_format: spec }
    ecommerce:   { scale: smb,           urgency: sprint,  complexity: standard,  resources: lean_team,        application: implementation, output_format: playbook }
    education:   { scale: smb,           urgency: planned, complexity: standard,  resources: lean_team,        application: training,       output_format: playbook }
    healthcare:  { scale: corporate,     urgency: crisis,  complexity: expert,    resources: full_stack_org,   application: implementation, output_format: spec }
    legal:       { scale: corporate,     urgency: planned, complexity: expert,    resources: full_stack_org,   application: documentation,  output_format: spec }
    # ... restul din Core25 moștenesc aceeași logică

prompt_standard:
  sections: [ROLE_GOAL, CONTEXT_7D, OUTPUT_SPEC, PROCESS, GUARDRAILS, EVALUATION_HOOKS, TELEMETRY_KEYS]
  non_deletable_in_ui: true
  output_spec_contract:
    must_define_fields: [format, fields, example]
    example_minimal:
      format: markdown
      fields: [title, sections, kpi]
      example: |
        # Title
        - Section A
        - Section B
        KPI: {...}

test_and_score:
  rubric_axes: [clarity, execution, ambiguity, business_fit]
  thresholds:
    clarity_min: 80
    execution_min: 80
    ambiguity_max: 20
    business_fit_min: 75
    total_min: 80
  weights:
    clarity: 0.30
    execution: 0.35
    ambiguity_inv: 0.15        # se calculează pe (100 - ambiguity)
    business_fit: 0.20
  auto_fix:
    enabled: true
    max_iterations: 1
    strategies: [tighten, optimize_enterprise, crisis_mode, expand_steps]

api:
  required_headers: ["x-org-id","x-run-id","x-client-version"]
  cors:
    allowed_origins: ["https://chatgpt-prompting.com","https://*.promptforge.cloud"]
    allowed_methods: ["GET","POST","OPTIONS"]
    allowed_headers: ["content-type","x-org-id","x-run-id","authorization","x-client-version"]
  rate_limit:
    editor: { rpm: 60 }                 # optimizează promptul în editor
    test:   { rpm: 30 }                 # rulează testele live
    run:    { rpm: 30, per_org: true }  # execută /api/run; cheie de business

export:
  structure: standard_bundle
  artifacts: ["prompt.txt","prompt.md","prompt.json","prompt.pdf","telemetry.json","manifest.json","checksum.txt"]
  checksum:
    algo: sha256
    canonical_order: ["prompt.txt","prompt.json","prompt.md","prompt.pdf","manifest.json","telemetry.json"]
  storage:
    path_template: "/bundles/{org}/{date}/{domain}/{module}/{run}/"
  pdf:
    paper: A4
    margin_mm: 16
    header: "{project} · {domain} · {module}"
    footer: "page {n}"
    watermark_trial: "TRIAL — Not for Redistribution"
  guardrails:
    block_export_when:
      - "score_total < 80"             # export blocat dacă scorul total < 80
      - "pii_detected == true"         # blocat dacă PII nu e anonimizat

entitlements:
  plans:
    pilot:
      modules: "M01-M10"
      features: [txt, md]
      flags:
        canUseAllModules: false
        canExportMD: true
        canExportPDF: false
        canExportJSON: false
        canUseGptTestReal: false
        hasCloudHistory: false
        hasEvaluatorAI: false
        hasAPI: false
        hasWhiteLabel: false
        canExportBundleZip: false
      retention_days: 30
    pro:
      modules: "M01-M30"
      features: [txt, md, pdf, json, cloud_history, evaluator]
      flags:
        canUseAllModules: true
        canExportMD: true
        canExportPDF: true
        canExportJSON: true
        canUseGptTestReal: true
        hasCloudHistory: true
        hasEvaluatorAI: true
        hasAPI: false
        hasWhiteLabel: false
        canExportBundleZip: false
      retention_days: 90
    enterprise:
      modules: "M01-M50"
      features: [txt, md, pdf, json, api, whitelabel, bundle_zip, cloud_history, evaluator]
      flags:
        canUseAllModules: true
        canExportMD: true
        canExportPDF: true
        canExportJSON: true
        canUseGptTestReal: true
        hasCloudHistory: true
        hasEvaluatorAI: true
        hasAPI: true
        hasWhiteLabel: true
        canExportBundleZip: true
        hasSeatsGT1: true
      retention_days: 365
  ui_rules:
    hide_modules_without_entitlement: true
    block_endpoints_without_entitlement: true

definition_of_ready:
  conditions:
    - id: 7d_valid
      required: true
      desc: "7D complet, valori ∈ enum, signature_7d calculată"
    - id: entitlement_valid
      required: true
      desc: "Plan & feature flags valide pentru modul/export/test"
    - id: output_spec_loaded
      required: true
      desc: "module.spec.outputs.fields disponibil & complet"
    - id: tests_defined
      required: true
      desc: "Cel puțin un testcase definit"
    - id: input_minimum
      required: true
      desc: "inputs.custom are toate câmpurile required"

definition_of_done:
  conditions:
    - id: score_threshold
      required: true
      desc: "Score total ≥ 80 (după 1 tighten dacă e cazul)"
    - id: output_complete
      required: true
      desc: "Toate fields required populate; format conform OUTPUT_SPEC"
    - id: checksum_valid
      required: true
      desc: "sha256 per fișier + bundle checksum canonic valide"
    - id: manifest_written
      required: true
      desc: "manifest.json complet (incl. license_notice)"
    - id: telemetry_saved
      required: true
      desc: "runs.telemetry salvată (fără PII în clar)"

telemetry:
  keys: [run_id, model, tokens_in, tokens_out, cost_usd, tta_seconds, score_total, scores, policy_hits, ruleset_version]
  slo:
    tta_text_seconds_p95: 60
    tta_sop_seconds_p95: 300
    pass_rate_weekly_min_pct: 99

versioning:
  ruleset:
    track_versions: true
    log_overrides: true
  modules:
    semver_required: true
    changelog_required: true

license:
  manifest_required_field: license_notice
  default_notice:
    pilot: "© PROMPTFORGE v3 — Pilot License"
    pro: "© PROMPTFORGE v3 — Pro License"
    enterprise: "© PROMPTFORGE v3 — Enterprise License"

errors:
  hard_block:
    - INVALID_7D_ENUM
    - RULESET_DEFAULT_MISSING
    - ENTITLEMENT_REQUIRED
    - SCORE_LT_80
    - CHECKSUM_INVALID
    - MANIFEST_MISSING
    - PII_PUBLIC_LEAK

metadata:
  last_updated: "2025-08-27"
